function resetBmap(e){var t=e.ecc._model,a=null;t.eachComponent("bmap",function(e){null==a&&(a=e.__bmap)}),a&&setTimeout(function(){a.setZoom(4)},500)}function threshold(e,t){var a=[],i=[];if(!_.isUndefined(e.targetData)){for(var r=function(t){for(var r={silent:!0,data:[]},o=0;o<e.targetData[t].cols.length;o++){var s={show:!1,top:10,right:10,pieces:[],orient:"horizontal",padding:35,left:"15"};if(!_.isUndefined(e.targetData[t].cols[o].thresholds))for(var l in e.targetData[t].cols[o].thresholds)for(var c=0;c<e.targetData[t].cols[o].thresholds[l].length;c++){var d={gt:e.targetData[t].cols[o].thresholds[l][c].t_min_values,lte:e.targetData[t].cols[o].thresholds[l][c].t_max_values,color:e.targetData[t].cols[o].thresholds[l][c].t_color,label:e.targetData[t].cols[o].thresholds[l][c].t_key},u={yAxis:e.targetData[t].cols[o].thresholds[l][c].t_min_values,itemStyle:{normal:{label:{show:!0,position:"start",formatter:e.targetData[t].cols[o].thresholds[l][c].t_key}}}},f={yAxis:e.targetData[t].cols[o].thresholds[l][c].t_max_values,itemStyle:{normal:{label:{show:!0,position:"start",formatter:e.targetData[t].cols[o].thresholds[l][c].t_key}}}};s.pieces.push(d),s.show=!0,r.data.push(u),r.data.push(f)}i.push(s)}a.push(r),n=_.filter(e.series,function(e){return e.yAxisIndex==t});for(var p=0;p<n.length;p++)n[p].markLine=a[t]},o=0;o<e.targetData.length;o++){var n;r(o)}if("scatter"==e.series[0].type){var s=i[0];i=[];for(var l=0;l<e.series.length;l++){for(var c=0;c<s.pieces.length;c++)if(s.pieces[c].gt){var d={silent:!0,data:[]},u={yAxis:s.pieces[c].gt,itemStyle:{normal:{label:{show:!0,position:"start",formatter:s.label}}}},f={yAxis:s.pieces[c].lte,itemStyle:{normal:{label:{show:!0,position:"start",formatter:s.label}}}};d.data.push(u,f),e.series[c].markLine=d}i.push(angular.copy(s))}for(var p=0;p<e.series.length;p++)!_.isUndefined(e.color)&&p<5?(i[p].outOfRange.color=e.color[p],i[p].color.push(e.color[p])):(i[p].outOfRange.color=t.color[p],i[p].color.push(t.color[p])),i[p].dimension=1,i[p].seriesIndex=p,i[p].show=!1,i[p].top=15*p;s.dimension=1,i=s}else if("pie"==e.series[0].type){var g=i[0];i=[];for(var h=0;h<e.series.length;h++){g.outOfRange={color:[]},g.color=[];for(var m=0;m<e.series[h].data.length;m++)!_.isUndefined(e.color)&&h<5?(g.outOfRange.color=e.color[h],g.color.push(e.color[h])):(g.outOfRange.color.push(t.color[m]),g.color.push(t.color[m]));i.push(g)}}else if(i.length===e.series.length)for(var v=0;v<i.length;v++)i[v].seriesIndex=v,i[v].top=3*v+"%",i[v].outOfRange={color:[]},i[v].color=[],!_.isUndefined(e.color)&&v<5?(i[v].outOfRange.color=e.color[v],i[v].color.push(e.color[v])):(i[v].outOfRange.color=t.color[v],i[v].color.push(t.color[v]));e.visualMap=i}return e}function theme(e,t){return e}function transForEXCEL(e){var t=[],a={};for(var i in e.columnList)a[i]=e.columnList[i].name;for(var i in e.data){var r={};for(var o in e.data[i])r[a[o]]=e.data[i][o];t.push(r)}return t}function randomStr(){return Math.random().toString(36).substring(2)}function render(e,t){var a=/(\\)?\{([^\{\}\\]+)(\\)?\}/g;return e.replace(a,function(e,a,i,r){if(a||r)return e.replace("\\","");for(var o,n,s,l=i.replace(/\s/g,"").split("."),c=t,o=0,n=l.length;o<n;++o)if(s=l[o],c=c[s],void 0===c||null===c)return"{"+i+"}";return c})}function dataStructure(e){var t=e?e.toString():"",a=/^\d+(\.\d+)?$/.test(t),i=a?t.split(".")[0].length:0,r=a&&t.indexOf(".")!=-1?t.split(".")[1].length:0;return{isNumber:a,intBit:i,floatBit:r}}function dataFormat(e){var t=dataStructure(e);return t.isNumber?numbro(e).format("0.[0000]"):e}function verifyAggExpRegx(exp){var result={isValid:!1,msg:""},exp=exp.replace(/\s/g,"").replace(/(sum|avg|count|max|min)\([\u4e00-\u9fa5_a-zA-Z0-9]+\)/g,"1");try{eval(exp)}catch(e){return result.msg=e.message,result}return result.isValid=!0,result.msg="ok!",result}function cboardTranslate(path){for(var keys=path.split("."),exp="CB_I18N",i=0;i<keys.length;i++)exp+="['"+keys[i]+"']";var result=eval(exp);return result?result:path}function groupSort(e,t,a){var i=[],r=t.prevOptions,o=e.chartConfig.keys.length,n=e.chartConfig.groups.length,s=e.data,l=[];for(var c in t.drill.config)l.push(t.drill.config[c]);if(_.isUndefined(r))i=getSortingData(s,o,n,e,a,t);else{var d=[],u=r.prevData,f=r.keys;f.length!==o&&"up"!==a&&(o=f.length);var p=getSortingData(s,o,n,e,a,t);0===u.length&&(u=p),_.each(u,function(e){_.each(p,function(t){"down"===a||_.isUndefined(a)?t.indexOf(e)>-1&&d.push(t):e.indexOf(t)>-1&&d.push(t)})}),_.each(p,function(e){d.indexOf(e)===-1&&d.push(e)}),d.length>0&&(i=_.uniq(d))}return i}function getSortingData(e,t,a,i,r,o){var n=[],s=void 0,l=i.chartConfig.keys.length;_.map(e[a],function(e,t){_.isUndefined(s)&&e.sort&&"sort"!==e.sort&&(s=e.sort)});var c=0,d=1;("up"===r||"up"!==r&&"down"!==r)&&(c=1,d=2);for(var u=a+1;u<e.length;u++){for(var f="",p=0;p<t-c;p++)(_.isNaN(Number(e[u][p].data))||""===e[u][p].data)&&(f+=""===e[u][p].data?"_":e[u][p].data,p!==t-d&&(f+="-"));n.indexOf(f)===-1&&n.push(f)}var g="";return n="function"==typeof g.localeCompare?n.sort(function(e,t){return!_.isUndefined(s)&&1===l||!_.isUndefined(o.prevOptions)?0:e.localeCompare(t,"zh")}):n.sort()}function sortByPrev(e,t,a){function i(e){var t=parseFloat(e);return t=_.isNaN(t)||_.isUndefined(t)||_.isNull(t)||t===1/0?-(1/0):t}var r=[],o={},n=t.prevOptions.prevData,s=e.chartConfig.keys.length,l=e.chartConfig.groups.length,c=e.data,d=void 0,u=void 0,f=0,p=1;_.map(c[l],function(e,t){_.isUndefined(d)&&e.sort&&(d=e.sort,u=t)}),_.isUndefined(t.prevOptions.keys)||"up"===a||(s=t.prevOptions.keys.length),("up"===a||"up"!==a&&"down"!==a)&&(f=1,p=2);for(var g=l+1;g<c.length;g++){for(var h="",m=0;m<s-f;m++)(_.isNaN(Number(c[g][m].data))||""===c[g][m].data)&&(h+=""===c[g][m].data?"_":c[g][m].data,m!==s-p&&(h+="-"));o[h]?o[h].push(c[g]):o[h]=[c[g]]}_.each(n,function(e){_.isUndefined(u)||_.isUndefined(o[e])||o[e].sort(function(e,t){return"asc"===d?i(e[u].data)-i(t[u].data):"desc"===d?i(t[u].data)-i(e[u].data):0}),_.isUndefined(o[e])||(r=r.concat(o[e]))});for(var v=[],y=0;y<l+1;y++)v.push(c[y]);return r=v.concat(r)}function selectorRender(keys,groupSelects,columnList,EventService,options){var key=keys[0],target=keys[0].colNoDot?keys[0].colNoDot:keys[0].col,$target=$("#select_"+target),eventName=keys[0].eventName,targetEventName=eventName?eventName:target;$target.addClass("select_"+targetEventName);var option="";if(_.each(options.firstSelects,function(e){option+='<option value="'+e+'">'+e+"</option>"}),$target.children().length&&$target.empty(),$target.append(option),$target.multipleSelect({single:key.isSingle,filter:options.chartConfig.isFilter,selectAllText:"全部",onClick:function(e){if(e.checked)key.isSingle?window.$$dlut_param[$target.attr("data-eventName")]=e.value:window.$$dlut_param[$target.attr("data-eventName")].indexOf(e.value)===-1&&("-1"===window.$$dlut_param[$target.attr("data-eventName")]&&(window.$$dlut_param[$target.attr("data-eventName")]=[]),window.$$dlut_param[$target.attr("data-eventName")].push(e.value));else if(key.isSingle)window.$$dlut_param[$target.attr("data-eventName")]="";else{var t=$target.multipleSelect("getSelects");0===t.length&&(t="-1"),window.$$dlut_param[$target.attr("data-eventName")]=t}},onCheckAll:function(){var e=options.firstSelects.length,t=$target.multipleSelect("getSelects").length;e===t?window.$$dlut_param[$target.attr("data-eventName")]=[]:window.$$dlut_param[$target.attr("data-eventName")]=$target.multipleSelect("getSelects")},onUncheckAll:function(){window.$$dlut_param[$target.attr("data-eventName")]="-1"},onClose:function onClose(){try{EventService.trigger("$change",{event:key.eventName,col:key.col?key.col:key.column}),eval(key.change)}catch(e){console.log("CBoardSelectorRender.js 执行eval错误",key.change,key.col,e)}}}),key.isSingle){if(!options.chartConfig.init){var selected=options.firstSelects[0];!_.isUndefined(options.chartConfig.initSelected)&&options.chartConfig.initSelected.length>0&&(selected=options.chartConfig.initSelected),selected||(selected=-1),$target.multipleSelect("setSelects",[selected]),window.$$dlut_param[$target.attr("data-eventname")]=selected}options.chartConfig.temporaryParam&&($target.multipleSelect("setSelects",[options.chartConfig.temporaryParam]),window.$$dlut_param[$target.attr("data-eventName")]=options.chartConfig.temporaryParam),delete options.chartConfig.temporaryParam,$target&&EventService.trigger("$ready",{wName:options.wName})}else options.chartConfig.init||($target.multipleSelect("checkAll"),window.$$dlut_param[$target.attr("data-eventName")]="all"),options.chartConfig.temporaryParam&&("all"===options.chartConfig.temporaryParam?($target.multipleSelect("checkAll"),window.$$dlut_param[$target.attr("data-eventName")]="all"):("string"==typeof options.chartConfig.temporaryParam&&(options.chartConfig.temporaryParam=[options.chartConfig.temporaryParam]),$target.multipleSelect("setSelects",options.chartConfig.temporaryParam),window.$$dlut_param[$target.attr("data-eventName")]=options.chartConfig.temporaryParam)),delete options.chartConfig.temporaryParam,$target&&EventService.trigger("$ready",{wName:options.wName})}function getRootPath(){var e=window.document.location.href,t=window.document.location.pathname,a=e.indexOf(t),i=e.substring(0,a),r=t.substring(0,t.substr(1).indexOf("/")+1);return i+r}function convertCityData(e){for(var t=e.data,a=e.keys,i=[],r=0;r<t.length;r++)for(var o=t[r],n=0;n<o.length;n++){var s=city[a[n][0]],l=CBoardEChartRenderEventInfo(e,void 0,n);if(0===r){var c={name:a[n][0],value:s&&2===s.length?s.concat(t[r][n]):[null,null],eventInfo:l};i.push(c)}else i[n]&&i[n].value&&(i[n].value=i[n].value.concat(t[r][n]))}return i}function convertProvinceData(e){for(var t=[],a=0;a<e.length;a++){var i=province[e[a][0]];i&&t.push({name:e[a][0],value:e[a][1]})}return t}function convertZoneData(e){for(var t=e.data,a=e.keys,i=[],r=0;r<t.length;r++)for(var o=t[r],n=0;n<o.length;n++){var s=a[n][0],l=[];if(s&&0===r){var c=CBoardEChartRenderEventInfo(e,void 0,n),d={name:s,value:l.concat(t[r][n]),eventInfo:c};i.push(d)}else i[n]&&i[n].value&&(i[n].value=i[n].value.concat(t[r][n]))}return i}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};$(function(){window.dlut||(window.dlut={}),dlut.utils={GetQueryString:function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(t);return null!=a?unescape(a[2]):null},convertMoney:function(e,t){e=parseFloat(e),"亿"==t?e=1e8*e:"万"==t&&(e=1e4*e);var a="";if(e>=1e8){var i=(e/1e8).toString(),r=i.substring(0,i.indexOf(".")).length-2;if(i.toString().indexOf(".")>-1&&r<=0){var o=i.substring(i.indexOf(".")+1,i.toString().indexOf(".")+3);a="00"==o?i.substring(0,i.indexOf("."))+"亿":i.substring(0,i.indexOf(".")+3)+"亿"}else a=i.indexOf(".")==-1?i+"亿":i.substring(0,i.indexOf("."))+"亿"}else if(e>1e4){var i=(e/1e4).toString(),r=i.substring(0,i.indexOf(".")).length-2;if(i.toString().indexOf(".")>-1&&r<=0){var o=i.substring(i.indexOf(".")+1,i.toString().indexOf(".")+3);a="00"==o?i.substring(0,i.indexOf("."))+"万":i.substring(0,i.indexOf(".")+3)+"万"}else a=i.indexOf(".")==-1?i+"万":i.substring(0,i.indexOf("."))+"万"}else if(e.toString().indexOf(".")==-1)a=e.toString()+"元";else{var i=e.toString();a=i.substring(0,i.indexOf(".")+3)+"元"}return a}},dlut.PostMan={listen:function(e,t,a){this._callbacks||(this._callbacks={});return a||(a=this(this._callbacks[e]||(this._callbacks[e]=[])).push({callback:t,context:a})),this},speak:function(){var e,t,a,i,r=Array.prototype.slice.call(arguments,0),o=r.shift();if(!(t=this._callbacks))return this;if(!(e=this._callbacks[o]))return this;for(a=0,i=e.length;a<i;a++)e[a].callback.apply(e[a].context,r);return this},socket:null,lastLetter:{},init:function(e){io&&e&&e.office?(this.socket=io.connect(e.office,{"reconnection limit":1}),this.socket.on("connect_error",function(e){this.io.disconnect()}),this.socket.on("letter",$.proxy(function(e){this.speak&&this.speak(e.title,e),this.lastLetter=e},this))):console.error("dlut","PostMan init must has io,option,option.office 3 parms")},post:function(e,t,a){a=$.extend(a,{addressee:e,title:t}),this.socket&&"page"!=a.addressee&&this.socket.emit("letter",a),"page"!=a.addressee&&"all"!=a.addressee||this.speak&&this.speak(a.title,a)},whenReceive:function(e,t,a){this.listen(e,t,a)},postlastLetter:function(){this.lastLetter.title&&this.post("page",this.lastLetter.title,this.lastLetter)}},dlut.html={color:{red:function(e){return'<a class="alert_text_red">'+e+"</a>"},yellow:function(e){return'<a class="alert_text_yellow">'+e+"</a>"},green:function(e){return'<a class="alert_text_green">'+e+"</a>"}},getColorClass:function(e,t,a){var i="alert_text_yellow";return"green"===a?i="alert_text_green":"yellow"===a?i="alert_text_yellow":"red"===a?i="alert_text_red":e>t?i="alert_text_green":e<t&&(i="alert_text_red"),i},arrow:function e(t,a,i){if("-"===t)return"-";"undefined"==typeof a&&(a=0);var r=dlut.html.getColorClass(t,a,i),e="fa-arrow-up";return(r="red")&&(e="fa-arrow-down"),"<a>"+t+'<i class="fa '+e+" "+r+'" aria-hidden="true" style="margin-left: 5px"></i></a>'},arrowPercent:function(e,t,a,i){if("-"===e)return"-";"undefined"==typeof t&&(t=0);var r=dlut.html.getColorClass(e,t,a),e=dlut.math.toPercent(e,i);if("-"===e)return"-";var o="fa-arrow-up";return"alert_text_red"===r?o="fa-arrow-down":"alert_text_yellow"===r&&(o=""),"<a>"+e+'<i class="fa '+o+" "+r+'" aria-hidden="true" style="margin-left: 5px"></i></a>'},bubble:function(e,t,a){if("-"===e)return"-";"undefined"==typeof t&&(t=0);var i=dlut.html.getColorClass(e,t,a);return"<a>"+e+'<i class="fa fa-adjust fa-rotate-270 '+i+'" aria-hidden="true" style="margin-left: 5px"></i></a>'},bubblePercent:function(e,t,a){if("-"===e)return"<a>-</a>";"undefined"==typeof t&&(t=0);var i=dlut.html.getColorClass(e,t,a),e=dlut.math.toPercent(e);return"-"===e?"<a>-</a>":_.isNaN(e)||"NaN"===e.toString()?"<a>-</a>":"<a>"+e+'<i class="fa fa-adjust fa-rotate-270 '+i+'" aria-hidden="true" style="margin-left: 5px"></i></a>'},square:function(e,t,a){if("-"===e)return"-";"undefined"==typeof t&&(t=0);var i=dlut.html.getColorClass(e,t,a);return"<a>"+e+'<i class="fa fa-square '+i+'" aria-hidden="true" style="margin-left: 5px"></i></a>'},squarePercent:function(e,t,a){if("-"===e)return"-";"undefined"==typeof t&&(t=0);var i=dlut.html.getColorClass(e,t,a),e=dlut.math.toPercent(e);return"-"===e?"-":_.isNaN(e)||"NaN"===e.toString()?"<a>-</a>":"<a>"+e+'<i class="fa fa-square '+i+'" aria-hidden="true" style="margin-left: 5px"></i></a>'},bar:{percentBar:function(e,t,a,i,r){_.isUndefined(a)&&(a=!0),"undefined"==typeof t&&(t=70),_.isUndefined(r)&&(r="#47b9ff");var o="";if(o+='<label class="percentBar" style="width:'+(_.isNaN(dlut.math.toDecimal(e))?0:dlut.math.toDecimal(e)*t)+"%; background-color: "+r+';">',o+='<span class="percentBar-label" style="color: black">',"int"===a)o+=dlut.math.toDecimal(e,0);else{var n=2;_.isUndefined(i)||(n=i),o+=a?dlut.math.toPercent(e,n):dlut.math.toDecimal(e,n)}return o+="</span></label>"},doublePercentBar:function(e,t,a,i){_.isUndefined(i)&&(i=2),e=parseFloat(e);var r=Math.abs(a)>t?Math.abs(a):t,o="";return o+='<div class="double-percent-bar">',o+='<div class="flex">',e<0&&(o+="<label>"+dlut.math.toPercent(e,i)+'<span style="width:'+parseInt(Math.abs(e)/r*80)+'%" class="red"></span></label>'),o+="</div>",o+='<div class="flex">',e>=0&&(o+='<label><span style="width:'+parseInt(e/r*80)+'%" class="green"></span>'+dlut.math.toPercent(e,i)+"</label>"),o+="</div>"}}},dlut.math={toInt:function(e){return"-"===e?"-":_.isNaN(e)||e===1/0||e===-(1/0)||_.isUndefined(e)||"undefined"===e?"-":Math.round(e)},toDecimal:function(e,t){if("-"===e)return"-";if(_.isNull(e)||_.isNaN(e)||e===1/0||e===-(1/0)||_.isUndefined(e)||"undefined"===e)return"-";if("undefined"==typeof t&&(t=2),0===t)return dlut.math.toInt(e);t<1&&(t=1),"string"==typeof e&&(e=parseFloat(e));var a=Math.pow(10,t),i=(Math.round(e*a)/a).toFixed(t);return i},toDecimalK:function(e,t){return dlut.math.formatThousand(dlut.math.toDecimal(e,t))},to2Decimal:function(e){if("-"===e)return"-";if("string"==typeof e&&(e=parseFloat(e)),_.isNaN(e)||e===1/0||e===-(1/0))return"-";var t=(Math.round(100*e)/100).toFixed(2);return t},to2DecimalK:function(e){return dlut.math.formatThousand(dlut.math.to2Decimal(e))},toPercent:function(e,t){if("-"===e)return"-";if(0===e.length||_.isNull(e)||_.isNaN(e)||e===1/0||e===-(1/0)||_.isUndefined(e)||"undefined"===e)return"-";"string"==typeof e&&(e=parseFloat(e));var a=2;return _.isUndefined(t)||(a=t),dlut.math.toDecimal(100*e,a)+"%"},toPercentK:function(e){return"-"===e?"-":_.isNaN(e)||e===1/0||e===-(1/0)||_.isUndefined(e)||"undefined"===e?"-":("string"==typeof e&&(e=parseFloat(e)),_.isNaN(e)||e===1/0||e===-(1/0)?"-":dlut.math.formatThousand(Math.round(1e4*e)/100)+"%")},toDate:function(e,t){if(!e)return"-";var a="年",i="月",r="日";if(t&&(a=i="/",r=""),"-"===e)return"-";if(_.isNaN(e)||e===1/0||e===-(1/0))return"-";var o="";if(e&&(e=e.toString()),4===e.length)o=e+a;else if(6===e.length){var n=e.slice(0,4),s=e.slice(4);o=n+a+s+i}else if(8===e.length){var n=e.slice(0,4),s=e.slice(4,6),l=e.slice(6,8);o=n+a+s+i+l+r}return o},convertNum:function(e){return"string"==typeof e?e=parseFloat(e):"number"==typeof e||alert("dlut.math.convertNum 参数类型错误"),e>0&&e>1e3&&e<1e6?e=dlut.math.to2Decimal(e/1e3)+"K":e>0&&e>1e6?e=dlut.math.to2Decimal(e/1e6)+"M":e<0&&e<-1e3&&e>-1e6?e=dlut.math.to2Decimal(e/1e3)+"K":e<0&&e<-1e6&&(e=dlut.math.to2Decimal(e/1e6)+"M"),e},formatThousand:function(e){return e+="",e.indexOf(".")||(e+="."),e.replace(/(\d)(?=(\d{3})+\.)/g,function(e,t){return t+","}).replace(/\.$/,"")},isNum:function(e){return"-"===e?"-":0===e.length||_.isNull(e)||_.isNaN(e)||e===1/0||e===-(1/0)||_.isUndefined(e)||"undefined"===e?"-":("string"==typeof e&&(e=parseFloat(e)),e)}},dlut.echart={yAxisAlign:function(e){for(var t in e)e[t].max=function(e){return Math.abs(e.max)>Math.abs(e.min)?(1.2*Math.abs(e.max)).toFixed(2):(1.2*Math.abs(e.min)).toFixed(2)},e[t].min=function(e){return Math.abs(e.max)>Math.abs(e.min)?(1.2*-Math.abs(e.max)).toFixed(2):(1.2*-Math.abs(e.min)).toFixed(2)}},labelFormatter:function labelFormatter(e){var value=e.value,result="",formatter=e.data.laberFormatter;if(!formatter)return value;try{return result=eval(formatter)}catch(e){console.error("label formatterError",value,formatter)}},xAxisBottom:function(e,t,a,i,r){for(var o=[],n=0;n<t.length;n++){var s=angular.copy(e.series[t[n]]);e.series[t[n]].stack=t[n]+1,s.stack=t[n]+1,s.isAssist=!0,s.name+=" ",s.itemStyle={normal:{barBorderColor:"rgba(0,0,0,0)",color:"rgba(0,0,0,0)"},emphasis:{barBorderColor:"rgba(0,0,0,0)",color:"rgba(0,0,0,0)"}},s.data=[];for(var l=0;l<e.series[t[n]].data.length;l++){var c={eventInfo:e.series[t[n]].data[l].eventInfo,value:0};s.data.push(c)}s.label={show:!0,position:"bottom",rotate:i?i:0,ignore:!0,color:"black",offset:r?r:[0,0],formatter:a},o.push(s)}var d=o.concat(e.series);e.series=d},customSort:function(e,t,a){_.isUndefined(a)&&(a=1),a-=1;var i=[];return _.each(e,function(e){var r={},o=[];_.each(e.data,function(e){r[e.eventInfo[a].value]=e});for(var n=0;n<t.length;n++)r[t[n]]&&(o.push(r[t[n]]),i.indexOf(t[n])===-1&&i.push(t[n]),delete r[t[n]]);for(var s in r)o.push(r[s]),i.indexOf(s)===-1&&i.push(s);e.data=o}),{axis:i,series:e}}},dlut.table={getIndex:function(e,t){var a=e.data;if(a.length>1)for(var i=a[0],r=0;r<i.length;r++)if(i[r].data===t)return r},getRankMap:function(e,t,a){"undefined"==typeof a&&(a="desc");for(var i=e.data,r={},o=[],n=1;n<i.length;n++){var s=parseFloat(i[n][t].data);o.push(s)}if(o&&o.sort){var l=function(e){return e};"desc"===a&&(l=function(e){return-e}),o=_.sortBy(o,l)}for(var n=0;n<=o.length;n++)r[o[n]]=n+1;return r},getTotal:function(e,t){var a=e.data,i=0;if(a.length>1)for(var r=1;r<a.length;r++)if(a[r][t]){var o=parseFloat(a[r][t].data);$.isNumeric(a[r][t].data)&&(i+=o)}return i},customSort:function(e,t,a,i){_.isUndefined(a)&&(a=1),_.isUndefined(i)&&(i=0),a-=1;for(var r=[],o={},n=1+i;n<e.length;n++)o[e[n][a].data]=e[n];for(var s=0;s<1+i;s++)r.push(e[s]);_.each(t,function(e){o[e]&&(r.push(o[e]),delete o[e])});for(var l in o)r.push(o[l]);return r}},dlut.selector={customSort:function(e,t){var a=[],i={};_.each(e,function(e){i[e]=e}),_.each(t,function(e){i[e]&&(a.push(e),delete i[e])});for(var r in i)a.push(i[r]);return a}},dlut.url={goTo:function(e,t,a){var i="";i=_.isUndefined(a)?window.location.origin+window.location.pathname+"?":window.location.origin+a+"?";var r=window.$$dlut_param,o=getQueryString("yili-token"),n=!1;if(o&&(n=!0,i+="yili-token="+o),t.length){var s=[],l=[];for(var c in r)s.push(c);_.each(s,function(e){_.each(t,function(t){e.indexOf(t)>-1&&l.push(e)})}),_.each(l,function(e,t){var a=angular.copy(r[e]);"object"===_typeof(r[e])&&_.isUndefined(r[e].length)&&(a="",_.each(r[e],function(e,t){a+=e,t<e.length-1&&(a+=",")})),i+=n&&0===t?"&"+e+"="+a:n||0!==t?"&"+e+"="+a:e+"="+a})}window.location.href=i+e}}});var updateEchartOptions=function(e,t){if(e){if(e.markPoint&&_.isArray(t.series)){for(var a=function(e,t){if(!_.isUndefined(e)&&_.isArray(t)){if("category"==t[e].type)return t[e].data}else if(_.isUndefined(e)&&_.isArray(t)){if("category"==t[e].type)return t[0].data}else if("category"==t.type)return t.data},i=function(e){for(var t=[],a=0;a<e.length;a++){var i=e[a];_.isUndefined(i.value)?t.push(i):t.push(i.value)}return t},r=function(e,t,a,i){var r=[];if(_.isUndefined(e)){for(var o=0;o<t.length;o++)r.push({coord:[a[o],o,i.data[0].unit?i.data[0].unit:""]});i.markPoint={symbolRotate:-90,label:{normal:{textStyle:{fontSize:18},formatter:function(e){return e.data.coord[0]+e.data.coord[2]},offset:[5,2]}},itemStyle:{normal:{color:"transparent"}},data:r}}else{for(var o=0;o<e.length;o++)r.push({coord:[o,a[o],i.data[0].unit]});i.markPoint={label:{normal:{formatter:function(e){return e.data.coord[1]+e.data.coord[2]},textStyle:{fontSize:18}}},itemStyle:{normal:{color:"transparent"}},data:r}}},o=[],n=[],s=0;s<t.series.length;s++){var l,c,d=[],u=t.series[s];l=a(u.xAxisIndex,t.xAxis),c=a(u.yAxisIndex,t.yAxis),_.isUndefined(u.stack)?(d=i(u.data),r(l,c,d,u)):(o.push(u),n.push(u.stack))}if(o.length){var f=function(e){var r=a(e[0].xAxisIndex,t.xAxis),o=a(e[0].yAxisIndex,t.yAxis),n=i(e[0].data);if(e.length>1)for(var s=1;s<e.length;s++){r=a(e[s].xAxisIndex,t.xAxis),o=a(e[s].yAxisIndex,t.yAxis);var l=i(e[s].data);n=_.map(_.zip(n,l),function(e){return e[0]+e[1]})}return{x:r,y:o,sumData:n}},p=_.uniq(n);if(1==p.length){var g=f(o);r(g.x,g.y,g.sumData,o[0])}else{var h=_.groupBy(o,"stack");for(var m in h){var g=f(h[m]);r(g.x,g.y,g.sumData,h[m][0])}}}}t.grid=angular.copy(echartsBasicOption.grid),0==e.legendShow?(t.grid.top="5%",t.legend.show=!1):(void 0===t.legend?t.legend=angular.copy(echartsBasicOption.legend):null,e.legendX?t.legend.x=e.legendX:null,e.legendY?t.legend.y=e.legendY:null,e.legendOrient?t.legend.orient=e.legendOrient:null),void 0===t.grid?t.grid=angular.copy(echartsBasicOption.grid):null,1==e.gridCustom?(e.gridTop?t.grid.top=e.gridTop:null,e.gridBottom?t.grid.bottom=e.gridBottom:null,e.gridLeft?t.grid.left=e.gridLeft:null,e.gridRight?t.grid.right=e.gridRight:null):t.grid=angular.copy(echartsBasicOption.grid)}},echartsBasicOption={title:{},grid:{left:"50",right:"20",bottom:"15%",top:"15%",containLabel:!1},toolbox:{showTitle:!1,feature:{myTool1:{show:!0,title:"",icon:"path://M432.45,595.444c0,2.177-4.661,6.82-11.305,6.82c-6.475,0-11.306-4.567-11.306-6.82s4.852-6.812,11.306-6.812C427.841,588.632,432.452,593.191,432.45,595.444L432.45,595.444z M421.155,589.876c-3.009,0-5.448,2.495-5.448,5.572s2.439,5.572,5.448,5.572c3.01,0,5.449-2.495,5.449-5.572C426.604,592.371,424.165,589.876,421.155,589.876L421.155,589.876z M421.146,591.891c-1.916,0-3.47,1.589-3.47,3.549c0,1.959,1.554,3.548,3.47,3.548s3.469-1.589,3.469-3.548C424.614,593.479,423.062,591.891,421.146,591.891L421.146,591.891zM421.146,591.891",onclick:function(e,t){_.isUndefined(window.$$dlut_echart_timeout)||(window.$$dlut_echart_timeout=!0);var a=e.getOption(),i=a.wName;if($$dlut_renders[i]){for(var r=0;r<a.series.length;r++)if(a.series[r].label||(a.series[r].label={}),a.series[r].labelLine||(a.series[r].labelLine={}),a.series[r].label.ignore);else{_.isUndefined(a.series[r].label.position)&&(a.series[r].label.position="top"),a.series[r].emphasis||(a.series[r].emphasis={},a.series[r].emphasis.label={},a.series[r].emphasis.labelLine={}),a.series[r].emphasis.label||(a.series[r].emphasis.label={}),a.series[r].emphasis.labelLine||(a.series[r].emphasis.labelLine={});var o=!a.series[r].label.show;a.series[r].label.show=o,a.series[r].labelLine.show=o,a.series[r].emphasis.label.show=o,a.series[r].emphasis.labelLine.show=o}echarts.init(t.getDom()).setOption(a)}}},myExcelDownload:{show:!1,title:"",icon:"path://M102.745,48.964h-2.449V37.146c0-0.074-0.012-0.148-0.021-0.223c-0.004-0.469-0.154-0.93-0.475-1.295L80.133,13.163  c-0.006-0.006-0.012-0.008-0.016-0.014c-0.117-0.131-0.254-0.24-0.398-0.334c-0.043-0.029-0.086-0.053-0.131-0.078  c-0.125-0.068-0.258-0.125-0.395-0.166c-0.037-0.01-0.07-0.025-0.107-0.035c-0.148-0.035-0.303-0.057-0.459-0.057H30.295  c-2.207,0-4,1.795-4,4v32.484h-2.449c-3.157,0-5.717,2.559-5.717,5.717v29.73c0,3.156,2.56,5.717,5.717,5.717h2.449v20.352  c0,2.205,1.793,4,4,4h66c2.205,0,4-1.795,4-4V90.128h2.449c3.157,0,5.717-2.561,5.717-5.717v-29.73  C108.461,51.522,105.902,48.964,102.745,48.964z M30.295,16.479h46.332v20.465c0,1.105,0.896,2,2,2h17.668v10.02h-66V16.479z   M75.177,78.098v5.801H56.093V53.35h6.937v24.748H75.177z M26.045,83.898l8.839-15.455L26.362,53.35h7.932l2.674,5.574  c0.907,1.857,1.587,3.355,2.313,5.076h0.089c0.727-1.949,1.315-3.309,2.085-5.076l2.584-5.574h7.887l-8.613,14.912l9.067,15.637  h-7.978l-2.765-5.529c-1.132-2.131-1.858-3.717-2.719-5.484h-0.091c-0.635,1.768-1.404,3.354-2.356,5.484l-2.539,5.529H26.045z   M96.295,109.396h-66V90.128h66V109.396z M86.733,84.354c-3.489,0-6.935-0.908-8.656-1.859l1.404-5.711  c1.859,0.951,4.715,1.904,7.661,1.904c3.174,0,4.85-1.314,4.85-3.309c0-1.904-1.45-2.992-5.122-4.307  c-5.076-1.768-8.386-4.578-8.386-9.021c0-5.213,4.352-9.201,11.561-9.201c3.443,0,5.982,0.727,7.795,1.541l-1.541,5.576  c-1.224-0.59-3.4-1.451-6.391-1.451s-4.441,1.359-4.441,2.947c0,1.949,1.721,2.811,5.665,4.307c5.393,1.994,7.932,4.803,7.932,9.109  C99.063,80.002,95.12,84.354,86.733,84.354z",onclick:function(e,t){_.isUndefined(window.$$dlut_echart_timeout)||(window.$$dlut_echart_timeout=!0);var a=$(t.getDom()).attr("name"),i=transForEXCEL(window.$$EXCEL[a]),r=XLSX.utils.json_to_sheet(i),o=XLSX.utils.book_new();XLSX.utils.book_append_sheet(o,r,"sheet1"),XLSX.writeFile(o,a+".xlsx")}}}},tooltip:{trigger:"axis",confine:!0},legend:{x:"left",itemWidth:15,itemHeight:10}},CBoardEChartRender=function(e,t,a,i){this.container=e;var r=this.container.attr("name");this.ecc=echarts.init(e.get(0),this.theme),window.$$dlut_renders||(window.$$dlut_renders={}),"undefined"==typeof r&&t&&"undefined"!=typeof t.wName&&(r=t.wName),window.$$dlut_renders[r]=this,this.isDeppSpec=a,this.basicOption=echartsBasicOption,t&&(t.wName=r),this.wName=r,this.options=t,this.themeFunList=i};CBoardEChartRender.prototype.theme="theme-fin1",CBoardEChartRender.prototype.chart=function(e,t,a){var i=this,r=1==this.isDeppSpec?i.options:$.extend(!0,{},i.basicOption,i.options);return void 0!=r.visualMap&&$(this.jqContainer).css({height:"500px",width:"100%"}),r.legend.data&&r.legend.data.length>35&&(r.grid.top="5%",r.legend.show=!1),t&&(r.animation=!1),i.ecc.setOption(r),r.wName=i.wName,i.options=r,i.changeSize(i.ecc),i.container.resize(function(e){i.ecc.resize(),i.changeSize(i.ecc)}),e&&(i.ecc.group=e,echarts.connect(e)),t&&setTimeout(function(){i.container.css("background","#fff"),html2canvas(i.container[0],{onrendered:function(e){t.data=e.toDataURL("image/jpeg"),t.type="jpg"}})},1e3),a.trigger("$ready",{wName:i.wName}),function(e){e=$.extend(!0,{},i.basicOption,e),i.options=e,e.wName=i.wName,i.ecc.setOption(e,!0),a.trigger("$ready",{wName:i.wName})}},CBoardEChartRender.prototype.changeSize=function(e){var t=e.getOption(),a=t.series[0]?t.series[0].type:null;if("pie"==a){for(var i=t.series.length,r=(e.getWidth()/(i+1+8*i),0);r<i;r++)t.series[r].xRadius?t.series[r].radius=[t.series[r].xRadius[0],t.series[r].xRadius[1]]:t.series[r].radius=[0,"75%"];e.setOption(t)}};var CBoardEChartRenderEventInfo=function(e,t,a){if(0==e.length)return[];var i=e.chartConfig,r=e.keys,o=e.originalData.data,n=e.originalData.columnList,s=e.chartConfig.drillTier,l=[];if(void 0!=a&&void 0!=i.keys)for(var c=0;c<i.keys.length;c++)i.keys[c].drillDown&&r[a]?l.push({col:i.keys[c].drillDown[s.keyTier].col,alias:i.keys[c].drillDown[s.keyTier].alias,value:r[a][c]}):r[a]&&l.push({col:i.keys[c].col,alias:i.keys[c].alias,value:r[a][c]});if(void 0!=t&&void 0!=i.groups)for(var c=0;c<i.groups.length;c++)i.groups[c].drillDown&&e.series[t]?l.push({col:i.groups[c].drillDown[s.groupTier].col,alias:i.groups[c].drillDown[s.groupTier].alias,value:r[a][c]}):e.series[t]&&l.push({col:i.groups[c].col,alias:i.groups[c].alias,value:e.series[t][c]});if(void 0!=t&&void 0!=i.events&&l.length>0)for(var d=l[0],c=0;c<i.events.length;c++){for(var u=i.events[c].col,f=0,p=0,g=0;g<n.length;g++)if(n[g].name==u){f=g;break}for(var g=0;g<n.length;g++)if(n[g].name==d.col){p=g;break}for(var g=0;g<o.length;g++){var h=o[g];if(h[p]==d.value){l.push({col:i.events[c].col,alias:i.events[c].alias,value:h[f]});break}}}return l};String.prototype.render=function(e){return render(this,e)};var CBoardTableRender=function(e,t,a){this.container=e,this.options=t,this.tall,this.drill=a;var i=this;$(this.container).resize(function(e){i.resize(e.target)})};CBoardTableRender.prototype.resize=function(e){var t=$(e).find(".table_wrapper"),a=$(e).parents(".box"),i=a.height()-a.children(".box-header").height();0===i?i=500:i,$(e).find(".tableView").css("max-height",i+"px"),$(e).css("height",i),t.css("width","auto"),t.width()<$(e).width()&&t.css("width","100%")},CBoardTableRender.prototype["do"]=function(e,t,a,i){this.tall=e,this.type=i,e=_.isUndefined(e)?500:e;var r=this,o=function(e,t,i){(_.isUndefined(r.options.chartConfig.option.groupSort)||_.isNull(r.options.chartConfig.option.groupSort)||r.options.chartConfig.option.groupSort)&&!r.options.chartConfig.option.stopMerge&&(r.prevOptions.keys=r.options.chartConfig.keys),r.options=e,r.drill.config=t,r["do"](r.tall,null,a,i)};this.options.chartConfig.crossTable={},this.options.chartConfig.crossTable.drill=this.drill,this.options.chartConfig.crossTable.render=o,(_.isUndefined(this.options.chartConfig.option.groupSort)||_.isNull(this.options.chartConfig.option.groupSort)||this.options.chartConfig.option.groupSort)&&!this.options.chartConfig.option.stopMerge&&(_.isUndefined(this.prevOptions)?this.prevOptions={prevData:groupSort(this.options,this,i)}:this.prevOptions.prevData=groupSort(this.options,this,i),this.options.data=sortByPrev(this.options,this,i));var n=void 0;if(this.options.chartConfig&&this.options.chartConfig.option&&this.options.chartConfig.option.optionCode){n=r.options.chartConfig.option.optionCode;try{var s=angular.copy(window.$$dlut_param);r.options=new Function("option,param","return ("+n+")(option,param)")(r.options,s)}catch(l){console.error("option自定义计算错误",r.options,l)}}var c={tall:e,chartConfig:this.options.chartConfig,data:this.options.data,container:this.container,drill:this.drill,oData:this.options.originalData,render:o,wName:this.options.wName,EventService:a};return crossTable.table(c),$(this.container).css({height:e+"px"}),this.resize(this.container),t&&(t.data=this.options.data,t.type="table"),o};var CBoardFlex2Render=function(e,t){this.container=e,this.options=t};CBoardFlex2Render.prototype.html=function(persist,scope,$compile){var option=this.options,render=$compile(option.template);scope.list=option.data,scope.params=$$dlut_param;var $scope=scope;if(option.code)try{var code=eval(option.code);if("undefined"!=typeof code)for(var key in code)$scope[key]=code[key]}catch(error){console.log("flex error",error)}var html=render(scope);return html},CBoardFlex2Render.prototype.initialize=function(e,t,a,i,r,o){
var n=this;return this.uuid=i,this.scope=a,this.$compile=r,a.EventService=t,this.scope.$$apply=a.$apply,a.click=function(e,i){t.trigger("CE:click",{widget:a.widget,param:{data:{eventInfo:[{col:e,value:i}]}}}),t.trigger("CE:drillDown",{widget:a.widget,param:{data:{eventInfo:[{col:e,value:i}]}}})},a.clickMore=function(e){for(var i=[],r=0;r<e.length;r++)i.push({col:e[r].col,value:e[r].value});t.trigger("CE:click",{widget:a.widget,param:{data:{eventInfo:i}}})},a.gotoScreen=function(e,a){if("undefined"==typeof a&&(a={}),"undefined"!=typeof e){var i=[];for(var r in a){var o=a[r];i.push({column:r,type:"=",values:"string"==typeof o?[o]:o})}t.trigger("WS:screenSkip",{target:e,param:i},"all")}},a.filter=function(e){"undefined"==typeof e&&(e={});var a=[];for(var i in e){var r=e[i];a.push({column:i,type:"=",values:"string"==typeof r?[r]:r})}t.trigger("CE:filter",a)},this.draw(e,o),function(e){n.draw(e,o)}},CBoardFlex2Render.prototype.draw=function(e,t){this.scope.flex2_destroy&&this.scope.flex2_destroy.apply(this.scope),this.options=e;var a=this.html(void 0,this.scope,this.$compile,t);this.container.prop("id","flex_"+this.uuid),this.container.html(a),this.scope.flex2_created&&this.scope.flex2_created.apply(this.scope)};var CBoardSelectorRender=function(e,t){this.container=e,this.options=t,this.chartType="selector"};CBoardSelectorRender.prototype.html=function(e){var t=e.chartConfig.keys,a='<div id="multipleSelectContainer" class="flex-row">';return _.each(t,function(e,t){var i=e.showName?e.showName:e.col?e.col:e.column,r=e.eventName?e.eventName:"event";e.colNoDot=e.col?e.col.replace(".","__"):e.column.replace(".","__"),a+='<div class="flex1"><h5>'+i+'</h5><div><select id="select_'+e.colNoDot+'" class="selector_multiple_simple dSelect ',e.isSingle&&(a+="isSingle "),a+='" multiple data-eventName="'+r+'" data-key="'+e.col+'" data-index="'+t+'" style="width: 100%"></select></div></div>'}),a+="</div>"},CBoardSelectorRender.prototype.initialize=function(e,t,a){var i=e.chartConfig.keys,r=e.groupSelects,o=e.originalData.columnList;return selectorRender(i,r,o,a,e),function(e,t,i,r){var o=e.chartConfig.keys,n=e.groupSelects,s=e.originalData.columnList;selectorRender(o,n,s,a,e)}};var discovery=angular.module("discovery",["gridster","ui.router","angular-md5","ui.bootstrap","ngSanitize","pascalprecht.translate","uuid4","ngSanitize","moment-picker"]);basePathUrl=getRootPath()+"/","http://localhost:4000/"!==basePathUrl&&(baseUrl=basePathUrl,socketUrl=basePathUrl),angular.module("discovery").constant("globalConfig",{api:{socket:socketUrl,baseUrl:baseUrl}}),angular.module("discovery").config(["$stateProvider",function(e){"ngInject";e.state("nv",{url:"/nv","abstract":!0,replace:!0,template:"<div ui-view></div>"}).state("nv.dashboard",{url:"/dashboard/{category}",params:{category:null},"abstract":!0,template:"<div ui-view></div>"}).state("nv.dashboard.view",{url:"/{id}",params:{id:null,param:[],history:[],screenHistory:[],role:!1},templateUrl:"src/view/nv/dashboard/view.html",controller:"NvDashboardViewCtrl"})}]),angular.module("discovery").factory("sessionHelper",["$rootScope","$q",function(e,t){var a={responseError:function(a){return 2==a.data.status&&e.alert&&e.alert(a.data.msg),t.reject(a)}};return a}]),angular.module("discovery").factory("baseUrlHelper",["$q","globalConfig",function(e,t){var a={request:function(a){return 0!==a.url.indexOf("http")&&a.url.indexOf(".do")!==-1&&(a.url=t.api.baseUrl+a.url),a||e.when(a)}};return a}]),angular.module("discovery").config(["$httpProvider",function(e){"ngInject";e.defaults.headers.put["Content-Type"]="application/x-www-form-urlencoded",e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",e.defaults.transformRequest=[function(e){var t=function a(e){var t,i,r,o,n,s,l,c="";for(t in e)if(i=e[t],i instanceof Array)for(var l=0;l<i.length;++l)n=i[l],r=t+"["+l+"]",s={},s[r]=n,c+=a(s)+"&";else if(i instanceof Object)for(o in i)n=i[o],r=t+"["+o+"]",s={},s[r]=n,c+=a(s)+"&";else void 0!==i&&null!==i&&(c+=encodeURIComponent(t)+"="+encodeURIComponent(i)+"&");return c.length?c.substr(0,c.length-1):c};return angular.isObject(e)&&"[object File]"!==String(e)?t(e):e}],e.interceptors.push("baseUrlHelper"),e.interceptors.push("sessionHelper")}]),angular.module("discovery").config(["$translateProvider","$translatePartialLoaderProvider",function(e,t){"ngInject";e.translations("cn",CB_I18N),e.preferredLanguage(settings.preferredLanguage)}]),angular.module("discovery").filter("trustAsResourceUrl",["$sce",function(e){"ngInject";return function(t){return e.trustAsResourceUrl(t)}}]),discovery.controller("discoveryCtrl",["$rootScope","$scope","$location","$http","$q","$filter","$uibModal","ModalUtils","menuDataService",function(e,t,a,i,r,o,n,s,l){"ngInject";var c=o("translate");e.alert=function(e){s.alert(e)};var d=function(){i.get("commons/getMenuList.do").success(function(e){t.menuList=e})},u=function(){i.get("dashboard/getCategoryList.do").success(function(e){t.categoryList=e})},f=function(){i.get("dashboard/getBoardList.do").success(function(e){t.boardList=e})};t.$on("boardChange",function(){f()}),t.$on("categoryChange",function(){u()}),t.isShowMenu=function(e){return!_.isUndefined(_.find(t.menuList,function(t){return t.menuCode==e}))},window.isPreview||(i.get("commons/getUserDetail.do").success(function(e){t.user=e;var a="imgs/user-male-circle-blue-128.png";t.user.avatar=a}),d(),u(),f()),t.changePwd=function(){n.open({templateUrl:"src/view/cboard/changePwd.html",windowTemplateUrl:"src/view/util/modal/window.html",backdrop:!1,size:"sm",controller:["$scope","$uibModalInstance",function(e,t){e.close=function(){t.close()},e.ok=function(){i.post("commons/changePwd.do",{curPwd:e.curPwd,newPwd:e.newPwd,cfmPwd:e.cfmPwd}).success(function(e){"1"==e.status?(s.alert(c("COMMON.SUCCESS"),"modal-success","sm"),t.close()):s.alert(e.msg,"modal-warning","lg")})}}]})}}]),discovery.service("dashboardService",["$http",function(e){"ngInject";this.boardData,this.saveWidget=function(e,t,a){var i={name:e,width:12,datasource:t,config:angular.copy(a)};if(this.boardData)this.boardData.rows.push({widgets:[i]}),this.saveThis();else{var r=this;this.get(function(e){e.rows.push({widgets:[i]}),r.saveThis()})}},this.saveThis=function(){e.post("dashboard/saveData.do",{json:angular.toJson(this.boardData)}).success(function(){})},this.save=function(t){e.post("dashboard/saveData.do",{json:angular.toJson(t)}).success(function(){})},this.get=function(t){var a=this;e.get("dashboard/getData.do").success(function(e){e||(e={rows:[]}),a.boardData=e,t(a.boardData)})}}]),discovery.service("dataService",["$http","$q","updateService","ComputedValueService","BoardParamService",function($http,$q,updateService,ComputedValueService,BoardParamService){"ngInject";function parserExp(e){var t=e,a=[],i=[];t=t.trim().replace(/[\n|\r|\r\n]/g,""),_.each(t.match(/".*?"/g),function(e){t=t.replace(e,"_#"+a.length),a.push(e)});var r=[];return _.each(t.match(/(sum|avg|count|max|min|distinct)\("?.*?"?\)/g),function(e){var o=e.substring(0,e.indexOf("(")),n=e.substring(e.indexOf("(")+1,e.indexOf(")"));n.match("_#")&&(n=a[n.replace("_#","")].replace(/\"/g,"")),t=t.replace(e,"groupData[_names["+r.length+"]]['"+o+"'][key]"),r.push(n),i.push({name:n,aggregate:o})}),{evalExp:t,aggs:i,names:r}}var dataSetMap={},tableDrill={},getDatasetList=function(e){var t=$q.defer(),a=dataSetMap[e];return _.isUndefined(a)?$http.get("dashboard/getDatasetById.do?id="+e).success(function(a){dataSetMap[e]=a[0],t.resolve(a[0])}):t.resolve(a),t.promise};this.getDatasetList=function(e){var t=$q.defer(),a="";_.each(e,function(e){dataSetMap[e],a+="id="+e+"&"});a.substring(0,a.length-1);return $.ajax({type:"POST",url:baseUrl+"dashboard/getDatasetByIdList.do",traditional:!0,data:{id:e,token:getQueryString("yili-token")},dataType:"json",async:!1}).success(function(e){_.each(e,function(e){_.isUndefined(dataSetMap[e.id])&&(dataSetMap[e.id]=e)}),t.resolve()}),t.promise},this.linkDataset=function(e,t){return linkDataset(e,t)};var linkDataset=function(e,t){if(_.isUndefined(e)||_.isUndefined(t)){var a=$q.defer();return a.resolve(),a.promise}return getDatasetList(e).then(function(e){var a=$q.defer();_.each(t.filters,function(t){if(t.group){var a=_.find(e.data.filters,function(e){return e.id==t.id});a&&(t.filters=a.filters,t.group=a.group)}}),_.each(t.values,function(t){_.each(t.cols,function(t){if("exp"==t.type){var a=_.find(e.data.expressions,function(e){return t.id==e.id});a&&(t.exp=a.exp,t.alias=a.alias)}})});var i=function(t){if(t.id){var a,i;_.each(e.data.schema.dimension,function(e){"level"==e.type?_.each(e.columns,function(r){r.id==t.id&&(i=r,a=e)}):t.id==e.id&&(i=e)}),i&&i.alias&&(t.alias=i.alias,a&&(t.level=a.alias))}};return _.each(t.keys,i),_.each(t.groups,i),a.resolve(e.data?e.data.schema:null),a.promise})},getDimensionConfig=function getDimensionConfig(array,schema){var result=[];return array&&_.each(array,function(e){if("computedDimension"==e.type){var setResult=function(e,t){(e.dependOn.indexOf(t.alias)>-1||e.dependOn.indexOf(t.column)>-1||e.formula2.indexOf(t.alias)>-1||e.formula2.indexOf(t.column)>-1)&&result.push({columnName:t.column,filterType:t.filterType?t.filterType:"eq",values:[],id:t.id,style:t.style?t.style:"string"})};_.each(schema.dimension,function(t){_.isArray(t.columns)?_.each(t.columns,function(t){setResult(e,t)}):setResult(e,t)})}else _.isUndefined(e.group)?result.push({columnName:e.col,filterType:e.type,values:e.values,id:e.id,style:e.style?e.style:"string"}):_.each(e.filters,function(f){var hasValue=!1;if(f.isExp&&f.exp){var reg=/\[&[^\]]+/g,argsList=f.exp.match(reg),allArgsHad=!0,exp=f.exp;if(argsList)for(var i=0;i<argsList.length;i++){var argName=argsList[i].substr(2),argValue=BoardParamService.get(argName);if("undefined"==typeof argValue){allArgsHad=!1;break}exp=exp.replace("[&"+argName+"]","("+argValue+")")}try{var expResult=eval(exp);hasValue=!0,result.push({columnName:f.col,filterType:f.type,values:[expResult],style:f.style?f.style:"string"})}catch(e){console.error("dataService:function-getDimensionConfig,row-111,eval(exp)执行错误",e)}}hasValue||result.push({columnName:f.col,filterType:f.type,values:f.values})})}),result};this.getDimensionValues=function(e,t,a,i,r,o){r=angular.copy(r),linkDataset(a,r).then(function(n){var s=void 0;r&&(s={rows:[],columns:[],filters:[]},s.rows=getDimensionConfig(r.keys,n),s.columns=getDimensionConfig(r.groups,n),s.filters=getDimensionConfig(r.filters,n)),$http.post("dashboard/getDimensionValues.do",{datasourceId:e,query:angular.toJson(t),datasetId:a,colmunName:i,cfg:angular.toJson(s)}).success(function(e){o(e)})})},this.getDataSeries=function(e,t,a,i,r,o,n){t.loadingCircle=!0,i=angular.copy(i),updateService.updateConfig(i),linkDataset(a,i).then(function(s){var l=ComputedValueService.precomputation(i,s);i.computedValue=l.values,i.computedKey=l.keys,i.computedGroup=l.groups,_.isUndefined(t.query)&&(t.query={}),n&&(t.query.param={},_.each(BoardParamService.getAll(),function(e,a){var i=_.find(t.paramList,function(e){return e.column==a});if(i)if("multiple"===i.selector){var r="'"+[e[0]].join("','")+"'";t.query.param[a]=r}else t.query.param[a]=e[0]}));var c=function(e,t){function a(e,t){var a=[];return _.each(e,function(e,i){i<=t&&a.push({columnName:e.col,filterType:e.type,values:e.values,id:e.id})}),a}var i={},r=e.keys,o=e.groups,n=[],s=e.drillTier;return i.rows=[],i.columns=[],_.each(r,function(e){if(_.isUndefined(e.drillDown))"computedDimension"==e.type?(_.each(t.dimension,function(t){(e.dependOn.indexOf(t.alias)>-1||e.dependOn.indexOf(t.column)>-1||e.formula2.indexOf(t.alias)>-1||e.formula2.indexOf(t.column)>-1)&&i.rows.push({columnName:t.column,filterType:t.filterType?t.filterType:"eq",values:[],id:t.id})}),i.rows=_.uniq(i.rows)):i.rows.push({columnName:e.col,filterType:e.type,values:e.values,id:e.id});else{var r=[];s.keyTier>0&&!s.isGreat&&_.each(e.drillDown.slice(0,s.keyTier),function(e,t){r.push({columnName:e.col,filterType:"=",values:s.filters.key[t]})}),n=n.concat(r),s.isGreat?i.rows=i.rows.concat(a(e.drillDown,s.keyTier)):i.rows.push({columnName:e.drillDown[s.keyTier].col,filterType:e.drillDown[s.keyTier].type,values:e.drillDown[s.keyTier].values,id:e.drillDown[s.keyTier].id})}}),_.each(o,function(e){if(_.isUndefined(e.drillDown))"computedDimension"==e.type?(_.each(t.dimension,function(t){(e.dependOn.indexOf(t.alias)>-1||e.dependOn.indexOf(t.column)>-1||e.formula2.indexOf(t.alias)>-1||e.formula2.indexOf(t.column)>-1)&&i.columns.push({columnName:t.column,filterType:t.filterType?t.filterType:"eq",values:[],id:t.id})}),i.columns=_.uniq(i.columns)):i.columns.push({columnName:e.col,filterType:e.type,values:e.values,id:e.id});else{var a=[];s.groupTier>0&&!s.isGreat&&_.each(e.drillDown.slice(0,s.groupTier),function(e,t){a.push({columnName:e.col,filterType:"=",values:s.filters.group[t]})}),n=n.concat(a),i.columns.push({columnName:e.drillDown[s.groupTier].col,filterType:e.drillDown[s.groupTier].type,values:e.drillDown[s.groupTier].values,id:e.drillDown[s.groupTier].id})}}),e.chart_type&&_.each(s.treeGridFilters,function(e,t){n.push({columnName:t,filterType:"=",values:e,style:"string"})}),i.filters=n,i},d=function(e){var t=e.rows,a=e.columns,i={},r=[];return _.each(t,function(e,t){i[e.columnName]=!0}),_.each(a,function(e,t){i[e.columnName]===!0&&r.push(t)}),_.each(r,function(e){a.splice(e,1)}),e},u=getDataSeries(i),f={rows:[],columns:[],filters:[]};if(f.rows=getDimensionConfig(i.keys,s),f.columns=getDimensionConfig(i.groups,s),f.filters=getDimensionConfig(i.filters,s),f.events=getDimensionConfig(i.events,s),f.filters=f.filters.concat(getDimensionConfig(i.boardFilters,s)),f.values=_.map(u,function(e){return{column:e.name,aggType:e.aggregate}}),0!=f.rows.length||0!=f.columns.length||0!=f.filters.length||0!=f.events.length||0!=f.filters.length||0!=f.values.length){var p=c(i,s);p.rows.length&&(f.rows=p.rows),p.columns.length&&(f.columns=p.columns),p.filters.length&&(f.filters=f.filters.concat(p.filters)),f=d(f);var g=t.query?t.query:{};"undefined"==typeof g.param&&(g.param={});var h=BoardParamService.getAll(),m={};for(var v in h){var y=h[v];_.isArray(y)&&0===y.length&&(y="'all'"),"all"===y?y="'all'":_.isArray(y)&&(y="'"+y.join("','")+"'"),m[v]=y}g.param=m,g.param.cols=[];var b={};f.rows.forEach(function(e){b[e.columnName]=!0}),f.columns.forEach(function(e){b[e.columnName]=!0});for(var v in b)g.param.cols.push(v);for(var w in f.filters)f.filters[w].style||(f.filters[w].style="string");for(var w in f.rows)f.rows[w].style||(f.rows[w].style="string");var C=[];if(f.rows)for(var w=0;w<f.rows.length;w++)if(f.rows[w].values&&f.rows[w].values.length>0){var x=f.rows[w].values;"string"==typeof x&&(x=[x]),C.push({name:f.rows[w].columnName,type:"=",value:x})}if(f.filters)for(var w=0;w<f.filters.length;w++){var S=f.filters[w],x=S.values;"string"==typeof x&&(x=[x]),C.push({name:S.columnName,type:S.filterType,value:x})}for(var w=0;w<C.length;w++)for(var k=0;k<C[w].value.length;k++)"string"==typeof C[w].value[k]&&(C[w].value[k]="'"+C[w].value[k]+"'");g.param.func_whrcols=C;try{i.option&&i.option.advancedOption&&$.extend(g,JSON.parse(i.option.advancedOption))}catch(T){console.error("advancedOption error",i.option.advancedOption)}g.param.func_grpcols=g.param.cols;for(var I in g.param)"-1"!==g.param[I]&&g.param[I]!==-1||(g.param[I]=void 0);$http.post("dashboard/getAggregateData.do",{datasourceId:e,query:angular.toJson(g),datasetId:a,cfg:angular.toJson(f),reload:o,cache:t.config.redis,token:getQueryString("yili-token")}).success(function(e){var o=ComputedValueService.replaceDisplay(e,i),n=castRawData2Series(o,i,t.wName);n.chartConfig=i,n.wName=t.wName,window.$$EXCEL||(window.$$EXCEL={}),_.isUndefined(a)?r(n):getDrillConfig(a,i).then(function(e){n.drill={config:e},tableDrill[t.wName]=n,r(n)}),t.loadingCircle=!1})}})},this.getDrillPath=function(e,t){var a=$q.defer();return getDatasetList(e).then(function(e){var i,r=[];_.each(e.data.schema.dimension,function(e){"level"==e.type&&_.each(e.columns,function(a){a.id==t&&(r=e.columns,i=e)})}),r=_.map(r,function(e){return{id:e.id,alias:e.alias,col:e.column,level:i.alias,type:"=",values:[],sort:"sort"}}),a.resolve(r)}),a.promise};var getDrillConfig=function(e,t){var a=$q.defer();return getDatasetList(e).then(function(e){var i={};if(!e.data.schema||0==e.data.schema.dimension.length)return a.resolve(i),a.promise;var r=function(t){_.each(t,function(a,r){var o,n,s,l;if(_.find(e.data.schema.dimension,function(e){if("level"==e.type)return _.find(e.columns,function(t,i){if(t.id==a.id)return o=e,n=i,s=e.id,l=e.columns,!0})}),o){var c=!1;r>0&&n>0&&(c=t[r-1].id==o.columns[n-1].id);var d=r>0,u=!1;r<t.length-1&&n<o.columns.length-1&&(u=t[r+1].id==o.columns[n+1].id);var f=n==o.columns.length-1,p=0,g=_.find(t,function(e,t){if(n<o.columns.length-1&&o.columns[n+1].id==e.id)return p=t,!0}),h=!g||p==r+1,m=n>0&&r>0&&c&&(r==t.length-1||!u)&&d,v=(u||!f)&&h;i[a.id]={up:m,down:v,dimensionId:s,length:l,index:n}}})};r(t.keys),r(t.groups),a.resolve(i)}),a.promise};this.viewQuery=function(e,t){e.config=angular.copy(e.config),updateService.updateConfig(e.config),linkDataset(e.datasetId,e.config).then(function(a){var i=getDataSeries(e.config),r={rows:[],columns:[],filters:[]};r.rows=getDimensionConfig(e.config.keys,a),r.columns=getDimensionConfig(e.config.groups,a),r.filters=getDimensionConfig(e.config.filters,a),r.filters=r.filters.concat(getDimensionConfig(e.config.boardFilters,a)),r.values=_.map(i,function(e){return{column:e.name,aggType:e.aggregate}}),$http.post("dashboard/viewAggDataQuery.do",{datasourceId:e.datasource,query:angular.toJson(e.query),datasetId:e.datasetId,cfg:angular.toJson(r)}).success(function(e){t(e[0])})})},this.getColumns=function(e){e.query=angular.copy(e.query),"undefined"==typeof e.query&&(e.query={}),e.query.param={},e.paramList&&e.paramList.paramList&&_.isArray(e.paramList.paramList)&&_.each(e.paramList.paramList,function(t){"multiple"==t.selector?e.query.param[t.column]="1":e.query.param[t.column]="1"}),$http.post("dashboard/getColumns.do",{datasourceId:e.datasource,query:e.query?angular.toJson(e.query):null,datasetId:e.datasetId,reload:e.reload}).success(function(t){e.callback(t)})},this.getColumnsByDatasetConfig=function(e){$http.get("dashboard/getDatasetById.do?id="+e.datasetId).success(function(t){e.callback(t[0])})};var getDataSeries=function(e){var t=[];return _.each(e.values,function(e){_.each(e.cols,function(e){var a=configToDataSeries(e);_.each(a,function(e){_.find(t,function(t){return JSON.stringify(t)==JSON.stringify(e)})||t.push(e)})})}),t},configToDataSeries=function(e){switch(e.type){case"exp":return getExpSeries(e.exp);case"computed":return getComputedSeries(e);default:return[{name:e.col||e.column,aggregate:e.aggregate_type||null}]}},getComputedSeries=function(e){var t=[];return _.each(e.dependOn,function(e){t.push({name:e.column,aggregate:e.aggType||"sum"})}),t},getExpSeries=function(e){return parserExp(e).aggs},filter=function(e,t){switch(e.f_type){case"=":case"eq":for(var a=0;a<e.f_values.length;a++)if(t==e.f_values[a])return!0;return 0==e.f_values.length;case"≠":case"ne":for(var a=0;a<e.f_values.length;a++)if(t==e.f_values[a])return!1;return!0;case">":var i=e.f_values[0],r=toNumber(t,i);return!(!_.isUndefined(i)&&r[0]<=r[1]);case"<":var i=e.f_values[0],r=toNumber(t,i);return!(!_.isUndefined(i)&&r[0]>=r[1]);case"≥":var i=e.f_values[0],r=toNumber(t,i);return!(!_.isUndefined(i)&&r[0]<r[1]);case"≤":var i=e.f_values[0],r=toNumber(t,i);return!(!_.isUndefined(i)&&r[0]>r[1]);case"(a,b]":var o=e.f_values[0],n=e.f_values[1],r=toNumber(t,o,n);return!(!_.isUndefined(o)&&!_.isUndefined(n)&&(r[0]<=r[1]||r[0]>r[2]));case"[a,b)":var o=e.f_values[0],n=e.f_values[1],r=toNumber(t,o,n);return!(!_.isUndefined(o)&&!_.isUndefined(n)&&(r[0]<r[1]||r[0]>=r[2]));case"(a,b)":var o=e.f_values[0],n=e.f_values[1],r=toNumber(t,o,n);return!(!_.isUndefined(o)&&!_.isUndefined(n)&&(r[0]<=r[1]||r[0]>=r[2]));case"[a,b]":var o=e.f_values[0],n=e.f_values[1],r=toNumber(t,o,n);return!(!_.isUndefined(o)&&!_.isUndefined(n)&&(r[0]<r[1]||r[0]>r[2]));default:return!0}},toNumber=function(){for(var e=_.isArray(arguments[0])?arguments[0]:arguments,t=[],a=0;a<e.length;a++){var i=Number(e[a]);if(isNaN(i))return e;t.push(i)}return t};this.toNumber=toNumber;var castRawData2Series=function(e,t,a){for(var i=new Array,r=new Array,o={},n={},s={},l=function(e,t){var a=new Array;if(t)for(var i=0;i<t.length;i++){var r=_.find(e,function(e){return e.name==t[i]});a.push(r.index)}return a},c=l(e.columnList,_.map(t.keys,function(e){return e.drillDown?e.drillDown[t.drillTier.keyTier].col:e.col||e.column})),d=_.map(t.keys,function(e){return e.sort}),u=l(e.columnList,_.map(t.groups,function(e){return e.drillDown?e.drillDown[t.drillTier.groupTier].col:e.col||e.column})),f=_.map(t.groups,function(e){return e.drillDown?e.drillDown[t.drillTier.groupTier].sort:e.sort}),p=_.filter(e.columnList,function(e){return e.aggType}),g=0;g<e.data.length;g++){var h=getRowElements(e.data[g],c),m=h.join("-");_.isUndefined(o[m])&&(i.push(h),o[m]=!0);var v=getRowElements(e.data[g],u),y=v.join("-");_.isUndefined(n[y])&&(r.push(v),n[y]=!0),_.each(p,function(t){_.isUndefined(s[y])&&(s[y]={}),_.isUndefined(s[y][t.name])&&(s[y][t.name]={}),_.isUndefined(s[y][t.name][t.aggType])&&(s[y][t.name][t.aggType]={}),"string"!=t.aggType?s[y][t.name][t.aggType][m]=parseFloat(e.data[g][t.index]):s[y][t.name][t.aggType][m]=e.data[g][t.index]})}var b=function(e){return function(t,a){for(var i=0,r=0;r<t.length;r++)if(e[r]){if(t[r]!=a[r]){var o=toNumber(t[r],a[r]);i=o[0]>o[1]?1:-1,"desc"==e[r]&&(i*=-1);break}i=0}return i}};i.sort(b(d)),r.sort(b(f));var w=new Array,C={},x=new Array,S=void 0,k=[];if(_.each(r,function(e){_.each(t.values,function(t){_.each(t.cols,function(t){_.isUndefined(S)&&t.sort&&(S=t.sort,castSeriesData(t,e.join("-"),i,s,function(e,t){k[t]={v:e,i:t}}))})})}),!_.isUndefined(S)){k.sort(function(e,t){if(e.v==t.v)return 0;var a=toNumber(e.v,t.v);return(_.isNaN(a[0])||_.isUndefined(a[0])||_.isNull(a[0])||a[0]===1/0||a[0]===-(1/0))&&(a[0]=-(1/0)),(_.isNaN(a[1])||_.isUndefined(a[1])||_.isNull(a[1])||a[1]===1/0||a[1]===-(1/0))&&(a[1]=-(1/0)),"asc"==S?a[0]-a[1]:a[1]-a[0]});var T=angular.copy(i);_.each(k,function(e,t){i[t]=T[e.i]})}_.each(r,function(e){_.each(t.values,function(t,a){_.each(t.cols,function(r){var o=r.alias?r.alias:r.col,n=o;if(e&&e.length>0){var l=[].concat(e);l.push(o),n=l.join("-"),w.push(l)}else w.push([o]);C[n]={type:t.series_type,valueAxisIndex:a,formatter:r.formatter,dataStyle:r.dataStyle?r.dataStyle:null},castSeriesData(r,e.join("-"),i,s,function(e,t){x[w.length-1]||(x[w.length-1]=new Array),x[w.length-1][t]=e})})})});for(var g=0;g<i.length;g++){var I=0,N=!0;_.each(r,function(e){_.each(t.values,function(e){_.each(e.cols,function(e){N&&(e.f_top&&e.f_top<=g&&(N=!1),filter(e,x[I][g])||(N=!1),N&&(x[I][g]=dataFormat(x[I][g])),I++)})})}),N||(i.splice(g,1),_.each(x,function(e){e.splice(g,1)}),g--)}var L=[];_.each(t.keys,function(e,t){1==e.hide&&L.push(t)}),L=L.reverse();for(var g=0;g<i.length;g++)for(var j=0;j<L.length;j++)i[g].splice(L[j],1);return{originalData:e,keys:i,series:w,data:x,seriesConfig:C}},castSeriesData=function(e,t,a,i,r){switch(e.type){case"exp":for(var o=compileExp(e.exp),n=0;n<a.length;n++)r(o(i[t],a[n].join("-")),n);break;case"computed":for(var n=0;n<a.length;n++)r(i[t][e.col||e.column][e.aggregate_type][a[n].join("-")],n);break;default:for(var n=0;n<a.length;n++)r(i[t][e.col][e.aggregate_type][a[n].join("-")],n)}},compileExp=function compileExp(exp){var parseredExp=parserExp(exp);return function(groupData,key){var _names=parseredExp.names;return eval(parseredExp.evalExp)}},aggregate=function(e,t){if(!e)return e;switch(t){case"sum":return aggregate_sum(e);case"count":return aggregate_count(e);case"avg":return aggregate_avg(e);case"max":return _.max(e,function(e){return parseFloat(e)});case"min":return _.min(e,function(e){return parseFloat(e)})}},aggregate_sum=function(e){for(var t=0,a=0;a<e.length;a++){var i=parseFloat(e[a]);i&&(t+=i)}return t},aggregate_count=function(e){return e.length},aggregate_avg=function(e){for(var t=0,a=0,i=0;i<e.length;i++){var r=parseFloat(e[i]);r&&(t+=r,a++)}return 0==a?0:t/a},getHeaderIndex=function(e,t){var a=new Array;if(t)for(var i=0;i<t.length;i++){var r=_.indexOf(e[0],t[i]);a.push(r)}return a},getRowElements=function(e,t){for(var a=new Array,i=0;i<t.length;i++){var r=e[t[i]];a.push(r)}return a};this.getTableDataDrillByWidget=function(){return tableDrill},this.getDatasetListMap=function(){return dataSetMap}}]),discovery.directive("dashboardWidget",["$compile","$templateCache","dataService","chartService",function(e,t,a,i){"ngInject";var r=function(a,i,r){var o=t.get("echartContent");a.myheight=a.row.height?a.row.height-44:300;var n=e(o);i.append(n(a));var s=$(i).find(".box-body");a.widget.render(s,null,a)},o=function(a,i,r){var o=t.get("chartContent");a.myheight=a.row.height?a.row.height-44:300;var n=e(o);i.append(n(a));var s=$(i).find(".box-body");a.widget.render(s,null,a)},n=function(a,i,r){var o=t.get("kpiContent"),n=e(o)(a);i.append(n);var s=$(i).find(".kpi-body");a.widget.render(s,null,a)},s=function(a,i,r){var o=t.get("selectorContent"),n=e(o)(a);i.append(n);var s=$(i).find(".box-body");a.widget.render(s,null,a)},l=function(a,i,r){var o=t.get("chartContent");a.myheight=a.row.height?a.row.height-44:500;var n=e(o)(a);i.append(n);var s=$(i).find(".box-body");a.widget.render(s,null,a)};return{restrict:"E",scope:!0,compile:function(e,t){return{pre:function(e,t,a){},post:function(e,t,a){switch(e.widget.widget.data.config.chart_type){case"line":r(e,t,a);break;case"line2":r(e,t,a);break;case"line3":r(e,t,a);break;case"pie":r(e,t,a);break;case"kpi":n(e,t,a);break;case"table":l(e,t,a);break;case"crossTable":l(e,t,a);break;case"treeGrid":l(e,t,a);break;case"crossGreatTable":l(e,t,a);break;case"selector":s(e,t,a);break;case"funnel":r(e,t,a);break;case"sankey":r(e,t,a);break;case"chord":r(e,t,a);break;case"radar":r(e,t,a);break;case"map":o(e,t,a);break;case"scatter":r(e,t,a);break;case"gauge":r(e,t,a);break;case"wordCloud":r(e,t,a);break;case"treeMap":r(e,t,a);break;case"areaMap":r(e,t,a);break;case"heatMapCalendar":r(e,t,a);break;case"heatMapTable":r(e,t,a);break;case"markLineMap":r(e,t,a);break;case"liquidFill":r(e,t,a)}}}}}}]),discovery.filter("hasBoards",function(){"ngInject";return function(e,t){if(void 0==t)return t;var a=t.map(function(e){return e.categoryId}),i=_.filter(e,function(e){return _.contains(a,e.id)});return i}}),discovery.filter("hasCategoryId",function(){"ngInject";return function(e){var t=[];if(!_.isUndefined(e))for(var a=0;a<e.length;a++)null==e[a].categoryId&&t.push(e[a]);return t}}),discovery.service("BoardParamService",["$http",function(e){"ngInject";window.$$dlut_param={},this.get=function(e,t){return"function"==typeof t&&t(window.$$dlut_param[e]),window.$$dlut_param[e]},this.set=function(e,t){_.isUndefined(window.$$dlut_param[e])&&(window.$$dlut_param[e]={}),window.$$dlut_param[e]=t},this.getAll=function(){return window.$$dlut_param},this.remove=function(e){delete window.$$dlut_param[e]},this.clear=function(){window.$$dlut_param={}}}]),discovery.service("ComputedValueService",["$q","BoardParamService",function($q,BoardParamService){"ngInject";function schemaComputedRender(computed,scomputed){var regCalc=/\[&[^\]]+\]/g,regFormula=/\[\$[^\]]+\]/g,preCalc=computed.preCalc,formula=computed.formula;if(preCalc){var regCalcArr=preCalc.match(regCalc);_.each(regCalcArr,function(e){var t=BoardParamService.get(e.substring(2,e.length-1));preCalc=preCalc.replace(e,'"'+t+'"')});try{computed.formula2=eval(preCalc)}catch(e){console.log("预处理公式错误:ComputedValueService:function-this.precomputation,row-8,eval(preCalc)执行错误",preCalc,computed.column,e)}}else computed.formula&&""!==computed.formula&&(computed.formula2=computed.formula);formula=computed.formula2?computed.formula2:"";var n=0,isWhile=!0;do{var regFormulaArr=formula.match(regFormula);regFormulaArr&&(isWhile=!1),_.each(regFormulaArr,function(e){var t=_.find(scomputed,function(t){return t.column==e.substring(2,e.length-1)});formula=formula.replace(e,t.formula2)}),computed.formula2=formula,n++}while(n<100&&isWhile)}function computedKeys(e,t){var a=/\[#[^\]^&^$]+/g;_.each(e,function(e){if(t.col==e.column||t.column==e.column){var i=e.formula2.match(a);t.dependOn=[],t.formula2=e.formula2,_.each(i,function(e){var a=e.substring(2),i=a.split(":"),r=null;if(i.length>1)r=i[1];else{if(1!==i.length)return;r=i[0]}r&&!_.find(t.dependOn,function(e){return e.column==r})&&t.dependOn.push({column:r})})}})}function computedValues(e,t,a){var i=/\[#[^\]^&^$]+/g,r=/(TOTAL|RANK|RUNNING_SUM|MAX|MIN)\([^\(^)]+/g;_.each(e,function(e){if(t.col==e.column||t.column==e.column){var o=e.formula2.match(i),n=e.formula2.match(r);if(t.aggregate_type="sum",t.aggType=e.aggType,t.dependOn=[],t.dependOnFun={},t.formula2=e.formula2,_.each(o,function(e){var a=e.substring(2),i=a.split(":"),r=null,o=null;if(i.length>1)r=i[1],o=i[0];else{if(1!==i.length)return;r=i[0],o="sum"}r&&o&&!_.find(t.dependOn,function(e){return e.column==r})&&t.dependOn.push({column:r,aggType:o})}),_.isArray(n))for(var s=0;s<n.length;s++){var l=n[s].replace(/[\'\"]/g,""),c=l.match(/[^(^,]+/g);"undefined"==typeof c[2]&&(c[2]="sum"),_.isUndefined(_.find(t.dependOn,function(e){return e.column==c[1]}))&&t.dependOn.push({column:c[1],aggType:c[2]}),a&&a.dependOnFun&&("undefined"==typeof a.dependOnFun[c[0]]&&(a.dependOnFun[c[0]]=[]),a.dependOnFun[c[0]].push({fun:c[0],column:c[1],aggType:c[2],extend:c[3]}))}}})}function displayComputedKeys(e,t,a,i,r){_.each(e,function(a){_.each(t,function(t,i){var r=_.find(a.dependOn,function(e){return e.column==t.name});r&&(_.find(e,function(e){return r==e.col||r==e.column})?t["delete"]=!1:t["delete"]=!0)})}),_.each(e,function(e){_.isUndefined(e.formula2)||(_.each(a,function(t){var a=0,o=!0,n=e.formula2;do{var s=n.match(r);s||(o=!1),_.each(s,function(e){var a=e.substring(2,e.length-1);_.isUndefined(i[a])||(n=n.replace(e,t[i[a]]))}),e.formula3=n,a++}while(a<100&&o);try{t.push(e.formula3)}catch(l){console.log("ComputedValueService:function-displayComputedValues,row-197,eval(c.formula3)执行错误",e.formula3,e.column,l)}}),a.length>0&&t.push({index:a[0].length-1,aggType:null,name:e.col||e.column}))})}function displayComputedValues(computedValues,columns,oData,columnIndexMap,reg){for(var i=0;i<computedValues.length;i++)for(var cv=computedValues[i],j=0;j<cv.cols.length;j++){var c=cv.cols[j];if(c.aggregate_type=c.aggType?c.aggType:c.aggregate_type,_.each(columns,function(e,t){var a=_.find(c.dependOn,function(t){return t.column==e.name});a&&(_.find(cv.cols,function(e){return a==e.col||a==e.column})?e["delete"]=!1:e["delete"]=!0)}),!_.isUndefined(c.formula2)){for(var k=0;k<oData.length;k++){var data=oData[k],n=0,isWhile=!0,cFormula2=c.formula2;do{var regValues=cFormula2.match(reg);regValues||(isWhile=!1),_.each(regValues,function(e){var t=e.substring(2,e.length-1);columnIndexMap[t]&&(cFormula2=cFormula2.replace(e,data[columnIndexMap[t]]))}),c.formula3=cFormula2,n++}while(n<100&&isWhile);try{colData=data,c.formula3=eval(c.formula3),data.push(c.formula3)}catch(e){console.log("ComputedValueService:function-displayComputedValues,row-197,eval(c.formula3)执行错误",c.formula3,c.column,e)}}oData.length>0&&columns.push({index:oData[0].length-1,aggType:c.aggType,name:c.col||c.column})}}}function TOTAL(e,t){try{"undefined"==typeof t&&(t="sum");var a=this.funCacheMap.indexMap[t+":"+e];return this.funCacheMap.TOTAL[a]}catch(i){return console.error("TOTAL ERROR"),0}}function MAX(e,t){try{"undefined"==typeof t&&(t="sum");var a=this.funCacheMap.indexMap[t+":"+e];return this.funCacheMap.MAX[a]}catch(i){return console.error("MAX ERROR"),0}}function MIN(e,t){try{"undefined"==typeof t&&(t="sum");var a=this.funCacheMap.indexMap[t+":"+e];return this.funCacheMap.MIN[a]}catch(i){return console.error("MIN ERROR"),0}}function RANK(e,t,a){try{"undefined"==typeof t&&(t="sum"),"undefined"==typeof a&&(a="desc");var i=this.funCacheMap.indexMap[t+":"+e];return this.funCacheMap.RANK[a+i][parseFloat(this.colData[i])]}catch(r){return console.error("RANK ERROR"),
0}}function RUNNING_SUM(e,t){try{"undefined"==typeof t&&(t="sum");var a=this.funCacheMap.indexMap[t+":"+e];return this.funCacheMap.RUNNING_SUM[a]+=parseFloat(colData[a]),this.funCacheMap.RUNNING_SUM[a]}catch(i){return console.error("RUNNING_SUM ERROR"),0}}this.precomputation=function(e,t){var a=e.values,i=e.keys,r=e.groups;if(_.isUndefined(t.computed)&&_.isUndefined(t.computedDimension))return!1;var o=!1,n=!1,s=!1;return _.each(a,function(e){_.each(e.cols,function(e){_.find(t.computed,function(t){return t.column==e.column||t.column==e.col})&&(e.isComputed=!0,o=!0)})}),_.each(i,function(e){_.find(t.computedDimension,function(t){return t.column==e.column||t.column==e.col})&&(e.isComputed=!0,n=!0)}),_.each(r,function(e){_.find(t.computedDimension,function(t){return t.column==e.column||t.column==e.col})&&(e.isComputed=!0,s=!0)}),!!(o||n||s)&&(_.each(t.computedDimension,function(e){schemaComputedRender(e,t.computedDimension)}),_.each(t.computed,function(e){schemaComputedRender(e,t.computed)}),_.each(i,function(e){e.isComputed&&computedKeys(t.computedDimension,e)}),_.each(r,function(e){e.isComputed&&computedKeys(t.computedDimension,e)}),e.dependOnFun={},_.each(a,function(a){_.each(a.cols,function(a){a.isComputed&&computedValues(t.computed,a,e)})}),e)},this.replaceDisplay=function(e,t){for(var a=e.columnList,i=e.data,r={},o=t.computedValue,n=t.computedKey,s=t.computedGroup,l=0;l<a.length;l++){var c=a[l],d=c.aggType?c.aggType+":":"";r[d+c.name]=c.index,"sum:"===d&&(r[c.name]=c.index)}if(t.option&&t.option.total&&i.length>0){for(var u=(i[0],[]),f=0,l=0;l<a.length;l++)if(null!==a[l].aggType){for(var p=0,g=0;g<i.length;g++){var h=parseFloat(i[g][l]);_.isNaN(h)||(p+=h)}u.push(p)}else f=l,u.push("");u[f]="总计",i.push(u)}if(funCacheMap={TOTAL:{},RUNNING_SUM:{},RANK:{},MAX:{},MIN:{},indexMap:r},t.dependOnFun){var p=t.dependOnFun.TOTAL;if(p&&p.length>0)for(var l=0;l<p.length;l++){for(var m=p[l],v=r[m.aggType+":"+m.column],y=0,g=0;g<i.length;g++){var h=parseFloat(i[g][v]);h&&(y+=h)}funCacheMap.TOTAL[v]=y}var b=t.dependOnFun.MAX;if(b&&b.length>0)for(var l=0;l<b.length;l++){for(var m=b[l],v=r[m.aggType+":"+m.column],w=0,g=0;g<i.length;g++){var C=parseFloat(i[g][v]);C>w&&(w=C)}funCacheMap.MAX[v]=w}var x=t.dependOnFun.MIN;if(x&&x.length>0)for(var l=0;l<x.length;l++){for(var m=x[l],v=r[m.aggType+":"+m.column],S=1/0,g=0;g<i.length;g++){var C=parseFloat(i[g][v]);C<S&&(S=C)}funCacheMap.MIN[v]=S}var k=t.dependOnFun.RUNNING_SUM;if(k&&k.length>0)for(var l=0;l<k.length;l++){var m=k[l],v=r[m.aggType+":"+m.column];funCacheMap.RUNNING_SUM[v]=0}var T=t.dependOnFun.RANK;if(T&&T.length>0)for(var l=0;l<T.length;l++){for(var m=T[l],v=r[m.aggType+":"+m.column],I=m.extend?m.extend:"desc",N=[],g=0;g<i.length;g++)N.push(parseFloat(i[g][v]));var L=function(e,t){return e<t};"asc"===I&&(L=function(e,t){return e>t}),N=N.sort(L);for(var j={},g=N.length-1;g>=0;g--)j[parseFloat(N[g])]=g+1;funCacheMap.RANK[I+v]=j}}var $=/\[[^\]^&^$]+\]/g;return _.isArray(o)&&displayComputedValues(o,a,i,r,$),_.isArray(n)&&displayComputedKeys(n,a,i,r,$),_.isArray(s)&&displayComputedKeys(s,a,i,r,$),colData=void 0,funCacheMap=void 0,{columnList:a,data:i}}}]),discovery.service("menuDataService",function(){"ngInject";this.handlePath=function(e){var t=e.split("/"),a="";for(var i in t)i>0&&i!==JSON.stringify(t.length-1)?a=a+t[i]+"/":i===JSON.stringify(t.length-1)&&(a+=t[i]);return a},this.buildTree=function(e,t,a){if(e){if(null==e.categoryName){var i={};return i.name=e.name,i.type="file",i.id=e.id,i.children=[],void a.push(i)}if(e.categoryName.indexOf("/")!==-1){if(0===t.length){var r={};return r.name=e.categoryName.split("/")[0],r.type="folder",r.id=e.id,r.children=[],t.push(r),e.categoryName=this.handlePath(e.categoryName),void this.buildTree(e,t[t.length-1].children,a)}for(j in t){if(e.categoryName.split("/")[0]===t[j].name)return e.categoryName=this.handlePath(e.categoryName),void this.buildTree(e,t[j].children,a);if(j===JSON.stringify(t.length-1)){var r={};return r.name=e.categoryName.split("/")[0],r.type="folder",r.id=e.id,r.children=[],t.push(r),e.categoryName=this.handlePath(e.categoryName),void this.buildTree(e,t[t.length-1].children,a)}}}else{var r={};if(0===t.length){r.name=e.categoryName,r.type="folder",r.id=e.id,r.children=[];var o={};return o.name=e.name,o.type="file",o.id=e.id,o.children=[],r.children.push(o),void t.push(r)}for(var n in t){if(e.categoryName===t[n].name)return r.name=e.name,r.type="file",r.id=e.id,r.children=[],void t[n].children.push(r);if(n===JSON.stringify(t.length-1)){r.name=e.categoryName,r.type="folder",r.id=e.id,r.children=[];var o={};return o.name=e.name,o.type="file",o.id=e.id,o.children=[],r.children.push(o),void t.push(r)}}}}}});var chartDataProcess=function(e,t,a,i,r,o,n){var s=t,l=[],c=[],d=e.keys.length,u=s[0]?s[0].length:0,f=e.values[0].cols;Array.matrix=function(e,t,a){for(var i=[],r=0;r<e;++r){for(var o=[],n=0;n<t;++n)o[n]=a;i[r]=o}return i};for(var p=Array.matrix(s.length,u,0),g=0;g<u;g++)for(var h=0;h<s.length;h++)p[h][g]={property:"column_key",data:s[h][g]};for(var m=0;m<a.length;m++)for(var v=a[m].join("-"),y=r[v].formatter,b=r[v].dataStyle,w=0;w<t.length;w++)if(_.isUndefined(i[m][w]))p[w][m+d]={property:"data",data:"",showType:b?b.type:null,showNum:b?b.num:null};else{var C=i[m][w];p[w][m+d]={property:"data",data:y?numbro(C).format(y):C,raw:C,showType:b?b.type:null,showNum:b?b.num:null}}for(var x=Array.matrix(e.groups.length+1,a.length,0),S=0;S<a.length;S++)for(var v=a[S].join("-"),y=r[v].formatter,b=r[v].dataStyle,k=0;k<a[S].length;k++)x[k][S]={property:"header_key",data:a[S][k],sort:f[S]?f[S].sort:"sort",width:f[S]?f[S].width:null,showType:b?b.type:null,showNum:b?b.num:null};for(var T=0;T<d;T++)l.push({property:"header_key",column_header_header:!0,data:e.keys[T].alias?e.keys[T].alias:e.keys[T].col,width:e.keys[T].width,id:e.keys[T].id}),c.push({property:"header_empty",data:null});for(var w=0;w<x.length;w++)w==x.length-1?x[w]=l.concat(x[w]):x[w]=c.concat(x[w]);var I=x.concat(p),N={chartConfig:e,data:I,originalData:o,wName:n};return p=null,x=null,N};discovery.service("chartFunnelService",["EventService",function(e){"ngInject";this.instance=null,this.render=function(t,a,i,r,o,n){return this.instance=new CBoardEChartRender(t,a,(void 0),n),this.instance.chart(null,r,e)},this.parseOption=function(e){var t=e.chartConfig,a=e.keys,i=e.series,r=e.data,o=(e.seriesConfig,e.chartConfig.option.tooltip),n=e.chartConfig.keys;for(var s in n)o[n[s].col]?o[n[s].col].col||(o[n[s].col].col=n[s].col):o[n[s].col]={col:n[s].col,isShow:!0,formatter:""};var l=e.chartConfig.option.tooltipTarget?e.chartConfig.option.tooltipTarget:{};for(var c in e.chartConfig.values){var d=e.chartConfig.values[c].cols;for(var u in d)l[d[u].col]?l[d[u].col].col||(l[d[u].col].col=d[u].col):l[d[u].col]={col:d[u].col,isShow:!0,formatter:""}}for(var f=_.map(a,function(e){return e.join("-")}),p=_.map(i,function(e){return e.join("-")}),g=[],h=100/(9*f.length+1),m=[],v=0;v<f.length;v++){var y={name:f[v],type:"funnel",left:h+v*h*9+"%",width:8*h+"%",maxSize:"100%",minSize:"10%",label:{normal:{formatter:function(e){return e.value+"\n"+e.data.percent+"%"},show:!0,position:"inside"}},data:[]};m.push({textAlign:"center",textStyle:{fontSize:12,fontWeight:"normal"},text:f[v],left:5*h+9*v*h+"%",top:"90%"});for(var b=_.max(r,function(e){return Number(e[v])})[v],w=0;w<p.length;w++){var C=CBoardEChartRenderEventInfo(e,v,w);y.data.push({eventInfo:C,name:p[w],value:r[w][v],percent:(r[w][v]/b*100).toFixed(2)})}g.push(y)}var x={title:m,legend:{data:p},tooltip:{trigger:"item",formatter:function(e){return e.seriesName+" <br/>"+e.name+" : "+e.value+"<br>"+e.data.percent+"%"}},toolbox:!1,series:g};return updateEchartOptions(t.option,x),x}}]),discovery.service("chartKpiService",["dataService","$compile","$filter",function(e,t,a){"ngInject";var i=a("translate");this.render=function(e,a,i,r){var o=new CBoardKpiRender(e,a),n=o.html(r);return i?e.append(t(n)(i)):e.html(n),o.realTimeTicket()},this.parseOption=function(e){var t={},a=e.chartConfig,r=(e.keys,e.series,e.data);e.seriesConfig;if(t.kpiValue=r.length>0?r[0][0]:"0",a.values[0].format&&(t.kpiValue=numbro(t.kpiValue).format(a.values[0].format)),t.kpiName=a.values[0].name,t.style=a.values[0].style,t.edit=i("COMMON.EDIT"),t.refresh=i("COMMON.REFRESH"),t.icon=a.values[0].icon,a.values[0].cols[0].unit)if("元"==a.values[0].cols[0].unit||"万"==a.values[0].cols[0].unit||"亿"==a.values[0].cols[0].unit){if(r.length>0){var o=dlut.utils.convertMoney(t.kpiValue,a.values[0].cols[0].unit);t.kpiValue=o.substr(0,o.length-1),t.unit=o.substr(o.length-1,o.length)}}else t.unit=a.values[0].cols[0].unit;else t.unit="";return t.align=a.values[0].align?a.values[0].align:"textLeft",t}}]),discovery.service("chartLineMapService",["$filter","EventService","uuid4",function(e,t,a){"ngInject";this.instance=null,this.render=function(e,a,i,r,o,n){return this.instance=new CBoardEChartRender(e,a,(void 0),n),this.instance.chart(null,r,t)},this.parseOption=function(e){for(var t=e.chartConfig,a=e.keys,i=(e.series,e.data,e.seriesConfig,new Array,_.map(a,function(e){return e.join("-")}),["startLongitude","startLatitude","startLabel","startMeans","startType","pointId"]),r=["endLongitude","endLatitude","endLabel","endMeans","endType","lineMeans","lineType"],o=["startValue","endValue","lineValue"],n=t.keys,s=t.groups,l=t.values,c=e.originalData.data,d=[],u=0;u<c.length;u++){for(var f={},p=c[u],g=0,h=0;h<s.length;h++)f[r[h]]=p[g],g++;for(var m=0;m<n.length;m++)f[i[m]]=p[g],g++;for(var v=0;v<l.length;v++)f[o[v]]=p[g],g++;d.push(f)}for(var y=["#ffad3d","#00ac57","#d3133e","#2489b0","#5bc0de","#c2ced1","rgba(255, 26, 0, 0.5)","rgba(36, 128, 0, 0.6)"],b=[],w=[],C={"default":{color:y[5],width:1,opacity:.6,curveness:.2},"试验":{color:y[0],width:1,opacity:.6,curveness:.2},"任务":{color:y[1],width:1,opacity:.6,curveness:.2},"事件":{color:y[2],width:1,opacity:.6,curveness:.2},"国际大事":{color:y[3],width:1,opacity:.6,curveness:.2},"装备调配":{color:y[4],width:1,opacity:.6,curveness:.2},red:{color:"red",width:1,opacity:.6,curveness:.2},green:{color:"#1ed107",width:1,opacity:.6,curveness:.2}},x={"default":{color:y[5],width:1,opacity:.6,curveness:.2},"试验":{color:y[0],width:1,opacity:.6,curveness:.2},"任务":{color:y[1],width:1,opacity:.6,curveness:.2},"事件":{color:y[2],width:1,opacity:.6,curveness:.2},"国际大事":{color:y[3],width:1,opacity:.6,curveness:.2},"装备调配":{color:y[4],width:1,opacity:.6,curveness:.2}},u=0;u<d.length;u++){var v=d[u];"-"!=v.endMeans&&""!=v.endMeans&&(w.push({lineStyle:{normal:C["-"!=v.lineType?v.lineType:"default"]},fromName:v.startMeans,toName:v.endMeans?v.endMeans:"-",coords:[[v.startLongitude,v.startLatitude],[v.endLongitude?v.endLongitude:"-",v.endLatitude?v.endLatitude:"-"]]}),b.push({lineStyle:{normal:x["-"!=v.lineType?v.lineType:"default"]},fromName:v.startMeans,toName:v.endMeans?v.endMeans:"-",coords:[[v.startLongitude,v.startLatitude],[v.endLongitude?v.endLongitude:"-",v.endLatitude?v.endLatitude:"-"]]}))}var S=function(){var e=[],t={"default":{symbol:null},"试验":{itemStyle:{normal:{color:y[0]}}},"低完好率":{itemStyle:{normal:{color:y[5]}}},"高完好率":{itemStyle:{normal:{color:y[6]}}},"任务":{itemStyle:{normal:{color:y[1]}}},"事件":{itemStyle:{normal:{color:y[2]}}},"国际大事":{itemStyle:{normal:{color:y[3]}}},"装备调配":{itemStyle:{normal:{color:y[4]}}},red:{symbol:"image://theme/theme_Beili01/images/red.png",symbolSize:20,label:{normal:{textStyle:{color:"red"}}}},green:{symbol:"image://theme/theme_Beili01/images/green.png",symbolSize:10,label:{normal:{textStyle:{color:"#1ed107"}}}},yellow:{symbol:"image://theme/theme_Beili01/images/yellow.png",symbolSize:15,label:{normal:{textStyle:{color:"yellow"}}}}},a=_.groupBy(d,"startType"),r={red:"告警",green:"良好",yellow:"关注"};for(var o in a){for(var s={type:"effectScatter",coordinateSystem:"geo",zlevel:2,label:{normal:{show:!0,position:"right",formatter:function(e){var t="";return"-"!==e.data.value[3]&&e.data.value[3]&&(t=e.data.value[3]),t},textStyle:{fontSize:18}}},symbolSize:15},l=[],c=0;c<a[o].length;c++){for(var u=a[o][c],f=[],p=0;p<i.length;p++){var g=i[p],h=n[p];h&&f.push({col:h.col,alias:h.alias,value:u[g]})}l.push($.extend({eventInfo:f,name:u.startMeans?u.startMeans:"-",value:[u.startLongitude,u.startLatitude,parseInt(u.startValue),u.startLabel]},t["-"!=o?o:"default"]))}s.data=l,s.name=r["-"!=o?o:"default"],"red"!=o&&(s.rippleEffect={scale:0}),e.push(s)}return e},k=function(){for(var e=[],t=[],a=0;a<t.length;a++)e.push({type:"lines",coordinateSystem:"geo",data:[{coords:t[a]}],polyline:!0,lineStyle:{normal:{color:"white",opacity:1,width:3}}});return e},T="path://M1705.06,1318.313v-89.254l-319.9-221.799l0.073-208.063c0.521-84.662-26.629-121.796-63.961-121.491c-37.332-0.305-64.482,36.829-63.961,121.491l0.073,208.063l-319.9,221.799v89.254l330.343-157.288l12.238,241.308l-134.449,92.931l0.531,42.034l175.125-42.917l175.125,42.917l0.531-42.034l-134.449-92.931l12.238-241.308L1705.06,1318.313z",I=[{type:"lines",zlevel:1,effect:{show:!0,period:6,trailLength:.7,color:"#fff",symbolSize:3},data:b},{type:"lines",symbol:["none","arrow"],symbolSize:10,effect:{show:!0,period:6,trailLength:0,symbol:T,symbolSize:30},data:w}];I=I.concat(I,S(),k());var N=t.option;if(N){var L,j;N.ctgLabelInterval?L=N.ctgLabelInterval:"auto",N.ctgLabelRotate?j=N.ctgLabelRotate:0}var A="data:image/png;base64,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",O=new Image;
O.src=A;var M={backgroundColor:"rgba(0,0,0,0)",legend:{show:!0,orient:"vertical",top:"top",left:"left",data:[{name:"告警",icon:"image://theme/theme_Beili01/images/red.png"},{name:"关注",icon:"image://theme/theme_Beili01/images/yellow.png"},{name:"良好",icon:"image://theme/theme_Beili01/images/green.png"}],itemWidth:20,itemHeight:20},tooltip:{trigger:"item",formatter:function(e){if("effectScatter"==e.seriesType){var t="";return t+=e.data.name+"<br>经度："+e.data.value[0]+"<br>纬度："+e.data.value[1]}if("lines"==e.seriesType){var t="";return e.data.fromName&&e.data.toName&&(t+=e.data.fromName+"->"+e.data.toName),t}},extraCssText:"text-align: left"},geo:{map:"china",label:{emphasis:{show:!1}},roam:!0,itemStyle:{normal:{areaColor:"#06535f",borderColor:"#e0ffff",borderWidth:1},emphasis:{areaColor:"#2a333d"}}},series:I};return updateEchartOptions(N,M),M}}]),discovery.service("chartLineService",["BoardParamService","EventService",function(BoardParamService,EventService){"ngInject";this.instance=null,this.render=function(e,t,a,i,r,o){return this.instance=new CBoardEChartRender(e,t,(void 0),o),this.instance.chart(null,i,EventService)},this.parseOption=function(data){for(var i=0;i<data.data.length;i++)for(var itemData=data.data[i],_j3=0;_j3<itemData.length;_j3++)(_.isNaN(itemData[_j3])||itemData[_j3]===1/0)&&(itemData[_j3]="-");var chartConfig=data.chartConfig,casted_keys=data.keys,casted_values=data.series,aggregate_data=data.data,newValuesConfig=data.seriesConfig,tooltip={},Levi=data.chartConfig.option.tooltip?data.chartConfig.option.tooltip:{},keys=data.chartConfig.keys;for(var _i4 in keys)_.isUndefined(Levi)||(Levi[keys[_i4].col]?(tooltip[keys[_i4].col]=Levi[keys[_i4].col],Levi[keys[_i4].col].col||(tooltip[keys[_i4].col].col=keys[_i4].col)):tooltip[keys[_i4].col]={col:keys[_i4].col,isShow:!0,formatter:""});for(var tooltipTarget={},Target=data.chartConfig.option.tooltipTarget?data.chartConfig.option.tooltipTarget:{},targetValue={},_j4=0;_j4<data.chartConfig.values.length;_j4++)for(var _k=0;_k<data.chartConfig.values[_j4].cols.length;_k++)targetValue[data.chartConfig.values[_j4].cols[_k].alias]={col:data.chartConfig.values[_j4].cols[_k].alias};if(!_.isUndefined(Target))for(var _i5 in targetValue)tooltipTarget[_i5]=Target[_i5],Target[_i5]?tooltipTarget[_i5]={col:Target[_i5].col?Target[_i5].col:_i5,isShow:!Target[_i5]||Target[_i5].isShow,formatter:Target[_i5]&&Target[_i5].formatter?Target[_i5].formatter:""}:tooltipTarget[_i5]={col:_i5,isShow:!Target[_i5]||Target[_i5].isShow,formatter:""};for(var tooltipGroups={},Groups=data.chartConfig.option.tooltipGroups,targetGroups=data.chartConfig.groups,_i6=0;_i6<targetGroups.length;_i6++)Groups[targetGroups[_i6].col]?(tooltipGroups[targetGroups[_i6].col]=Groups[targetGroups[_i6].col],Groups[targetGroups[_i6].col].col||(tooltipGroups[targetGroups[_i6].col].col=targetGroups[_i6].col)):tooltipGroups[targetGroups[_i6].col]={col:targetGroups[_i6].col,isShow:!0,formatter:""};for(var series_data=new Array,string_keys=_.map(casted_keys,function(e){return e.join("-")}),tunningOpt=chartConfig.option,sum_data=[],j=0;aggregate_data[0]&&j<aggregate_data[0].length;j++){for(var sum=0,i=0;i<aggregate_data.length;i++)sum+=aggregate_data[i][j]?Number(aggregate_data[i][j]):0,aggregate_data[i][j]=aggregate_data[i][j]?Number(aggregate_data[i][j]):0;sum_data[j]=sum}for(var unitList=[],i=0;i<chartConfig.values.length;i++)for(var unit=chartConfig.values[i].unit?chartConfig.values[i].unit:"",j=0;j<chartConfig.values[i].cols.length;j++)unitList.push(unit);for(var newunitList=[],length=data.series.length/unitList.length,i=0;i<length;i++)newunitList=newunitList.concat(unitList);for(var pubuArr=[],i=0;i<aggregate_data.length;i++){var joined_values=casted_values[i].join("-"),s=angular.copy(newValuesConfig[joined_values]);s.name=joined_values,s.data=aggregate_data[i],s.barMaxWidth=40,_.isUndefined(chartConfig.option.barWidth)||""==chartConfig.option.barWidth||(s.barWidth=chartConfig.option.barWidth),"stackbar"==s.type?(s.type="bar",s.stack=s.valueAxisIndex.toString()):"percentbar"==s.type?(s.data=_.map(aggregate_data[i],function(e,t){return[t,parseFloat((e/sum_data[t]*100).toFixed(2)),e]}),s.type="bar",s.stack=s.valueAxisIndex.toString()):"stackline"==s.type?(s.type="line",s.stack="normal",s.areaStyle={normal:{}}):"oneLineBar"==s.type?(s.type="custom",s.renderItem=renderAverageItem):"waterFall"==s.type&&(s.type="bar",s.waterFall=!0,s.stack=s.valueAxisIndex.toString()),"horizontal"==chartConfig.valueAxis?s.xAxisIndex=s.valueAxisIndex:s.yAxisIndex=s.valueAxisIndex;for(var newData=[],unit=newunitList[i],newUnit="",j=0;j<s.data.length;j++){var eventInfo=CBoardEChartRenderEventInfo(data,i,j),obj={eventInfo:eventInfo,value:s.data[j],unit:""==newUnit?unit:newUnit};newData.push(obj)}s.data=newData,s.waterFall?pubuArr.push(s):series_data.push(s)}if(pubuArr.length>0){var serie={name:"辅助isAssist",isAssist:!0,type:"bar",stack:"",itemStyle:{normal:{barBorderColor:"rgba(0,0,0,0)",color:"rgba(0,0,0,0)"},emphasis:{barBorderColor:"rgba(0,0,0,0)",color:"rgba(0,0,0,0)"}},data:[]},dataArr=[];for(var i in pubuArr){serie.stack=pubuArr[i].stack,serie.yAxisIndex=pubuArr[i].yAxisIndex;for(var j in pubuArr[i].data)void 0===dataArr[j]&&(dataArr[j]=pubuArr[i].data[j].value)}for(var i=0;i<dataArr.length;i++)0===i?serie.data[i]=0:(serie.data[i]=serie.data[i-1]+dataArr[i-1],dataArr[i]<0&&(serie.data[i]=serie.data[i-1]+dataArr[i]));for(var i=0;i<series_data.length;i++){var totalData={};series_data[i].data.length>0&&(totalData=angular.copy(series_data[i].data[0]),totalData.eventInfo[0].value="总计"),totalData.value=0;for(var j=0;j<series_data[i].data.length;j++)totalData.value+=series_data[i].data[j].value;series_data[i].data.push(totalData)}for(var i=0;i<pubuArr.length;i++){for(var total=0,j=0;j<pubuArr[i].data.length;j++)total+=pubuArr[i].data[j].value,pubuArr[i].data[j].value<0?(pubuArr[i].data[j].value=Math.abs(pubuArr[i].data[j].value),_.isUndefined(pubuArr[i].data[j].itemStyle)?pubuArr[i].data[j].itemStyle={color:"red"}:pubuArr[i].data[j].itemStyle.color="red"):pubuArr[i].data[j].isPositive=!0;pubuArr[i].data[pubuArr[i].data.length]=angular.copy(pubuArr[i].data[pubuArr[i].data.length-1]),pubuArr[i].data[pubuArr[i].data.length-1].value=total,pubuArr[i].data[pubuArr[i].data.length-1].eventInfo[0].value="总计",pubuArr[i].data[pubuArr[i].data.length-1].itemStyle?pubuArr[i].data[pubuArr[i].data.length-1].itemStyle.color="#59A14F":pubuArr[i].data[pubuArr[i].data.length-1].itemStyle={color:"#59A14F"},string_keys.push("总计")}series_data.push(serie),series_data=series_data.concat(pubuArr)}var position={};!_.isUndefined(chartConfig.option.label);var top_bottom={top:"top",bottom:"insideBottom"},left_right={top:"right",bottom:"insideLeft"},settingPosition=chartConfig.option.label?chartConfig.option.label.position:"top";if(position="horizontal"==chartConfig.valueAxis?{position:left_right[settingPosition]}:{position:top_bottom[settingPosition]},!_.isUndefined(chartConfig.option.label)&&!_.isUndefined(chartConfig.option.label.offset)){var offset=[0,0];_.isUndefined(chartConfig.option.label.offset.top)||(offset[1]=-chartConfig.option.label.offset.top),_.isUndefined(chartConfig.option.label.offset.bottom)||(offset[1]=Number(chartConfig.option.label.offset.bottom)),_.isUndefined(chartConfig.option.label.offset.left)||(offset[0]=-chartConfig.option.label.offset.left),_.isUndefined(chartConfig.option.label.offset.right)||(offset[0]=Number(chartConfig.option.label.offset.right)),position.offset=offset}for(var i=0;i<chartConfig.values.length;i++){for(var j=0;j<series_data.length;j++)for(var c=0;c<chartConfig.values[i].cols.length;c++)series_data[j].name==chartConfig.values[i].cols[c].alias&&("percentbar"==chartConfig.values[i].series_type?series_data[j].label={show:chartConfig.values[i].series_label,color:"#fff",formatter:function(e){return e.data.value+"%"},series_type:"percentbar"}:series_data[j].label={show:chartConfig.values[i].series_label,color:"auto",formatter:function(e){return(0==e.data.value?"":e.data.value)+e.data.unit}},series_data[j].label=$.extend({},series_data[j].label,position));!_.isUndefined(chartConfig.values[i].series_label)}var valueAxis=angular.copy(chartConfig.values);_.each(valueAxis,function(e,t){e.axisLabel={formatter:function(e){return numbro(e).format("0a.[0000]")}},e.splitLine={show:!1},e.nameGap=0,"percentbar"==e.series_type?(e.min=0,e.max=100):(e.min=e.min?e.min:null,e.max=e.max?e.max:null),t>0&&(e.splitLine=!1)});for(var i=0;i<valueAxis.length;i++)chartConfig.values[i].series_label&&("true"==chartConfig.values[i].series_logarithm?valueAxis[i]={type:"log"}:"false"==chartConfig.values[i].series_logarithm&&(valueAxis[i]={type:"value"}));var colorList=[],dataNameList=[],seriesNameList=[];if(chartConfig.option.itemStyle&&chartConfig.option.itemStyle.color&&(colorList=chartConfig.option.itemStyle.color.split(",")),chartConfig.option.itemStyle&&chartConfig.option.itemStyle.dataName&&(dataNameList=chartConfig.option.itemStyle.dataName.split(",")),chartConfig.option.itemStyle&&chartConfig.option.itemStyle.seriesName&&(seriesNameList=chartConfig.option.itemStyle.seriesName.split(",")),chartConfig.option.itemStyle&&chartConfig.option.itemStyle&&chartConfig.option.itemStyle.color&&""!=chartConfig.option.itemStyle.color)for(var e=0;e<colorList.length;e++)if(chartConfig.option.itemStyle.dataName&&(_.isUndefined(chartConfig.option.itemStyle.seriesName)||""==chartConfig.option.itemStyle.seriesName)){for(var i=0;i<series_data.length;i++)if(dataNameList[e]==series_data[i].name)for(var j=0;j<series_data[i].data.length;j++)series_data[i]=_.extend(series_data[i],{itemStyle:{normal:{color:colorList[e]}}})}else if(chartConfig.option.itemStyle.dataName&&chartConfig.option.itemStyle.seriesName)for(var i=0;i<series_data.length;i++)if(dataNameList[e]==series_data[i].name)for(var j=0;j<series_data[i].data.length;j++)for(var k=0;k<series_data[i].data[j].eventInfo.length;k++)seriesNameList[e]==series_data[i].data[j].eventInfo[k].value&&(series_data[i]=_.extend(series_data[i],{itemStyle:{normal:{color:colorList[e]}}}));if(tunningOpt){var labelInterval,labelRotate;tunningOpt.ctgLabelInterval?labelInterval=tunningOpt.ctgLabelInterval:"auto",tunningOpt.ctgLabelRotate?labelRotate=tunningOpt.ctgLabelRotate:0}var categoryAxis={type:"category",data:string_keys,nameGap:0,show:!0,splitLine:{show:!0},axisLabel:{show:!0,interval:labelInterval,rotate:labelRotate}},thresholdCode=data.chartConfig.thresholdCode,params=angular.copy(window.$$dlut_param);if(thresholdCode){var seriesIndexObj={};for(var _j5 in data.seriesConfig)seriesIndexObj[_j5]=data.seriesConfig[_j5].valueAxisIndex;var evalColor=function(e){for(var t in e)for(var a in e[t].data)try{e[t].data[a]=new Function("data,params,seriesIndex,dataIndex","return ("+thresholdCode+")(data,params,seriesIndex,dataIndex)")(e[t].data[a],params,t,a)}catch(i){console.error("data自定义计算公式错误",thresholdCode,params,e[t].data[a],t,a,i)}};evalColor(series_data)}if(data.chartConfig.markLineCode){var markLineCode=data.chartConfig.markLineCode;for(var _i8 in series_data)try{series_data[_i8]=new Function("serie,params,seriesIndex","return ("+markLineCode+")(serie,params,seriesIndex)")(series_data[_i8],params,_i8)}catch(e){console.error("series自定义计算错误",markLineCode,series_data[_i8],params,_i8,e)}}for(var tooltipFormatter=function tooltipFormatter(params){if("辅助isAssist"!==params.seriesName){var finalResult="",value="",info=params.data?params.data.eventInfo:"",param=BoardParamService.getAll();if(params.data&&params.data.tooltipCache)return params.data.tooltipCache;var tooltipIndex=-1,_loop2=function _loop2(_i9){if(void 0===_typeof(tooltip[_i9])||tooltip[_i9].isShow!==!1){tooltipIndex++;var index=_.findIndex(params.data.eventInfo,function(e){if(e.alias===_i9||e.col===_i9)return!0});if(index<0){value=params.data.eventInfo[tooltipIndex].value;var result=value;tooltip[_i9].formatter&&(result=eval(tooltip[_i9].formatter));var itemCol=params.data.eventInfo[tooltipIndex].col;params.data.eventInfo[tooltipIndex].alias&&(itemCol=params.data.eventInfo[tooltipIndex].alias),finalResult=finalResult+itemCol+": "+result+"<br/>"}else{value=params.data.eventInfo[index].value;var _result=value;tooltip[_i9].formatter&&(_result=eval(tooltip[_i9].formatter)),finalResult=finalResult+tooltip[_i9].col+": "+_result+"<br/>"}}};for(var _i9 in tooltip)_loop2(_i9);var _loop3=function _loop3(_i10){if(tooltipGroups[_i10].isShow!==!1){var index=_.findIndex(params.data.eventInfo,function(e){return e.col===_i10});if(index<0)return{v:void 0};value=params.data.eventInfo[index].value;var result=value;tooltipGroups[_i10].formatter&&(result=eval(tooltipGroups[_i10].formatter)),finalResult=finalResult+tooltipGroups[_i10].col+": "+result+"<br/>"}};for(var _i10 in tooltipGroups){var _ret3=_loop3(_i10);if("object"===("undefined"==typeof _ret3?"undefined":_typeof(_ret3)))return _ret3.v}var targetIndex=-1,_loop4=function _loop4(_i11){if(tooltipTarget[_i11]&&tooltipTarget[_i11].isShow!==!1)for(m=0;m<data.chartConfig.values.length;m++)for(itemValue=data.chartConfig.values[m],n=0;n<itemValue.cols.length;n++)if(itemValue.cols[n].alias===_i11){if(targetIndex+=1,targetIndex<0)continue;if(value="waterFall"===itemValue.series_type&&params.dataIndex>=aggregate_data[targetIndex].length?params.data.value:aggregate_data[targetIndex][params.dataIndex],_.isUndefined(value))continue;if(aggregate_data.length>_.keys(tooltipTarget).length)if(params.seriesIndex%2===0)if(targetIndex%2===0)value=aggregate_data[params.seriesIndex][params.dataIndex];else{var dataIndex=params.seriesIndex+1;dataIndex<aggregate_data.length&&(value=aggregate_data[dataIndex][params.dataIndex])}else if(targetIndex%2===0){var _dataIndex=params.seriesIndex-1;_dataIndex>-1&&(value=aggregate_data[_dataIndex][params.dataIndex])}else value=aggregate_data[params.seriesIndex][params.dataIndex];var result=value;tooltipTarget[_i11].formatter&&(result=eval(tooltipTarget[_i11].formatter)),finalResult=finalResult+tooltipTarget[_i11].col+": "+result+"<br/>",!_.isUndefined(series_data[params.seriesIndex].yAxisIndex)&&!valueAxis[series_data[params.seriesIndex].yAxisIndex].axisLabel.isFormatter&&tooltipTarget[_i11].formatter&&valueAxis[series_data[params.seriesIndex].yAxisIndex].cols.length>0&&(valueAxis[series_data[params.seriesIndex].yAxisIndex].cols[0].col===_i11||valueAxis[series_data[params.seriesIndex].yAxisIndex].cols[0].alias===_i11)&&(valueAxis[series_data[params.seriesIndex].yAxisIndex].axisLabel.formatter=function(fValue,fIndex){var yLabel=tooltipTarget[_i11].formatter.replace("value","fValue"),labelResult=eval(yLabel);return labelResult},valueAxis[series_data[params.seriesIndex].yAxisIndex].axisLabel.isFormatter=!0)}};for(var _i11 in tooltipTarget){var m,itemValue,n;_loop4(_i11)}return params.data.tooltipCache=finalResult,finalResult}},i=0;i<series_data.length;i++){var name=series_data[i].name,formatterObj=tooltipTarget[name];if(formatterObj&&formatterObj.formatter){for(var j=0;j<series_data[i].data.length;j++)series_data[i].data[j].laberFormatter=formatterObj.formatter;series_data[i].label||(series_data[i].label={}),series_data[i].label&&series_data[i].label&&"percentbar"!==series_data[i].label.series_type&&(series_data[i].label.formatter=dlut.echart.labelFormatter)}for(var j=0;j<series_data[i].data.length;j++)series_data[i].isAssist||(series_data[i].data[j].tooltipCache=tooltipFormatter({data:series_data[i].data[j],dataIndex:j,seriesIndex:i}))}var echartOption={grid:angular.copy(echartsBasicOption.grid),legend:{data:_.map(casted_values,function(e){return e.join("-")})},tooltip:{trigger:"item",formatter:tooltipFormatter},xAxis:"horizontal"==chartConfig.valueAxis?valueAxis:categoryAxis,yAxis:"horizontal"==chartConfig.valueAxis?categoryAxis:valueAxis,targetData:chartConfig.values,series:series_data};if(_.isUndefined(tunningOpt.xAxisName)||(_.isArray(echartOption.xAxis)?echartOption.xAxis[0].name=tunningOpt.xAxisName:echartOption.xAxis.name=tunningOpt.xAxisName),_.isUndefined(tunningOpt.yAxisName)||(_.isArray(echartOption.yAxis)?echartOption.yAxis[0].name=tunningOpt.yAxisName:echartOption.yAxis.name=tunningOpt.yAxisName),_.isUndefined(tunningOpt.xAxisPosition)||(_.isArray(echartOption.xAxis)?echartOption.xAxis[0].position=tunningOpt.xAxisPosition:echartOption.xAxis.position=tunningOpt.xAxisPosition),echartOption.dataZoom=[],tunningOpt.dataZoom&&echartOption.dataZoom.push({type:"slider",xAxisIndex:[0],startValue:tunningOpt.dataZoomStart?parseInt(tunningOpt.dataZoomStart):0,endValue:tunningOpt.dataZoomEnd?parseInt(tunningOpt.dataZoomEnd):100}),tunningOpt.dataZoomY&&echartOption.dataZoom.push({type:"slider",yAxisIndex:[0],startValue:tunningOpt.dataZoomStartY?parseInt(tunningOpt.dataZoomStartY):0,endValue:tunningOpt.dataZoomEndY?parseInt(tunningOpt.dataZoomEndY):100}),"horizontal"===chartConfig.valueAxis&&(echartOption.grid.left="left",echartOption.grid.containLabel=!0,echartOption.grid.bottom="5%"),"vertical"===chartConfig.valueAxis&&chartConfig.values.length>1&&(echartOption.grid.right=40),data.chartConfig.optionCode){var optionCode=data.chartConfig.optionCode;try{var param=angular.copy(window.$$dlut_param);echartOption=new Function("option,param,config","return ("+optionCode+")(option,param,config)")(echartOption,param,chartConfig)}catch(e){console.error("option自定义计算错误",echartOption,e)}}return updateEchartOptions(tunningOpt,echartOption),echartOption}}]);var renderAverageItem=function(e,t){var a=(t.value(0),.85*t.size([0,0])[0]),i=t.coord([t.value(0),t.value(1)]);return{type:"group",children:[{type:"rect",shape:{x:i[0]-a/2,y:i[1],width:a/2,height:-20},style:t.style()},{type:"line",shape:{x1:i[0]-a/2,x2:i[0]+a/2,y1:i[1],y2:i[1]},style:t.style({fill:null,stroke:t.visual("color"),lineWidth:2,text:""})}]}};discovery.service("chartLine2Service",["BoardParamService","EventService",function(BoardParamService,EventService){"ngInject";this.instance=null,this.render=function(e,t,a,i,r,o){return this.instance=new CBoardEChartRender(e,t,(void 0),o),this.instance.chart(null,i,EventService)},this.parseOption=function(data){var chartConfig=data.chartConfig,casted_keys=data.keys,casted_values=data.series,aggregate_data=data.data,newValuesConfig=data.seriesConfig,tooltip={},Levi=data.chartConfig.option.tooltip?data.chartConfig.option.tooltip:{},keys=data.chartConfig.keys;for(var _i12 in keys)_.isUndefined(Levi)||(Levi[keys[_i12].col]?(tooltip[keys[_i12].col]=Levi[keys[_i12].col],Levi[keys[_i12].col].col||(tooltip[keys[_i12].col].col=keys[_i12].col)):tooltip[keys[_i12].col]={col:keys[_i12].col,isShow:!0,formatter:""});for(var tooltipTarget={},Target=data.chartConfig.option.tooltipTarget?data.chartConfig.option.tooltipTarget:{},targetValue={},_j7=0;_j7<data.chartConfig.values.length;_j7++)for(var _k2=0;_k2<data.chartConfig.values[_j7].cols.length;_k2++)targetValue[data.chartConfig.values[_j7].cols[_k2].alias]={col:data.chartConfig.values[_j7].cols[_k2].alias};if(!_.isUndefined(Target))for(var _i13 in targetValue)tooltipTarget[_i13]=Target[_i13],Target[_i13]?tooltipTarget[_i13]={col:Target[_i13].col?Target[_i13].col:_i13,isShow:!Target[_i13]||Target[_i13].isShow,formatter:Target[_i13]&&Target[_i13].formatter?Target[_i13].formatter:""}:tooltipTarget[_i13]={col:_i13,isShow:!Target[_i13]||Target[_i13].isShow,formatter:""};for(var tooltipGroups={},Groups=data.chartConfig.option.tooltipGroups,targetGroups=data.chartConfig.groups,_i14=0;_i14<targetGroups.length;_i14++)Groups[targetGroups[_i14].col]?(tooltipGroups[targetGroups[_i14].col]=Groups[targetGroups[_i14].col],Groups[targetGroups[_i14].col].col||(tooltipGroups[targetGroups[_i14].col].col=targetGroups[_i14].col)):tooltipGroups[targetGroups[_i14].col]={col:targetGroups[_i14].col,isShow:!0,formatter:""};for(var series_data=new Array,string_keys=_.map(casted_keys,function(e){return e.join("-")}),tunningOpt=chartConfig.option,sum_data=[],j=0;aggregate_data[0]&&j<aggregate_data[0].length;j++){for(var sum=0,i=0;i<aggregate_data.length;i++)sum+=aggregate_data[i][j]?Number(aggregate_data[i][j]):0,aggregate_data[i][j]=aggregate_data[i][j]?Number(aggregate_data[i][j]):0;sum_data[j]=sum}for(var unitList=[],i=0;i<chartConfig.values.length;i++)for(var unit=chartConfig.values[i].unit?chartConfig.values[i].unit:"",j=0;j<chartConfig.values[i].cols.length;j++)unitList.push(unit);for(var newunitList=[],length=data.series.length/unitList.length,i=0;i<length;i++)newunitList=newunitList.concat(unitList);for(var i=0;i<aggregate_data.length;i++){var joined_values=casted_values[i].join("-"),s=angular.copy(newValuesConfig[joined_values]);s.name=joined_values,s.data=aggregate_data[i],s.barMaxWidth=40,_.isUndefined(chartConfig.option.barWidth)||""==chartConfig.option.barWidth||(s.barWidth=chartConfig.option.barWidth),"stackbar"==s.type?(s.type="bar",s.stack=s.valueAxisIndex.toString()):"percentbar"==s.type?(s.data=_.map(aggregate_data[i],function(e,t){return[t,parseFloat((e/sum_data[t]*100).toFixed(2)),e]}),s.type="bar",s.stack=s.valueAxisIndex.toString()):"stackline"==s.type&&(s.type="line",s.stack="normal",s.areaStyle={normal:{}}),"horizontal"==chartConfig.valueAxis?s.xAxisIndex=s.valueAxisIndex:s.yAxisIndex=s.valueAxisIndex;for(var newData=[],unit=newunitList[i],newUnit="",strData="",j=0;j<s.data.length;j++){"元"==unit||"万"==unit||"亿"==unit?(unit=dlut.utils.convertMoney(s.data[j],unit),newUnit=unit.substr(unit.length-1,unit.length),strData=unit.substr(0,unit.length-1)):"100%"==unit?(strData=Math.floor(100*s.data[j]),newUnit="%"):"100.00%"==unit?(strData=(100*s.data[j]).toFixed(2),newUnit="%"):"100.0%"==unit&&(strData=(100*s.data[j]).toFixed(1),newUnit="%");var eventInfo=CBoardEChartRenderEventInfo(data,i,j),obj={eventInfo:eventInfo,value:""==strData?s.data[j]:strData,unit:""==newUnit?unit:newUnit};newData.push(obj)}s.data=newData,series_data.push(s)}var position={};if(!_.isUndefined(chartConfig.option.label)){var top_bottom={top:"insideTop",bottom:"insideBottom"},left_right={top:"insideRight",bottom:"insideLeft"};if(_.isUndefined(chartConfig.option.label.position)||(position="horizontal"==chartConfig.valueAxis?{position:left_right[chartConfig.option.label.position]}:{position:top_bottom[chartConfig.option.label.position]}),!_.isUndefined(chartConfig.option.label.offset)){var offset=[0,0];_.isUndefined(chartConfig.option.label.offset.top)||(offset[1]=-chartConfig.option.label.offset.top),_.isUndefined(chartConfig.option.label.offset.bottom)||(offset[1]=Number(chartConfig.option.label.offset.bottom)),_.isUndefined(chartConfig.option.label.offset.left)||(offset[0]=-chartConfig.option.label.offset.left),_.isUndefined(chartConfig.option.label.offset.right)||(offset[0]=Number(chartConfig.option.label.offset.right)),position.offset=offset}}for(var i=0;i<chartConfig.values.length;i++)if(!_.isUndefined(chartConfig.values[i].series_label))for(var j=0;j<series_data.length;j++)if("true"===chartConfig.values[i].series_label)for(var c=0;c<chartConfig.values[i].cols.length;c++)series_data[j].name==chartConfig.values[i].cols[c].alias&&("percentbar"==chartConfig.values[i].series_type?series_data[j].label={normal:{show:!0,formatter:function(e){return(0==e.data.value[2]?"":e.data.value[2])+e.data.unit}}}:series_data[j].label={normal:{show:!0,formatter:function(e){return(0==e.data.value?"":e.data.value)+e.data.unit}}},series_data[j].label.normal=$.extend({},series_data[j].label.normal,position));else series_data[i].label={normal:{show:!1}};var valueAxis=angular.copy(chartConfig.values);_.each(valueAxis,function(e,t){e.axisLabel={formatter:function(e){return numbro(e).format("0a.[0000]")}},e.nameGap=0,"percentbar"==e.series_type?(e.min=0,e.max=100):(e.min=e.min?e.min:null,e.max=e.max?e.max:null),t>0&&(e.splitLine=!1)});for(var i=0;i<valueAxis.length;i++)chartConfig.values[i].series_label&&("true"==chartConfig.values[i].series_logarithm?valueAxis[i]={type:"log"}:"false"==chartConfig.values[i].series_logarithm&&(valueAxis[i]={type:"value"}));for(var axis,m=0;m<series_data.length;m++){var s_ml=series_data[m];if(axis!=s_ml.valueAxisIndex&&(axis=s_ml.valueAxisIndex,!_.isUndefined(chartConfig.values[axis].markLine))){var axis_ml_v={};_.isUndefined(s_ml.xAxisIndex)?axis_ml_v.yAxis=parseInt(chartConfig.values[axis].markLine):axis_ml_v.xAxis=parseInt(chartConfig.values[axis].markLine),s_ml.markLine={data:[axis_ml_v],label:{normal:{position:"middle"}},lineStyle:{color:"white"}}}}var colorList=[],dataNameList=[],seriesNameList=[];if(chartConfig.option.itemStyle&&chartConfig.option.itemStyle.color&&(colorList=chartConfig.option.itemStyle.color.split(",")),chartConfig.option.itemStyle&&chartConfig.option.itemStyle.dataName&&(dataNameList=chartConfig.option.itemStyle.dataName.split(",")),chartConfig.option.itemStyle&&chartConfig.option.itemStyle.seriesName&&(seriesNameList=chartConfig.option.itemStyle.seriesName.split(",")),chartConfig.option.itemStyle&&chartConfig.option.itemStyle&&chartConfig.option.itemStyle.color&&""!=chartConfig.option.itemStyle.color)for(var e=0;e<colorList.length;e++)if(chartConfig.option.itemStyle.dataName&&(_.isUndefined(chartConfig.option.itemStyle.seriesName)||""==chartConfig.option.itemStyle.seriesName)){for(var i=0;i<series_data.length;i++)if(dataNameList[e]==series_data[i].name)for(var j=0;j<series_data[i].data.length;j++)series_data[i]=_.extend(series_data[i],{itemStyle:{normal:{color:colorList[e]}}})}else if(chartConfig.option.itemStyle.dataName&&chartConfig.option.itemStyle.seriesName)for(var i=0;i<series_data.length;i++)if(dataNameList[e]==series_data[i].name)for(var j=0;j<series_data[i].data.length;j++)for(var k=0;k<series_data[i].data[j].eventInfo.length;k++)seriesNameList[e]==series_data[i].data[j].eventInfo[k].value&&(series_data[i]=_.extend(series_data[i],{itemStyle:{normal:{color:colorList[e]}}}));if(tunningOpt){var labelInterval,labelRotate;tunningOpt.ctgLabelInterval?labelInterval=tunningOpt.ctgLabelInterval:"auto",tunningOpt.ctgLabelRotate?labelRotate=tunningOpt.ctgLabelRotate:0}var categoryAxis={type:"category",data:string_keys,nameGap:0,axisLabel:{show:!0,interval:labelInterval,rotate:labelRotate}},thresholdCode=data.chartConfig.thresholdCode,params=angular.copy(window.$$dlut_param);if(thresholdCode){var seriesIndexObj={};for(var _j8 in data.seriesConfig)seriesIndexObj[_j8]=data.seriesConfig[_j8].valueAxisIndex;var evalColor=function(e){for(var t in e)for(var a in e[t].data)try{e[t].data[a]=new Function("data,params,seriesIndex,dataIndex","return ("+thresholdCode+")(data,params,seriesIndex,dataIndex)")(e[t].data[a],params,t,a)}catch(i){console.error("data自定义计算公式错误",thresholdCode,params,e[t].data[a],t,a,i)}};evalColor(series_data)}if(data.chartConfig.markLineCode){var markLineCode=data.chartConfig.markLineCode;for(var _i16 in series_data)try{series_data[_i16]=new Function("serie,params,seriesIndex","return ("+markLineCode+")(serie,params,seriesIndex)")(series_data[_i16],params,_i16)}catch(e){console.error("series自定义计算错误",markLineCode,series_data[_i16],params,_i16,e)}}var echartOption={grid:angular.copy(echartsBasicOption.grid),legend:{data:_.map(casted_values,function(e){return e.join("-")})},tooltip:{trigger:"item",formatter:function formatter(params){var finalResult="",param=BoardParamService.getAll(),value="",_loop5=function _loop5(_i17){if(void 0===_typeof(tooltip[_i17])||tooltip[_i17].isShow!==!1){var index=_.findIndex(params.data.eventInfo,function(e){return e.col===_i17});if(index<0)return{v:void 0};value=params.data.eventInfo[index].value;var result=value;tooltip[_i17].formatter&&(result=eval(tooltip[_i17].formatter)),finalResult=finalResult+tooltip[_i17].col+": "+result+"<br/>"}};for(var _i17 in tooltip){var _ret5=_loop5(_i17);if("object"===("undefined"==typeof _ret5?"undefined":_typeof(_ret5)))return _ret5.v}var _loop6=function _loop6(_i18){if(tooltipGroups[_i18].isShow!==!1){var index=_.findIndex(params.data.eventInfo,function(e){return e.col===_i18});if(index<0)return{v:void 0};value=params.data.eventInfo[index].value;var result=value;tooltipGroups[_i18].formatter&&(result=eval(tooltipGroups[_i18].formatter)),finalResult=finalResult+tooltipGroups[_i18].col+": "+result+"<br/>"}};for(var _i18 in tooltipGroups){var _ret6=_loop6(_i18);if("object"===("undefined"==typeof _ret6?"undefined":_typeof(_ret6)))return _ret6.v}var _loop7=function _loop7(_i19){if(tooltipTarget[_i19]&&tooltipTarget[_i19].isShow!==!1){var index=_.findIndex(data.chartConfig.values,function(e){return e.cols[0].alias===_i19});if(index<0)return{v:void 0};var dataIndex=_.findIndex(aggregate_data[params.seriesIndex],function(e){return e===params.value});if(dataIndex<0)return{v:void 0};value=aggregate_data[index][dataIndex];var result=value;tooltipTarget[_i19].formatter&&(result=eval(tooltipTarget[_i19].formatter)),finalResult=finalResult+tooltipTarget[_i19].col+": "+result+"<br/>"}};for(var _i19 in tooltipTarget){var _ret7=_loop7(_i19);if("object"===("undefined"==typeof _ret7?"undefined":_typeof(_ret7)))return _ret7.v}return finalResult}},xAxis:"horizontal"==chartConfig.valueAxis?valueAxis:categoryAxis,yAxis:"horizontal"==chartConfig.valueAxis?categoryAxis:valueAxis,targetData:chartConfig.values,series:series_data};return _.isUndefined(tunningOpt.xAxisName)||(_.isArray(echartOption.xAxis)?echartOption.xAxis[0].name=tunningOpt.xAxisName:echartOption.xAxis.name=tunningOpt.xAxisName),_.isUndefined(tunningOpt.yAxisName)||(_.isArray(echartOption.yAxis)?echartOption.yAxis[0].name=tunningOpt.yAxisName:echartOption.yAxis.name=tunningOpt.yAxisName),"horizontal"===chartConfig.valueAxis&&(echartOption.grid.left="left",echartOption.grid.containLabel=!0,echartOption.grid.bottom="5%"),"vertical"===chartConfig.valueAxis&&chartConfig.values.length>1&&(echartOption.grid.right=40),updateEchartOptions(tunningOpt,echartOption),echartOption}}]),discovery.service("chartLine3Service",["BoardParamService","EventService",function(BoardParamService,EventService){"ngInject";this.instance=null,this.render=function(e,t,a,i,r,o){return this.instance=new CBoardEChartRender(e,t,(void 0),o),this.instance.chart(null,i,EventService)},this.parseOption=function(data){var chartConfig=data.chartConfig,casted_keys=data.keys,casted_values=data.series,aggregate_data=data.data,newValuesConfig=data.seriesConfig,tooltip={},Levi=data.chartConfig.option.tooltip?data.chartConfig.option.tooltip:{},keys=data.chartConfig.keys;for(var _i20 in keys)_.isUndefined(Levi)||(Levi[keys[_i20].col]?(tooltip[keys[_i20].col]=Levi[keys[_i20].col],Levi[keys[_i20].col].col||(tooltip[keys[_i20].col].col=keys[_i20].col)):tooltip[keys[_i20].col]={col:keys[_i20].col,isShow:!0,formatter:""});for(var tooltipTarget={},Target=data.chartConfig.option.tooltipTarget?data.chartConfig.option.tooltipTarget:{},targetValue={},_j10=0;_j10<data.chartConfig.values.length;_j10++)for(var _k3=0;_k3<data.chartConfig.values[_j10].cols.length;_k3++)targetValue[data.chartConfig.values[_j10].cols[_k3].alias]={col:data.chartConfig.values[_j10].cols[_k3].alias};if(!_.isUndefined(Target))for(var _i21 in targetValue)tooltipTarget[_i21]=Target[_i21],Target[_i21]?tooltipTarget[_i21]={col:Target[_i21].col?Target[_i21].col:_i21,isShow:!Target[_i21]||Target[_i21].isShow,formatter:Target[_i21]&&Target[_i21].formatter?Target[_i21].formatter:""}:tooltipTarget[_i21]={col:_i21,isShow:!Target[_i21]||Target[_i21].isShow,formatter:""};for(var tooltipGroups={},Groups=data.chartConfig.option.tooltipGroups,targetGroups=data.chartConfig.groups,_i22=0;_i22<targetGroups.length;_i22++)Groups[targetGroups[_i22].col]?(tooltipGroups[targetGroups[_i22].col]=Groups[targetGroups[_i22].col],Groups[targetGroups[_i22].col].col||(tooltipGroups[targetGroups[_i22].col].col=targetGroups[_i22].col)):tooltipGroups[targetGroups[_i22].col]={col:targetGroups[_i22].col,isShow:!0,formatter:""};for(var series_data=new Array,string_keys=_.map(casted_keys,function(e){return e.join("-")}),tunningOpt=chartConfig.option,sum_data=[],j=0;aggregate_data[0]&&j<aggregate_data[0].length;j++){for(var sum=0,i=0;i<aggregate_data.length;i++)sum+=aggregate_data[i][j]?Number(aggregate_data[i][j]):0,aggregate_data[i][j]=aggregate_data[i][j]?Number(aggregate_data[i][j]):0;sum_data[j]=sum}
for(var unitList=[],i=0;i<chartConfig.values.length;i++)for(var unit=chartConfig.values[i].unit?chartConfig.values[i].unit:"",j=0;j<chartConfig.values[i].cols.length;j++)unitList.push(unit);for(var newunitList=[],length=data.series.length/unitList.length,i=0;i<length;i++)newunitList=newunitList.concat(unitList);for(var i=0;i<aggregate_data.length;i++){var joined_values=casted_values[i].join("-"),s=angular.copy(newValuesConfig[joined_values]);s.name=joined_values,s.data=aggregate_data[i],s.barMaxWidth=40,_.isUndefined(chartConfig.option.barWidth)||""==chartConfig.option.barWidth||(s.barWidth=chartConfig.option.barWidth),"stackbar"==s.type?(s.type="bar",s.stack=s.valueAxisIndex.toString()):"percentbar"==s.type?(s.data=_.map(aggregate_data[i],function(e,t){return[t,parseFloat((e/sum_data[t]*100).toFixed(2)),e]}),s.type="bar",s.stack=s.valueAxisIndex.toString()):"stackline"==s.type&&(s.type="line",s.stack="normal",s.areaStyle={normal:{}}),"horizontal"==chartConfig.valueAxis?s.xAxisIndex=s.valueAxisIndex:s.yAxisIndex=s.valueAxisIndex;for(var newData=[],unit=newunitList[i],newUnit="",strData="",j=0;j<s.data.length;j++){"元"==unit||"万"==unit||"亿"==unit?(unit=dlut.utils.convertMoney(s.data[j],unit),newUnit=unit.substr(unit.length-1,unit.length),strData=unit.substr(0,unit.length-1)):"100%"==unit?(strData=Math.floor(100*s.data[j]),newUnit="%"):"100.00%"==unit?(strData=(100*s.data[j]).toFixed(2),newUnit="%"):"100.0%"==unit&&(strData=(100*s.data[j]).toFixed(1),newUnit="%");var eventInfo=CBoardEChartRenderEventInfo(data,i,j),obj={eventInfo:eventInfo,value:""==strData?s.data[j]:strData,unit:""==newUnit?unit:newUnit};newData.push(obj)}s.data=newData,series_data.push(s)}var position={};if(!_.isUndefined(chartConfig.option.label)){var top_bottom={top:"insideTop",bottom:"insideBottom"},left_right={top:"insideRight",bottom:"insideLeft"};if(_.isUndefined(chartConfig.option.label.position)||(position="horizontal"==chartConfig.valueAxis?{position:left_right[chartConfig.option.label.position]}:{position:top_bottom[chartConfig.option.label.position]}),!_.isUndefined(chartConfig.option.label.offset)){var offset=[0,0];_.isUndefined(chartConfig.option.label.offset.top)||(offset[1]=-chartConfig.option.label.offset.top),_.isUndefined(chartConfig.option.label.offset.bottom)||(offset[1]=Number(chartConfig.option.label.offset.bottom)),_.isUndefined(chartConfig.option.label.offset.left)||(offset[0]=-chartConfig.option.label.offset.left),_.isUndefined(chartConfig.option.label.offset.right)||(offset[0]=Number(chartConfig.option.label.offset.right)),position.offset=offset}}for(var i=0;i<chartConfig.values.length;i++)if(!_.isUndefined(chartConfig.values[i].series_label))for(var j=0;j<series_data.length;j++)if("true"===chartConfig.values[i].series_label)for(var c=0;c<chartConfig.values[i].cols.length;c++)series_data[j].name==chartConfig.values[i].cols[c].alias&&("percentbar"==chartConfig.values[i].series_type?series_data[j].label={normal:{show:!0,formatter:function(e){return(0==e.data.value[2]?"":e.data.value[2])+e.data.unit}}}:series_data[j].label={normal:{show:!0,formatter:function(e){return(0==e.data.value?"":e.data.value)+e.data.unit}}},series_data[j].label.normal=$.extend({},series_data[j].label.normal,position));else series_data[i].label={normal:{show:!1}};var valueAxis=angular.copy(chartConfig.values);_.each(valueAxis,function(e,t){e.axisLabel={formatter:function(e){return numbro(e).format("0a.[0000]")}},e.nameGap=0,"percentbar"==e.series_type?(e.min=0,e.max=100):(e.min=e.min?e.min:null,e.max=e.max?e.max:null),t>0&&(e.splitLine=!1)});for(var i=0;i<valueAxis.length;i++)chartConfig.values[i].series_label&&("true"==chartConfig.values[i].series_logarithm?valueAxis[i]={type:"log"}:"false"==chartConfig.values[i].series_logarithm&&(valueAxis[i]={type:"value"}));for(var axis,m=0;m<series_data.length;m++){var s_ml=series_data[m];if(axis!=s_ml.valueAxisIndex&&(axis=s_ml.valueAxisIndex,!_.isUndefined(chartConfig.values[axis].markLine))){var axis_ml_v={};_.isUndefined(s_ml.xAxisIndex)?axis_ml_v.yAxis=parseInt(chartConfig.values[axis].markLine):axis_ml_v.xAxis=parseInt(chartConfig.values[axis].markLine),s_ml.markLine={data:[axis_ml_v],label:{normal:{position:"middle"}},lineStyle:{color:"white"}}}}var colorList=[],dataNameList=[],seriesNameList=[];if(chartConfig.option.itemStyle&&chartConfig.option.itemStyle.color&&(colorList=chartConfig.option.itemStyle.color.split(",")),chartConfig.option.itemStyle&&chartConfig.option.itemStyle.dataName&&(dataNameList=chartConfig.option.itemStyle.dataName.split(",")),chartConfig.option.itemStyle&&chartConfig.option.itemStyle.seriesName&&(seriesNameList=chartConfig.option.itemStyle.seriesName.split(",")),chartConfig.option.itemStyle&&chartConfig.option.itemStyle&&chartConfig.option.itemStyle.color&&""!=chartConfig.option.itemStyle.color)for(var e=0;e<colorList.length;e++)if(chartConfig.option.itemStyle.dataName&&(_.isUndefined(chartConfig.option.itemStyle.seriesName)||""==chartConfig.option.itemStyle.seriesName)){for(var i=0;i<series_data.length;i++)if(dataNameList[e]==series_data[i].name)for(var j=0;j<series_data[i].data.length;j++)series_data[i]=_.extend(series_data[i],{itemStyle:{normal:{color:colorList[e]}}})}else if(chartConfig.option.itemStyle.dataName&&chartConfig.option.itemStyle.seriesName)for(var i=0;i<series_data.length;i++)if(dataNameList[e]==series_data[i].name)for(var j=0;j<series_data[i].data.length;j++)for(var k=0;k<series_data[i].data[j].eventInfo.length;k++)seriesNameList[e]==series_data[i].data[j].eventInfo[k].value&&(series_data[i]=_.extend(series_data[i],{itemStyle:{normal:{color:colorList[e]}}}));if(tunningOpt){var labelInterval,labelRotate;tunningOpt.ctgLabelInterval?labelInterval=tunningOpt.ctgLabelInterval:"auto",tunningOpt.ctgLabelRotate?labelRotate=tunningOpt.ctgLabelRotate:0}var categoryAxis={type:"category",data:string_keys,nameGap:0,axisLabel:{show:!0,interval:labelInterval,rotate:labelRotate}},thresholdCode=data.chartConfig.thresholdCode,params=angular.copy(window.$$dlut_param);if(thresholdCode){var seriesIndexObj={};for(var _j11 in data.seriesConfig)seriesIndexObj[_j11]=data.seriesConfig[_j11].valueAxisIndex;var evalColor=function(e){for(var t in e)for(var a in e[t].data)try{e[t].data[a]=new Function("data,params,seriesIndex,dataIndex","return ("+thresholdCode+")(data,params,seriesIndex,dataIndex)")(e[t].data[a],params,t,a)}catch(i){console.error("data自定义计算公式错误",thresholdCode,params,e[t].data[a],t,a,i)}};evalColor(series_data)}if(data.chartConfig.markLineCode){var markLineCode=data.chartConfig.markLineCode;for(var _i24 in series_data)try{series_data[_i24]=new Function("serie,params,seriesIndex","return ("+markLineCode+")(serie,params,seriesIndex)")(series_data[_i24],params,_i24)}catch(e){console.error("series自定义计算错误",markLineCode,series_data[_i24],params,_i24,e)}}var echartOption={grid:angular.copy(echartsBasicOption.grid),legend:{data:_.map(casted_values,function(e){return e.join("-")})},tooltip:{trigger:"item",formatter:function formatter(params){var finalResult="",param=BoardParamService.getAll(),value="",_loop8=function _loop8(_i25){if(void 0===_typeof(tooltip[_i25])||tooltip[_i25].isShow!==!1){var index=_.findIndex(params.data.eventInfo,function(e){return e.col===_i25});if(index<0)return{v:void 0};value=params.data.eventInfo[index].value;var result=value;tooltip[_i25].formatter&&(result=eval(tooltip[_i25].formatter)),finalResult=finalResult+tooltip[_i25].col+": "+result+"<br/>"}};for(var _i25 in tooltip){var _ret8=_loop8(_i25);if("object"===("undefined"==typeof _ret8?"undefined":_typeof(_ret8)))return _ret8.v}var _loop9=function _loop9(_i26){if(tooltipGroups[_i26].isShow!==!1){var index=_.findIndex(params.data.eventInfo,function(e){return e.col===_i26});if(index<0)return{v:void 0};value=params.data.eventInfo[index].value;var result=value;tooltipGroups[_i26].formatter&&(result=eval(tooltipGroups[_i26].formatter)),finalResult=finalResult+tooltipGroups[_i26].col+": "+result+"<br/>"}};for(var _i26 in tooltipGroups){var _ret9=_loop9(_i26);if("object"===("undefined"==typeof _ret9?"undefined":_typeof(_ret9)))return _ret9.v}var _loop10=function _loop10(_i27){if(tooltipTarget[_i27]&&tooltipTarget[_i27].isShow!==!1){var index=_.findIndex(data.chartConfig.values,function(e){return e.cols[0].alias===_i27});if(index<0)return{v:void 0};var dataIndex=_.findIndex(aggregate_data[params.seriesIndex],function(e){return e===params.value});if(dataIndex<0)return{v:void 0};value=aggregate_data[index][dataIndex];var result=value;tooltipTarget[_i27].formatter&&(result=eval(tooltipTarget[_i27].formatter)),finalResult=finalResult+tooltipTarget[_i27].col+": "+result+"<br/>"}};for(var _i27 in tooltipTarget){var _ret10=_loop10(_i27);if("object"===("undefined"==typeof _ret10?"undefined":_typeof(_ret10)))return _ret10.v}return finalResult}},xAxis:"horizontal"==chartConfig.valueAxis?valueAxis:categoryAxis,yAxis:"horizontal"==chartConfig.valueAxis?categoryAxis:valueAxis,targetData:chartConfig.values,series:series_data};return _.isUndefined(tunningOpt.xAxisName)||(_.isArray(echartOption.xAxis)?echartOption.xAxis[0].name=tunningOpt.xAxisName:echartOption.xAxis.name=tunningOpt.xAxisName),_.isUndefined(tunningOpt.yAxisName)||(_.isArray(echartOption.yAxis)?echartOption.yAxis[0].name=tunningOpt.yAxisName:echartOption.yAxis.name=tunningOpt.yAxisName),"horizontal"===chartConfig.valueAxis&&(echartOption.grid.left="left",echartOption.grid.containLabel=!0,echartOption.grid.bottom="5%"),"vertical"===chartConfig.valueAxis&&chartConfig.values.length>1&&(echartOption.grid.right=40),updateEchartOptions(tunningOpt,echartOption),echartOption}}]),discovery.service("chartPieService",["BoardParamService","EventService",function(BoardParamService,EventService){"ngInject";this.instance=null,this.render=function(e,t,a,i,r,o){return this.instance=new CBoardEChartRender(e,t,(void 0),o),this.instance.chart(null,i,EventService)},this.parseOption=function(data){var chartConfig=data.chartConfig,casted_keys=data.keys,casted_values=data.series,aggregate_data=data.data,tooltip={},Levi=data.chartConfig.option.tooltip?data.chartConfig.option.tooltip:{},keys=data.chartConfig.keys;console.log("keys",keys),console.log("data",data);for(var _i28 in keys)_.isUndefined(Levi)||(Levi[keys[_i28].col]?(tooltip[keys[_i28].col]=Levi[keys[_i28].col],Levi[keys[_i28].col].col||(tooltip[keys[_i28].col].col=keys[_i28].col)):tooltip[keys[_i28].col]={col:keys[_i28].col,isShow:!0,formatter:""});for(var tooltipTarget={},Target=data.chartConfig.option.tooltipTarget?data.chartConfig.option.tooltipTarget:{},targetValue={},_j13=0;_j13<data.chartConfig.values.length;_j13++)for(var _k4=0;_k4<data.chartConfig.values[_j13].cols.length;_k4++)targetValue[data.chartConfig.values[_j13].cols[_k4].alias]={col:data.chartConfig.values[_j13].cols[_k4].alias};if(!_.isUndefined(Target))for(var _i29 in targetValue)tooltipTarget[_i29]=Target[_i29],Target[_i29]?tooltipTarget[_i29]={col:Target[_i29].col?Target[_i29].col:_i29,isShow:!Target[_i29]||Target[_i29].isShow,formatter:Target[_i29]&&Target[_i29].formatter?Target[_i29].formatter:""}:tooltipTarget[_i29]={col:_i29,isShow:!Target[_i29]||Target[_i29].isShow,formatter:""};for(var tooltipGroups={},Groups=data.chartConfig.option.tooltipGroups,targetGroups=data.chartConfig.groups,_i30=0;_i30<targetGroups.length;_i30++)Groups[targetGroups[_i30].col]?(tooltipGroups[targetGroups[_i30].col]=Groups[targetGroups[_i30].col],Groups[targetGroups[_i30].col].col||(tooltipGroups[targetGroups[_i30].col].col=targetGroups[_i30].col)):tooltipGroups[targetGroups[_i30].col]={col:targetGroups[_i30].col,isShow:!0,formatter:""};var series=new Array,string_keys=_.map(casted_keys,function(e){return e.join("-")}),string_value=_.map(casted_values,function(e){return e.join("-")}),b=100/(9*casted_values.length+1),titles=[],s={name:string_value[0],type:"pie",center:[chartConfig.centerX?chartConfig.centerX:"50%",chartConfig.centerY?chartConfig.centerY:"50%"],xRadius:[chartConfig.radiusX?chartConfig.radiusX:"0",chartConfig.radiusY?chartConfig.radiusY:"70%"],data:[],label:{},itemStyle:{normal:{label:{show:!0,formatter:"{b}: {d}%"}},labelLine:{show:!0}}};chartConfig&&chartConfig.roseType&&(s.roseType="area",s.itemStyle={normal:{shadowBlur:200,shadowColor:"rgba(0, 0, 0, 0.5)"}},s.animationType="scale",s.animationEasing="elasticOut",s.animationDelay=function(e){return 200*Math.random()});for(var i=0;i<aggregate_data.length;i++)for(var j=0;j<aggregate_data[i].length;j++)0===i?s.data[j]={eventInfo:CBoardEChartRenderEventInfo(data,i,j),name:string_keys[j]?string_keys[j]:"",value:[aggregate_data[i][j]]}:s.data[j].value=s.data[j].value.concat(aggregate_data[i][j]);series.push(s);for(var i=0;i<series.length;i++)_.isUndefined(chartConfig.series_label)||(chartConfig.series_label===!0?series[i].label={normal:{show:!0}}:series[i].label={normal:{show:!1}});var colorList=[],dataNameList=[],seriesNameList=[];if(chartConfig.option.itemStyle&&chartConfig.option.itemStyle.color&&(colorList=chartConfig.option.itemStyle.color.split(",")),chartConfig.option.itemStyle&&chartConfig.option.itemStyle.dataName&&(dataNameList=chartConfig.option.itemStyle.dataName.split(",")),chartConfig.option.itemStyle&&chartConfig.option.itemStyle.seriesName&&(seriesNameList=chartConfig.option.itemStyle.seriesName.split(",")),chartConfig.option.itemStyle&&chartConfig.option.itemStyle&&chartConfig.option.itemStyle.color&&""!=chartConfig.option.itemStyle.color)for(var e=0;e<colorList.length;e++)if(chartConfig.option.itemStyle.dataName&&(_.isUndefined(chartConfig.option.itemStyle.seriesName)||""==chartConfig.option.itemStyle.seriesName)){for(var i=0;i<series.length;i++)if(dataNameList[e]==series[i].name)for(var j=0;j<series[i].data.length;j++)series[i].data[j]=_.extend(series[i].data[j],{itemStyle:{normal:{color:colorList[e]}}})}else if(chartConfig.option.itemStyle.dataName&&chartConfig.option.itemStyle.seriesName)for(var i=0;i<series.length;i++)if(dataNameList[e]==series[i].name)for(var j=0;j<series[i].data.length;j++)for(var k=0;k<series[i].data[j].eventInfo.length;k++)seriesNameList[e]==series[i].data[j].eventInfo[k].value&&(series[i].data[j]=_.extend(series[i].data[j],{itemStyle:{normal:{color:colorList[e]}}}));var echartOption={title:titles,legend:{orient:"vertical",left:"left",data:string_keys},tooltip:{trigger:"item",formatter:function formatter(params){var finalResult="",value="",_loop11=function _loop11(_i31){if(void 0===_typeof(tooltip[_i31])||tooltip[_i31].isShow!==!1){var index=_.findIndex(params.data.eventInfo,function(e){return e.col===tooltip[_i31].col});if(index<0)return{v:void 0};value=params.data.eventInfo[index].value;var result=value;tooltip[_i31].formatter&&(result=eval(tooltip[_i31].formatter)),finalResult=finalResult+tooltip[_i31].col+": "+result+"<br/>"}};for(var _i31 in tooltip){var _ret11=_loop11(_i31);if("object"===("undefined"==typeof _ret11?"undefined":_typeof(_ret11)))return _ret11.v}var _loop12=function _loop12(_i32){if(tooltipGroups[_i32].isShow!==!1){var index=_.findIndex(params.data.eventInfo,function(e){return e.col===tooltipGroups[_i32].col});if(index<0)return{v:void 0};value=params.data.eventInfo[index].value;var result=value;tooltipGroups[_i32].formatter&&(result=eval(tooltipGroups[_i32].formatter)),finalResult=finalResult+tooltipGroups[_i32].col+": "+result+"<br/>"}};for(var _i32 in tooltipGroups){var _ret12=_loop12(_i32);if("object"===("undefined"==typeof _ret12?"undefined":_typeof(_ret12)))return _ret12.v}var _loop13=function _loop13(_i33){if(tooltipTarget[_i33]&&tooltipTarget[_i33].isShow!==!1){var index=_.findIndex(data.chartConfig.values[0].cols,function(e){return e.alias===_i33});if(index<0)return"continue";var dataIndex=_.findIndex(aggregate_data[params.seriesIndex],function(e){return"object"===_typeof(params.value)?e===params.value[0]:e===params.value});if(dataIndex<0)return"continue";value=aggregate_data[index][dataIndex];var result=value;tooltipTarget[_i33].formatter&&(result=eval(tooltipTarget[_i33].formatter)),finalResult=finalResult+tooltipTarget[_i33].col+": "+result+"<br/>"}};for(var _i33 in tooltipTarget){var _ret13=_loop13(_i33)}return finalResult+="占比："+params.percent+"%"}},targetData:chartConfig.values,series:series};return updateEchartOptions(chartConfig.option,echartOption),echartOption}}]),discovery.service("chartPie2Service",["BoardParamService","EventService",function(BoardParamService,EventService){"ngInject";this.instance=null,this.render=function(e,t,a,i,r,o){return this.instance=new CBoardEChartRender(e,t,(void 0),o),this.instance.chart(null,i,EventService)},this.parseOption=function(data){var chartConfig=data.chartConfig,casted_values=data.series,aggregate_data=data.data,legend=[],tooltip={},Levi=data.chartConfig.option.tooltip?data.chartConfig.option.tooltip:{},keys=data.chartConfig.keys;for(var _i34 in keys)_.isUndefined(Levi)||(Levi[keys[_i34].col]?(tooltip[keys[_i34].col]=Levi[keys[_i34].col],Levi[keys[_i34].col].col||(tooltip[keys[_i34].col].col=keys[_i34].col)):tooltip[keys[_i34].col]={col:keys[_i34].col,isShow:!0,formatter:""});for(var tooltipTarget={},Target=data.chartConfig.option.tooltipTarget?data.chartConfig.option.tooltipTarget:{},targetValue={},_j14=0;_j14<data.chartConfig.values.length;_j14++)for(var k=0;k<data.chartConfig.values[_j14].cols.length;k++)targetValue[data.chartConfig.values[_j14].cols[k].alias]={col:data.chartConfig.values[_j14].cols[k].alias};if(!_.isUndefined(Target))for(var _i35 in targetValue)tooltipTarget[_i35]=Target[_i35],Target[_i35]?tooltipTarget[_i35]={col:Target[_i35].col?Target[_i35].col:_i35,isShow:!Target[_i35]||Target[_i35].isShow,formatter:Target[_i35]&&Target[_i35].formatter?Target[_i35].formatter:""}:tooltipTarget[_i35]={col:_i35,isShow:!Target[_i35]||Target[_i35].isShow,formatter:Target[_i35]&&Target[_i35].formatter?Target[_i35].formatter:""};for(var tooltipGroups={},Groups=data.chartConfig.option.tooltipGroups,targetGroups=data.chartConfig.groups,_i36=0;_i36<targetGroups.length;_i36++)Groups[targetGroups[_i36].col]?(tooltipGroups[targetGroups[_i36].col]=Groups[targetGroups[_i36].col],Groups[targetGroups[_i36].col].col||(tooltipGroups[targetGroups[_i36].col].col=targetGroups[_i36].col)):tooltipGroups[targetGroups[_i36].col]={col:targetGroups[_i36].col,isShow:!0,formatter:""};var series=[],series_data=[];if(_.isArray(casted_values)&&casted_values.length)for(var i=0;i<casted_values.length;i++)legend.push(casted_values[i][0]),series_data.push({name:casted_values[i][0],value:aggregate_data[i][0]});series=[{type:"pie",center:[chartConfig.centerX?chartConfig.centerX:"50%",chartConfig.centerY?chartConfig.centerY:"50%"],xRadius:[chartConfig.radiusX?chartConfig.radiusX:"0",chartConfig.radiusY?chartConfig.radiusY:"75%"],data:series_data}];for(var i=0;i<series.length;i++)_.isUndefined(chartConfig.series_label)||(chartConfig.series_label===!0?series[i].label={normal:{show:!0}}:series[i].label={normal:{show:!1}});var colorList=[],dataNameList=[],seriesNameList=[];if(chartConfig.option.itemStyle&&chartConfig.option.itemStyle.color&&(colorList=chartConfig.option.itemStyle.color.split(",")),chartConfig.option.itemStyle&&chartConfig.option.itemStyle.dataName&&(dataNameList=chartConfig.option.itemStyle.dataName.split(",")),chartConfig.option.itemStyle&&chartConfig.option.itemStyle.seriesName&&(seriesNameList=chartConfig.option.itemStyle.seriesName.split(",")),chartConfig.option.itemStyle&&chartConfig.option.itemStyle&&chartConfig.option.itemStyle.color&&""!=chartConfig.option.itemStyle.color)for(var e=0;e<colorList.length;e++)if(chartConfig.option.itemStyle.dataName&&(_.isUndefined(chartConfig.option.itemStyle.seriesName)||""==chartConfig.option.itemStyle.seriesName))for(var i=0;i<series.length;i++)for(var j=0;j<series[i].data.length;j++)dataNameList[e]==series[i].data[j].name&&(series[i].data[j]=_.extend(series[i].data[j],{itemStyle:{normal:{color:colorList[e]}}}));var echartOption={legend:{orient:"vertical",left:"left",data:legend},tooltip:{trigger:"item",formatter:function formatter(params){var finalResult="",value="",param=BoardParamService.getAll(),_loop14=function _loop14(_i37){if(tooltipTarget[_i37].isShow!==!1){var index=_.findIndex(data.chartConfig.values[0].cols,function(e){return e.alias===_i37});if(index<0)return{v:void 0};value=aggregate_data[index][0];var result=value;tooltipTarget[_i37].formatter&&(result=eval(tooltipTarget[_i37].formatter)),_i37===params.name&&(finalResult=finalResult+tooltipTarget[_i37].col+": "+result+"<br/>")}};for(var _i37 in tooltipTarget){var _ret14=_loop14(_i37);if("object"===("undefined"==typeof _ret14?"undefined":_typeof(_ret14)))return _ret14.v}return finalResult+="占比："+params.percent+"%"}},targetData:chartConfig.values,series:series};return updateEchartOptions(chartConfig.option,echartOption),echartOption}}]),discovery.service("chartFlexChartService",["EventService",function(EventService){"ngInject";this.instance=null,this.render=function(e,t,a,i,r,o){return this.instance=new CBoardEChartRender(e,t,(void 0),o),this.instance.chart(null,i,EventService)},this.parseOption=function(data,scope){var chartConfig=data.chartConfig,newList=[];if(!_.isUndefined(data.chartConfig.option.flex)){for(var keyNameList=[],i=0;i<data.chartConfig.keys.length;i++)keyNameList.push(data.chartConfig.keys[i].col);for(var i=0;i<data.keys.length;i++){for(var obj={},j=0;j<keyNameList.length;j++)obj[keyNameList[j]]=data.keys[i][j];newList.push(obj)}for(var i=0;i<data.series.length;i++)for(var j=0;j<data.keys.length;j++){var valueName=data.series[i][0],valueData=data.data[i];newList[j][valueName]=valueData[j]}}var echartOption={};try{var draw,flexChart=eval(data.chartConfig.option.flex);_.isFunction(flexChart)&&(echartOption=flexChart(newList,data))}catch(e){console.error("chartFlexChartService:function-this.parseOption,row-11,eval(data.chartConfig.option.flex)执行错误",e)}return echartOption}}]),discovery.service("chartFlexD3ChartService",["uuid4",function(uuid4){"ngInject";this.instance=null,this.render=function(e,t,a,i,r){if(null==t)return void e.html('<div class="alert alert-danger" role="alert">No Data!</div>');var o;a?o=a.myheight:null;var n=uuid4.generate();return e.addClass("d3_"+n),new CBoardD3Render(e,t,this,n).chart(null,i)},this.initCanvas=function(e,t,a){var i="<div>hello world</div>";i='<div id="wrapper">\n\t\t<div id="info" style="opacity: 1;">\n\t\t\t\t<div><span id="name"></span><span id="segment">&nbsp;</span></div>\n\t\t\t\t<div><span id="emissions"></span><span id="percent"></span></div>\n\t\t<div id="tweet-box">\n\t\t\t<i id="close" class="icon-remove"></i>\n\t\t\t<div id="tweet-text"></div>\n\t\t</div>\t\t\n',e.html(i);var r=e.height(),o=e.width(),n=d3.select(".d3_"+a.uuid).append("svg").attr("width",o).attr("height",r).attr("left",200);return n},this.draw=function(container,data,render){render.option=data;var div=this.initCanvas(container,data,render),newList=[];if(!_.isUndefined(data.chartConfig.option.flex)){for(var keyNameList=[],i=0;i<data.chartConfig.keys.length;i++)keyNameList.push(data.chartConfig.keys[i].col);for(var i=0;i<data.keys.length;i++){for(var obj={},j=0;j<keyNameList.length;j++)obj[keyNameList[j]]=data.keys[i][j];newList.push(obj)}for(var i=0;i<data.series.length;i++)for(var j=0;j<data.keys.length;j++){var valueName=data.series[i][0],valueData=data.data[i];newList[j][valueName]=valueData[j]}}var echartOption={};try{var draw,flexD3Chart=eval(data.chartConfig.option.flex);_.isFunction(flexD3Chart)&&flexD3Chart(d3,div,newList,data)}catch(e){console.error("chartFlexD3ChartService:function-this.draw,row-39,eval(data.chartConfig.option.flex)执行错误",e)}},this.redraw=function(e,t){this.draw(e,t.option,t)},this.parseOption=function(e,t){return e}}]),discovery.service("chartSankeyService",["EventService",function(e){"ngInject";this.instance=null,this.render=function(t,a,i,r,o,n){return this.instance=new CBoardEChartRender(t,a,(void 0),n),this.instance.chart(null,r,e)},this.parseOption=function(e){var t=e.chartConfig,a=e.keys,i=e.series,r=e.data,o=(e.seriesConfig,[]),n=_.map(a,function(e){var t=e.join("-");return _.find(o,function(e){return e.name==t})||o.push({name:t}),t});_.each(i,function(e){e.length>1&&e.splice(-1,1);var t=e.join("-");_.find(o,function(e){return e.name==t})||o.push({name:t})});for(var s=[],l=0;l<r.length;l++)for(var c=0;c<r[l].length;c++)if(!_.isUndefined(r[l][c])){var d=CBoardEChartRenderEventInfo(e,l,c);s.push({eventInfo:d,source:n[c],target:i[l].join("-"),value:r[l][c]})}var u={color:["#c23531","#2f4554","#61a0a8","#d48265","#91c7ae","#749f83","#ca8622","#bda29a","#6e7074","#546570","#c4ccd3"],tooltip:{trigger:"item",triggerOn:"mousemove"},toolbox:!1,series:[{type:"sankey",layout:"none",data:o,links:s,itemStyle:{normal:{borderWidth:1,borderColor:"#aaa"}},lineStyle:{normal:{color:"source",curveness:.5}},label:{normal:{color:"#fff"}}}]},f=t.option;return f&&0==f.legendShow&&(u.grid=echartsBasicOption.grid,u.grid.top="5%",u.legend.show=!1),u}}]),discovery.service("chartCircularService",["EventService",function(e){"ngInject";this.instance=null,this.render=function(t,a,i,r,o,n){return this.instance=new CBoardEChartRender(t,a,(void 0),n),this.instance.chart(null,r,e)},this.parseOption=function(e){var t=e.chartConfig,a=e.keys,i=e.series,r=e.data,o=(e.seriesConfig,[]),n=_.map(a,function(e){var t=e.join("-");return _.find(o,function(e){return e.name==t})||o.push({name:t}),t});_.each(i,function(e){e.length>1&&e.splice(-1,1);var t=e.join("-");_.find(o,function(e){return e.name==t})||o.push({name:t})});for(var s=[],l=0;l<r.length;l++)for(var c=0;c<r[l].length;c++)if(!_.isUndefined(r[l][c])){var d=CBoardEChartRenderEventInfo(e,l,c);s.push({eventInfo:d,source:n[c],target:i[l].join("-"),value:r[l][c]})}var u={tooltip:{trigger:"item",triggerOn:"mousemove"},series:[{name:"Les Miserables",type:"graph",layout:"force",data:o,links:s,itemStyle:{normal:{borderWidth:1,borderColor:"#aaa"}},lineStyle:{normal:{color:"source",curveness:.5}}}]},f=t.option;return f&&0==f.legendShow&&(u.grid=echartsBasicOption.grid,u.grid.top="5%",u.legend.show=!1),u}}]),discovery.service("chartEchart3dMapService",["EventService",function(e){"ngInject";this.instance=null,this.render=function(t,a,i,r,o,n){return this.instance=new CBoardEChartRender(t,a,(void 0),n),this.instance.chart(null,r,e)},this.parseOption=function(e){var t=e.chartConfig,a=e.keys,i=e.series,r=e.data,o=(e.seriesConfig,[]),n={},s=[],l=0,c=1;_.isUndefined(t.option.multiple)||(c=t.option.multiple);for(var d=0;d<a.length;d++)parseInt(r[0][d])>l&&(l=r[0][d]);if("scatter3D"==t.values[0].series_type)for(var d=0;d<a.length;d++){var u=$.extend([],a[d]);if(2==u.length)u.push(void 0,r[0][d]),o.push({eventInfo:CBoardEChartRenderEventInfo(e,void 0,d),value:u,symbolSize:r[0][d]/l*(100*c)});else if(3==u.length){var f=u.pop();u.push(void 0,r[0][d],f),o.push({eventInfo:CBoardEChartRenderEventInfo(e,void 0,d),value:u,symbolSize:r[0][d]/l*(100*c)})}}else if("bar3D"==t.values[0].series_type)for(var d=0;d<a.length;d++){var p=$.extend([],a[d]);if(2==p.length)p.push(r[0][d],r[0][d]),o.push({eventInfo:CBoardEChartRenderEventInfo(e,void 0,d),value:p,symbolSize:5});else if(3==p.length){var f=p.pop();p.push(r[0][d],r[0][d],f),o.push({eventInfo:CBoardEChartRenderEventInfo(e,void 0,d),value:p,symbolSize:5})}}_.each(t.values,function(e){var t={color:e.series_color,opacity:.5};"scatter3D"==e.series_type?(n={label:{show:!1},emphasis:{label:{show:!1}},type:e.series_type,coordinateSystem:"globe",blendMode:"lighter",itemStyle:t,data:o,distanceToGlobe:0,distanceToGeo3D:0},s.push(n)):"bar3D"==e.series_type&&(n={label:{show:!1},emphasis:{label:{show:!1}},type:e.series_type,coordinateSystem:"globe",blendMode:"lighter",itemStyle:t,data:o},s.push(n))});var g={tooltip:{trigger:"item",formatter:function(e){var t=("经度："+e.data.value[0]+"<br>纬度："+e.data.value[1],"");return 5==e.data.value.length?t=e.data.value[4]+"<br>"+i[0]+"："+e.data.value[3]:4==e.data.value.length&&(t=i[0]+"："+e.data.value[3]),t}},backgroundColor:null,viewControl:{targetCoord:[116.46,39.92]},globe:{baseTexture:"../imgs/base2.gif",displacementScale:.04,displacementQuality:"normal",shading:"realistic",environment:null,realisticMaterial:{roughness:.2,metalness:0},postEffect:{enable:!0,depthOfField:{enable:!1,focalDistance:150}},temporalSuperSampling:{enable:!0},light:{ambient:{intensity:0},main:{intensity:5,shadow:!0},ambientCubemap:{texture:"../imgs/echart3dMap.hdr",exposure:1,diffuseIntensity:.5,specularIntensity:2}},viewControl:{autoRotate:!1}},series:s},h=t.option;return h&&(void 0==h.autoRotate&&(h.autoRotate=!1),g.globe.viewControl.autoRotate=h.autoRotate,void 0!=h.dye&&(g.globe.shading=h.dye),1==h.height&&(g.globe.heightTexture=null),0==h.height&&(g.globe.heightTexture="../imgs/height.jpg"),0==h.legendShow&&(g.grid=echartsBasicOption.grid,g.grid.top="5%",g.legend.show=!1),void 0!=h.bgImg&&(g.globe.baseTexture=h.bgImg)),g}}]),discovery.service("chartEchart3dMapLineService",["EventService",function(e){"ngInject";this.instance=null,this.render=function(t,a,i,r,o,n){return this.instance=new CBoardEChartRender(t,a,(void 0),n),this.instance.chart(null,r,e)},this.parseOption=function(e){for(var t=e.chartConfig,a=(e.keys,e.series,e.data,e.seriesConfig,["startLongitude","startLatitude","startLabel","startMeans","startType"]),i=["endLongitude","endLatitude","endLabel","endMeans","endType","lineMeans","lineType"],r=["startValue","endValue","lineValue"],o=t.keys,n=t.groups,s=t.values[0].cols,l=e.originalData.data,c=[],d=0;d<l.length;d++){for(var u={},f=l[d],p=0,g=0;g<n.length;g++)"-"!=f[p]&&(u[i[g]]=f[p]),p++;for(var h=0;h<o.length;h++)"-"!=f[p]&&(u[a[h]]=f[p]),p++;for(var m=0;m<s.length;m++)"-"!=f[p]&&(u[r[m]]=f[p]),p++;c.push(u)}var v=["#ffad3d","#00ac57","#d3133e","#2489b0","#5bc0de","#c2ced1"],y=[],b=void 0,w=void 0,C={"default":{color:v[5],opacity:1,width:3},"试验":{color:v[0],opacity:1,width:3},"任务":{color:v[1],opacity:1,width:3},"事件":{color:v[2],opacity:1,width:3},"国际大事":{color:v[3],opacity:1,width:3},"装备调配":{color:v[4],opacity:1,width:3}},x={"default":{color:v[5]},"试验":{color:v[0]},"任务":{color:v[1]},"事件":{color:v[2]},"国际大事":{color:v[3]},"装备调配":{color:v[4]},red:{color:"red"},green:{color:"green"}},S=_.groupBy(c,"lineMeans"),k=[];for(var m in S){for(var T=[],I=0;I<S[m].length;I++){var N=S[m][I];if(void 0!=N.endMeans&&""!=N.endMeans){var L=C[void 0!=N.lineType?N.lineType:"default"];""!=N.lineType&&void 0!=N.lineType&&(L.width=2),T.push({lineStyle:L,coords:[[N.startLongitude,N.startLatitude],[N.endLongitude?N.endLongitude:void 0,N.endLatitude?N.endLatitude:void 0]]})}}k.push({type:"lines3D",name:m,effect:{show:!0,period:6,trailWidth:3,trailLength:.15,trailOpacity:.7,trailColor:"#fff"},blendMode:"lighter",data:T})}for(var d=0;d<c.length;d++){var m=c[d];y.push({name:m.endMeans?m.endMeans:void 0,value:[m.endLongitude,m.endLatitude,w,parseInt(m.endValue),m.endLabel],itemStyle:x[void 0!=m.endType?m.endType:"default"]}),y.push({name:m.startMeans?m.startMeans:void 0,value:[m.startLongitude,m.startLatitude,b,parseInt(m.startValue),m.startLabel],itemStyle:x[void 0!=m.startType?m.startType:"default"]})}k.push({type:"scatter3D",coordinateSystem:"globe",label:{show:!0,position:"right",formatter:function(e){var t="";return void 0!==e.data.value[4]&&e.data.value[4]&&(t=e.data.value[4]),t}},emphasis:{label:{show:!1}},blendMode:"lighter",symbolSize:function(e){return e[3]?e[3]/8:20},data:y});var j={backgroundColor:null,tooltip:{show:!0,trigger:"item",formatter:function(e){return e.name},extraCssText:"text-align: left"},globe:{baseTexture:"../imgs/base.jpg",displacementScale:.04,displacementQuality:"low",heightTexture:"../imgs/height.jpg",environment:null,shading:"realistic",realisticMaterial:{roughness:.2,metalness:0},postEffect:{enable:!0,depthOfField:{enable:!1,focalDistance:150}},temporalSuperSampling:{enable:!0},light:{ambient:{intensity:.2},main:{intensity:2,shadow:!0},ambientCubemap:{texture:"../imgs/echart3dMap.hdr",exposure:1,diffuseIntensity:.5,specularIntensity:2}},viewControl:{autoRotate:!1,targetCoord:[116.46,39.92]}},series:k},$=t.option;return $&&(void 0==$.autoRotate&&($.autoRotate=!1),j.globe.viewControl.autoRotate=$.autoRotate,
void 0!=$.dye&&(j.globe.shading=$.dye),1==$.height&&(j.globe.heightTexture=null),0==$.height&&(j.globe.heightTexture="../imgs/height.jpg"),0==$.legendShow&&(j.grid=echartsBasicOption.grid,j.grid.top="5%",j.legend.show=!1),void 0!=$.bgImg&&(j.globe.baseTexture=$.bgImg)),j}}]),discovery.service("chartEchart3dBarService",["EventService",function(e){"ngInject";this.instance=null,this.render=function(t,a,i,r,o,n){return this.instance=new CBoardEChartRender(t,a,(void 0),n),this.instance.chart(null,r,e)},this.parseOption=function(e){for(var t=e.chartConfig,a=e.keys,i=e.series,r=e.data,o=(e.seriesConfig,[]),n=0,s=_.map(a,function(e){return e.join("-")}),l=_.map(i,function(e){return e.join("-")}),c=0;c<s.length;c++)for(var d=0;d<l.length;d++){var u=[];u.push(c),u.push(d),void 0!=r[d][c]?(parseInt(r[d][c])>n&&(n=r[d][c]),u.push(parseInt(r[d][c]))):u.push(0),o.push(u)}var f={backgroundColor:"transparent",tooltip:{trigger:"item",formatter:function(e){var t=e.data.itemInfo.names,a=e.data.itemInfo.value,i=t.join("-")+":"+a;return i}},visualMap:{max:n,inRange:{color:["#313695","#4575b4","#74add1","#abd9e9","#e0f3f8","#ffffbf","#fee090","#fdae61","#f46d43","#d73027","#a50026"]}},xAxis3D:{type:"category",data:s,axisPointer:{lineStyle:{color:"#900"}}},yAxis3D:{type:"category",data:l,axisPointer:{lineStyle:{color:"#090"}}},zAxis3D:{type:"value",axisPointer:{lineStyle:{color:"#009"}}},grid3D:{boxWidth:250,boxDepth:90,viewControl:{},light:{main:{intensity:1.2,shadow:!0},ambient:{intensity:.3}}},series:[{type:"bar3D",data:o.map(function(e){return{itemInfo:{names:[s[e[0]],l[e[1]]],value:e[2]},value:[e[0],e[1],e[2]],label:{show:!1}}}),bevelSize:.2,bevelSmoothness:3,shading:"lambert",label:{textStyle:{fontSize:16,borderWidth:1}},itemStyle:{opacity:.9},emphasis:{label:{textStyle:{fontSize:20,color:"#900"}},itemStyle:{color:"#900"}}}]},p=t.option;return p&&0==p.legendShow&&(f.grid=echartsBasicOption.grid,f.grid.top="5%",f.legend.show=!1),f}}]),discovery.service("chartEchartCityMapService",["EventService",function(e){"ngInject";this.instance=null,this.render=function(t,a,i,r,o,n){return this.instance=new CBoardEChartRender(t,a,(void 0),n),this.instance.chart(null,r,e)},this.parseOption=function(e){var t=e.originalData.data,a="#e0ffff";e.chartConfig.option.maxColor&&(a=e.chartConfig.option.maxColor);var i="#006edd";e.chartConfig.option.minColor&&(i=e.chartConfig.option.minColor),e.chartConfig.option.minColor;var r=20;e.chartConfig.option.cityMaxRadius&&(r=e.chartConfig.option.cityMaxRadius);var o=10;e.chartConfig.option.cityMinRadus&&(o=e.chartConfig.option.cityMinRadus);var n=convertCityData(t),s=_.max(n,function(e){return e.value[2]}),l={tooltip:{trigger:"item"},visualMap:{min:0,max:1500,left:"left",top:"bottom",text:["High","Low"],seriesIndex:[1],inRange:{color:[i,a]},calculable:!0},geo:{map:"china",roam:!0,label:{normal:{show:!0,textStyle:{}}},itemStyle:{normal:{borderColor:"#D5D5D5",borderWidth:"1",areaColor:"#F5F5F5"},emphasis:{areaColor:null,shadowOffsetX:0,shadowOffsetY:0,shadowBlur:20,borderWidth:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}},series:[{type:"scatter",coordinateSystem:"geo",data:convertCityData(t),symbolSize:function(e,t){var a=parseInt(e[2])/parseInt(s.value[2])*r;return a<o?o:a},symbolRotate:35,itemStyle:{normal:{color:"#F06C00"}}},{name:"categoryA",type:"map",geoIndex:0,data:convertProvinceData(t),label:{normal:{formatter:"{b}",position:"right",show:!1},emphasis:{show:!0}}}]};return l}}]);var city={"海门":[121.15,31.89],"鄂尔多斯":[109.781327,39.608266],"招远":[120.38,37.35],"舟山":[122.207216,29.985295],"齐齐哈尔":[123.97,47.33],"盐城":[120.13,33.38],"赤峰":[118.87,42.28],"青岛":[120.33,36.07],"乳山":[121.52,36.89],"金昌":[102.188043,38.520089],"泉州":[118.58,24.93],"莱西":[120.53,36.86],"日照":[119.46,35.42],"胶南":[119.97,35.88],"南通":[121.05,32.08],"拉萨":[91.11,29.97],"云浮":[112.02,22.93],"梅州":[116.1,24.55],"文登":[122.05,37.2],"攀枝花":[101.718637,26.582347],"威海":[122.1,37.5],"承德":[117.93,40.97],"厦门":[118.1,24.46],"汕尾":[115.375279,22.786211],"潮州":[116.63,23.68],"丹东":[124.37,40.13],"太仓":[121.1,31.45],"曲靖":[103.79,25.51],"烟台":[121.39,37.52],"福州":[119.3,26.08],"瓦房店":[121.979603,39.627114],"即墨":[120.45,36.38],"抚顺":[123.97,41.97],"玉溪":[102.52,24.35],"张家口":[114.87,40.82],"阳泉":[113.57,37.85],"莱州":[119.942327,37.177017],"湖州":[120.1,30.86],"汕头":[116.69,23.39],"昆山":[120.95,31.39],"宁波":[121.56,29.86],"湛江":[110.359377,21.270708],"揭阳":[116.35,23.55],"荣成":[122.41,37.16],"连云港":[119.16,34.59],"葫芦岛":[120.836932,40.711052],"常熟":[120.74,31.64],"东莞":[113.75,23.04],"河源":[114.68,23.73],"淮安":[119.15,33.5],"泰州":[119.9,32.49],"南宁":[108.33,22.84],"营口":[122.18,40.65],"惠州":[114.4,23.09],"江阴":[120.26,31.91],"蓬莱":[120.75,37.8],"韶关":[113.62,24.84],"嘉峪关":[98.289152,39.77313],"延安":[109.47,36.6],"太原":[112.53,37.87],"清远":[113.01,23.7],"中山":[113.38,22.52],"昆明":[102.73,25.04],"寿光":[118.73,36.86],"盘锦":[122.070714,41.119997],"长治":[113.08,36.18],"珠海":[113.52,22.3],"宿迁":[118.3,33.96],"咸阳":[108.72,34.36],"铜川":[109.11,35.09],"平度":[119.97,36.77],"佛山":[113.11,23.05],"海口":[110.35,20.02],"江门":[113.06,22.61],"章丘":[117.53,36.72],"肇庆":[112.44,23.05],"大连":[121.62,38.92],"临汾":[111.5,36.08],"吴江":[120.63,31.16],"石嘴山":[106.39,39.04],"沈阳":[123.38,41.8],"茂名":[110.88,21.68],"嘉兴":[120.76,30.77],"长春":[125.35,43.88],"胶州":[120.03336,36.264622],"银川":[106.27,38.47],"张家港":[120.555821,31.875428],"三门峡":[111.19,34.76],"锦州":[121.15,41.13],"南昌":[115.89,28.68],"柳州":[109.4,24.33],"三亚":[109.511909,18.252847],"自贡":[104.778442,29.33903],"阳江":[111.95,21.85],"泸州":[105.39,28.91],"西宁":[101.74,36.56],"宜宾":[104.56,29.77],"呼和浩特":[111.65,40.82],"大同":[113.3,40.12],"镇江":[119.44,32.2],"桂林":[110.28,25.29],"张家界":[110.479191,29.117096],"宜兴":[119.82,31.36],"北海":[109.12,21.49],"西安":[108.95,34.27],"金坛":[119.56,31.74],"东营":[118.49,37.46],"遵义":[106.9,27.7],"绍兴":[120.58,30.01],"扬州":[119.42,32.39],"常州":[119.95,31.79],"潍坊":[119.1,36.62],"台州":[121.420757,28.656386],"南京":[118.78,32.04],"滨州":[118.03,37.36],"贵阳":[106.71,26.57],"本溪":[123.73,41.3],"克拉玛依":[84.77,45.59],"渭南":[109.5,34.52],"马鞍山":[118.48,31.56],"宝鸡":[107.15,34.38],"焦作":[113.21,35.24],"句容":[119.16,31.95],"徐州":[117.2,34.26],"衡水":[115.72,37.72],"绵阳":[104.73,31.48],"枣庄":[117.57,34.86],"杭州":[120.19,30.26],"淄博":[118.05,36.78],"鞍山":[122.85,41.12],"溧阳":[119.48,31.43],"库尔勒":[86.06,41.68],"安阳":[114.35,36.1],"开封":[114.35,34.79],"济南":[117,36.65],"德阳":[104.37,31.13],"温州":[120.65,28.01],"九江":[115.97,29.71],"邯郸":[114.47,36.6],"临安":[119.72,30.23],"兰州":[103.73,36.03],"沧州":[116.83,38.33],"临沂":[118.35,35.05],"南充":[106.110698,30.837793],"富阳":[119.95,30.07],"泰安":[117.13,36.18],"诸暨":[120.23,29.71],"郑州":[113.65,34.76],"聊城":[115.97,36.45],"芜湖":[118.38,31.33],"平顶山":[113.29,33.75],"邢台":[114.48,37.05],"德州":[116.29,37.45],"济宁":[116.59,35.38],"荆州":[112.239741,30.335165],"宜昌":[111.3,30.7],"义乌":[120.06,29.32],"丽水":[119.92,28.45],"洛阳":[112.44,34.7],"秦皇岛":[119.57,39.95],"株洲":[113.16,27.83],"莱芜":[117.67,36.19],"常德":[111.69,29.05],"湘潭":[112.91,27.87],"岳阳":[113.09,29.37],"长沙":[113,28.21],"衢州":[118.88,28.97],"廊坊":[116.7,39.53],"菏泽":[115.480656,35.23375],"冷饮华东大区":[121.638481,31.230895],"冷饮晋冀蒙大区":[111.660351,40.828319],"冷饮华北大区":[116.521695,39.958953],"冷饮上海直辖区域":[121.487899,31.249162],"冷饮蒙晋大区":[111.660351,40.828319],"冷饮京津大区":[116.521695,39.958953],"乌鲁木齐":[87.583,43.8],"金山工厂":[111.73,40.83],"天津工厂":[117.03,39.38],"密云工厂":[116.83,40.37],"呼市直营":[111.73,40.83],"河南工厂":[113.18,33.77],"肇东工厂":[127,46.63],"沈阳工厂":[123.38,41.8],"苏州工厂":[120.62,31.32],"成都工厂":[103.47,30.42],"衡阳分仓":[112.57,26.9],"青岛分仓":[120.38,36.07],"济南分仓":[116.98,36.67],"天津直营":[117.2005692,39.14493942],"天津分仓":[117.2005692,39.14493942],"上海直营":[121.458,31.222],"南京直营":[118.777,32.061],"天津（分）":[117.13,39.22],"杭州直营":[120.62,31.32],"合肥直营":[117.25,31.83],"西安直营":[108.93,34.27],"武汉直营":[114.31,30.52],"武汉（直）":[114.3,30.6],"深圳直营":[114.07,22.62],"惠州工厂":[114.4,23.09],"太原分仓":[112.53,37.87],"西安分仓":[108.93,34.27],"长沙分仓":[112.93,28.23],"武汉分仓":[114.3,30.6],"南昌分仓":[115.89,28.68],"昆明分仓":[102.73,25.04],"常德分仓":[111.69,29.05],"兰州分仓":[103.73,36.03],"吉安分仓":[114.97,27.12],"厦门分仓":[118.1,24.46],"柳州分仓":[109.4,24.33],"南平分仓":[118.16,26.65],"西南直采":[104.07,30.67],"黄冈工厂":[114.87,30.44],"广佛分仓":[113.27,23.13],"定州工厂":[114.98,36.67],"金川工厂":[111.73,40.83],"北京（东分）":[116.65,39.92],"北京分仓":[116.23,40.22],"北京南直营":[116.219,40.218],"北京北直营":[116.219,40.218],"呼市分仓":[111.652,40.81],"成都分仓":[104.15,30.83],"肇东分仓":[125.983,46.083],"郑州分仓":[113.648,34.757],"调拨库":[124.45,46.87],"新疆分仓":[87.583,43.8],"合肥分仓":[117.28,31.863],"重庆分仓":[106.254,29.29],"广州分仓":[113.35,23.12],"贵阳分仓":[106.716,26.583],"北京直营":[116.46,39.92],"合肥新鲜度项目试点库":[117.28,31.863],"海口分仓":[110.341,20.045],"呼市暂存库":[111.652,40.81],"巴盟分仓":[107.42,40.77],"定州分仓":[114.995,38.513],"辽宁分仓":[123.432,41.792],"乌鲁木齐分仓":[87.583,43.8],"拉萨分仓":[91.1,29.65],"福州分仓":[119.306,26.061],"徐州分仓":[117.157,34.18],"杭州分仓":[120.168,30.255],"北京北暂存库":[116.329,39.721],"北京南暂存库":[116.219,40.218],"天津暂存库":[117.201,39.1449],"上海暂存库":[121.458,31.222],"南充暂存库":[106.084,30.795],"黄冈伊利中心仓":[114.907,30.4461],"肇东暂存库":[125.983,46.083],"苏南暂存库":[121.27,31.38],"贵阳暂存库":[106.716,26.583],"郑州暂存库":[113.648,34.757],"乌鲁木齐成品暂存库":[87.583,43.8],"兰州成品暂存库":[103.792,36.056],"北京暂存库北库":[116.219,40.218],"南京暂存库":[118.777,32.061],"南昌暂存库":[115.883,28.683],"合肥成品暂存库":[117.28,31.863],"定州成品暂存库":[114.995,38.513],"巴彦淖尔成品暂存库":[107.42,40.77],"广东暂存库":[114.4,23.083],"广州暂存库":[113.131,23.026],"徐州暂存库":[117.157,34.18],"成都伊利暂存库":[104.066,30.666],"成都暂存库":[104.066,30.666],"液奶拉萨分仓":[91.1,29.65],"液奶昆明暂存库":[102.718,25.038],"液奶柳州暂存库":[109.169,21.668],"液奶重庆暂存库":[106.254,29.29],"漯河暂存库":[114.02,33.56],"潍坊暂存库":[119.1426,36.71611],"福州暂存库":[119.306,26.061],"晋中伊利暂存库":[112.7345,37.681],"晋南暂存库":[108.928,34.258],"杭州暂存库":[120.168,30.255],"武汉暂存库":[114.266,30.583],"沈阳暂存库":[123.432,41.792],"泰普克成品暂存库":[108.928,34.258],"济南暂存库":[116.997,36.668],"济源暂存库":[112.5873,35.0888],"液奶乌鲁木齐伊利":[87.583,43.8],"液奶兰州乳业":[103.792,36.056],"长沙暂存库":[112.966,28.2],"黄冈伊利暂存库":[114.9066,30.44611],"龙游暂存库":[118.8758,28.95691],"北京暂存库南库":[116.329,39.721],"海口仓":[110.341,20.045],"液奶南充暂存库":[106.084,30.795],"西藏":[91.17849,29.658434],"安徽":[117.233592,31.826705],"川南":[104.693255,28.81582],"湖北外埠":[114.311831,30.598426],"武汉":[114.311831,30.598426],"无锡":[120.313232,31.579529],"广州":[113.30765,23.120049],"闽北":[119.330221,26.047125],"鄂东":[114.311831,30.598426],"吉西":[122.260363,43.633756],"豫北区域":[114.3995,36.103636],"甘青藏":[103.823305,36.064226],"蒙西":[109.787493,39.61474],"苏中":[118.778074,32.057236],"金华":[119.652576,29.102899],"直营一区":[116.4,39.9],"陕南":[108.953098,34.2778],"郑州区域":[113.649644,34.75661],"北京北郊区域":[116.728229,40.154951],"上海经销区域":[121.53,31.22],"济南区域":[117.126488,36.65819],"吉林":[125.344899,43.998252],"湖南":[112.945393,28.234248],"广东":[113.270793,23.135303],"辽宁":[123.453552,41.798305],"广西":[108.372627,22.823604],"陕西":[108.953098,34.2778],"四川":[104.07214,30.578832],"成都":[104.07214,30.578832],"闽南":[118.103886,24.489231],"鄂西":[109.47,30.3],"牡丹江":[129.608035,44.588521],"贵州":[106.724173,26.541413],"呼包宁":[111.660351,40.828319],"豫西":[112.390753,34.671668],"鲁西区域":[117.126488,36.65819],"云南区域":[101.55,25.03],"川北":[104.124269,30.606302],"海南":[110.330802,20.022071],"重庆区域":[106.530635,29.544606],"石家庄":[114.522082,38.048958],"常德区域":[111.653718,29.012149],"赣南区域":[114.935909,25.845296],"上海特通组":[121.75,31.05],"巴氏奶哈尔滨":[126.541745,45.808985],"黑龙江":[126.792044,45.710449],"浙南":[120.565799,28.067865],"广州直营":[113.270793,23.135303],"浙江":[120.162142,30.278988],"苏州":[120.591427,31.307026],"广东外埠":[113.270793,23.135303],"四川外埠":[107.474504,31.214344],"辽西":[123.432791,41.808645],"吉东":[125.313642,43.898338],"浙西":[120.219375,30.259244],"苏中区域":[118.802962,32.064792],"鄂东区域":[114.87,30.45],"豫北":[113.708011,34.797406],"云贵区域":[107.5,26.7],"鲁西南":[116.600798,35.402122],"鲁南":[116.600798,35.402122],"北京南郊区域":[116.740079,39.809815],"北京市区经销区域":[116.521695,39.958953],"包头":[109.846755,40.663633],"江西":[115.864758,28.68833],"蒙晋":[113.138484,41.000889],"重庆":[106.558106,29.56911],"湘北":[113.021311,25.776709],"湘南":[112.945393,28.234248],"福建":[119.303339,26.080457],"河南区域":[113.631768,34.753427],"鄂西区域":[112.250093,32.229169],"赣北":[115.959851,29.667088],"北京":[116.521695,39.958953],"蒙银":[106.238976,38.492391],"保定":[115.49481,38.886565],"直营区域":[116.521695,39.958953],"天津直营区域":[117.207137,39.089475],"上海直营二区":[121.5,31.27],"巴氏奶大庆":[125.110456,46.594889],"信阳区域":[114.099264,32.153182],"苏南":[119.635313,31.26495],"新疆":[87.549219,43.898324],"呼市":[111.755186,40.848657],"云贵":[106.724173,26.541413],"哈尔滨":[126.657717,45.773225],"大庆":[125.02184,46.596709],"蒙东":[113.138484,41.000889],"浙东":[121.579006,29.885259],"直营二区":[117.2,39.12],"晋南":[111.474665,36.125937],"陕北":[109.483933,34.502358],"上海直营一区":[121.43,31.18],"深圳":[114.025974,22.546054],"上海":[121.480237,31.2363],"湖北区域":[114.311831,30.598426],"湖南区域":[112.945393,28.234248],"晋北":[113.306205,40.082539],"山西":[112.555135,37.876812],"鲁中":[119.142634,36.716115],"豫南":[113.941362,33.670704],"鲁中区域":[117.126488,36.65819],"鲁东区域":[120.388969,36.073179],"冀北":[114.892592,40.774341],"漯河区域":[114.046061,33.576279],"洛阳区域":[112.447525,34.657368],"济宁区域":[116.593803,35.420956],"甘青":[103.771994,35.992495],"桂琼":[108.372627,22.823604],"浙北":[120.088993,30.207036],"江苏":[118.802962,32.064792],"辽东":[121.593478,38.94871],"豫南区域":[114.028713,33.019078],"川北区域":[105.849862,32.441794],"川南区域":[103.760824,29.600958],"赣南":[114.94126,25.837178],"蒙中":[118.757106,42.268753],"冀南":[114.511441,36.631195],"湘北区域":[112.950575,27.835846],"宁夏":[106.206479,38.502621],"经销一区":[116.7,39.52],"合肥":[117.247835,31.912901],"皖北区域":[117.233592,31.826705],"赣北区域":[115.893528,28.689578],"巴氏奶牡丹江":[129.640285,44.558309],"新疆区域":[87.623193,43.831481],"市区经销区域":[116.521695,39.958953],"湖北":[114.311831,30.598426],"皖南":[117.233592,31.826705],"粤东":[114.065944,22.548554],"粤西":[110.931773,21.669043],"蒙宁":[106.238976,38.492391],"苏北":[117.188107,34.271553],"苏南区域":[119.635313,31.26495],"云南":[102.839607,24.886079],"江西区域":[115.864758,28.68833],"湘南区域":[112.950575,27.835846],"鲁东":[120.384428,36.105215],"天津":[117.207137,39.089475],"鲁西":[117.024967,36.682785],"皖北":[117.282699,31.866942],"贵州区域":[106.933648,27.731899],"经销二区":[116.521695,39.958953],"经销三区":[117.2,39.12],"经销四区":[118.2,39.63],"唐山":[118.183451,39.650531],"衡阳区域":[112.583819,26.898164],"长沙区域":[112.979353,28.213478],"青岛区域":[120.388969,36.073179],"山东":[117.024967,36.682785],"西北":[108.953098,34.2778],"京津":[116.395645,39.929986],"奶粉华中大区":[114.332868,30.656091],"奶粉闽赣大区":[119.27345,26.04769],"奶粉西南大区":[104.124269,30.606302],"奶粉华南大区":[113.234423,23.093666],"两湖":[114.3162,30.581084],"奶粉华东大区":[121.638481,31.230895],"晋冀蒙":[111.660351,40.828319],"酸奶西北大区":[108.953098,34.2778],"酸奶西南大区":[104.067923,30.679943],"酸奶华中大区":[114.3162,30.581084],"冷饮西北大区":[111.755869,40.84906],"冷饮西南大区":[104.073543,30.658068],"酸奶华南大区":[113.30765,23.120049],"冷饮华南大区":[113.266109,23.144061],"浙沪":[121.487899,31.249162],"冷饮鲁豫大区":[117.117993,36.660062],"冷饮华中大区":[114.305645,30.610203],"酸奶东北大区":[123.432791,41.808645],"闽赣":[119.330221,26.047125],"酸奶晋冀蒙大区":[111.660351,40.828319],"酸奶浙沪大区":[121.487899,31.249162],"酸奶京津大区":[116.521695,39.958953],"云贵广":[108.297234,22.806493],"奶粉西北大区":[108.953098,34.2778],"粤海":[113.30765,23.120049],"酸奶苏皖大区":[118.778074,32.057236],"酸奶鲁豫大区":[117.024967,36.682785],"冷饮浙沪大区":[121.479949,31.236197],"奶粉华北大区":[116.521695,39.958953],"奶粉苏皖大区":[118.765057,32.05724],"奶粉蒙晋大区":[111.660351,40.828319],"东北":[123.432791,41.808645],"奶粉东北大区":[123.453552,41.798305],"冷饮京津冀大区":[117.20459,39.094829],"冷饮东北大区":[123.432592,41.818304],"苏皖":[118.778074,32.057236],"冷饮苏皖大区":[117.233613,31.826381],"河南":[113.649644,34.75661],"奶粉鲁豫大区":[113.708011,34.797406],"销售部软冰业务":[118.864332,28.985379],"华东":[121.480237,31.2363],"华南":[113.270793,23.135303],"北部":[116.413624,39.910837],"华北":[117.126488,36.65819],"东南":[119.303339,26.080457],"西南":[104.07214,30.578832],"华中":[114.311831,30.598426]},province={"北京":!0,"天津":!0,"上海":!0,"重庆":!0,"河北":!0,"河南":!0,"云南":!0,"辽宁":!0,"黑龙江":!0,"湖南":!0,"安徽":!0,"山东":!0,"新疆":!0,"江苏":!0,"浙江":!0,"江西":!0,"湖北":!0,"广西":!0,"甘肃":!0,"山西":!0,"内蒙古":!0,"陕西":!0,"吉林":!0,"福建":!0,"贵州":!0,"广东":!0,"青海":!0,"西藏":!0,"四川":!0,"宁夏":!0,"海南":!0,"台湾":!0,"香港":!0,"澳门":!0};discovery.service("chartEchart3dAreaService",["EventService",function(e){"ngInject";this.instance=null,this.render=function(t,a,i,r,o,n){return this.instance=new CBoardEChartRender(t,a,(void 0),n),this.instance.chart(null,r,e)},this.parseOption=function(e){for(var t=e.chartConfig,a=e.keys,i=e.series,r=e.data,o=(e.seriesConfig,[]),n=0,s=_.map(a,function(e){return e.join("-")}),l=_.map(i,function(e){return e.join("-")}),c=0;c<s.length;c++)for(var d=0;d<l.length;d++){var u=[];u.push(d),u.push(c),void 0!=r[d][c]?(parseInt(r[d][c])>n&&(n=r[d][c]),u.push(parseInt(r[d][c]))):u.push(0),o.push(u)}var f={tooltip:{},backgroundColor:"#fff",visualMap:{show:!1,dimension:2,min:-1,max:n,inRange:{color:["#313695","#4575b4","#74add1","#abd9e9","#e0f3f8","#ffffbf","#fee090","#fdae61","#f46d43","#d73027","#a50026"]}},xAxis3D:{type:"category",data:l,axisPointer:{lineStyle:{color:"#900"}}},yAxis3D:{type:"category",data:s,axisPointer:{lineStyle:{color:"#090"}}},zAxis3D:{type:"value"},grid3D:{viewControl:{}},series:[{type:"surface",wireframe:{},data:o}]},p=t.option;return p&&0==p.legendShow&&(f.grid=echartsBasicOption.grid,f.grid.top="5%",f.legend.show=!1),f}}]),discovery.service("chartBarPolarStackService",["EventService",function(EventService){"ngInject";this.instance=null,this.render=function(e,t,a,i,r,o){return this.instance=new CBoardEChartRender(e,t,(void 0),o),this.instance.chart(null,i,EventService)},this.parseOption=function(data){var tooltip={},Levi=data.chartConfig.option.tooltip,keys=data.chartConfig.keys;for(var _i38 in keys)Levi[keys[_i38].col]?(tooltip[keys[_i38].col]=Levi[keys[_i38].col],Levi[keys[_i38].col].col||(tooltip[keys[_i38].col].col=keys[_i38].col)):tooltip[keys[_i38].col]={col:keys[_i38].col,isShow:!0,formatter:""};for(var tooltipTarget={},Target=data.chartConfig.option.tooltipTarget,targetValue={},_j15=0;_j15<data.chartConfig.values.length;_j15++)for(var k=0;k<data.chartConfig.values[_j15].cols.length;k++)targetValue[data.chartConfig.values[_j15].cols[k].alias]={col:data.chartConfig.values[_j15].cols[k].alias};for(var _i39 in targetValue)tooltipTarget[_i39]=Target[_i39],Target[_i39]&&Target[_i39].col||(tooltipTarget[_i39]={col:_i39,isShow:!Target[_i39]||Target[_i39].isShow,formatter:Target[_i39]?Target[_i39].formatter:""});for(var tooltipGroups={},Groups=data.chartConfig.option.tooltipGroups,targetGroups=data.chartConfig.groups,_i40=0;_i40<targetGroups.length;_i40++)Groups[targetGroups[_i40].col]?(tooltipGroups[targetGroups[_i40].col]=Groups[targetGroups[_i40].col],Groups[targetGroups[_i40].col].col||(tooltipGroups[targetGroups[_i40].col].col=targetGroups[_i40].col)):tooltipGroups[targetGroups[_i40].col]={col:targetGroups[_i40].col,isShow:!0,formatter:""};for(var chartConfig=data.chartConfig,casted_keys=data.keys,casted_values=data.series,aggregate_data=data.data,newValuesConfig=data.seriesConfig,series=new Array,string_keys=_.map(casted_keys,function(e){return e.join("-")}),string_value=_.map(casted_values,function(e){return e.join("-")}),titles=[],i=0;i<aggregate_data.length;i++){for(var s={type:"bar",coordinateSystem:"polar",stack:"a",name:string_value[i],data:[]},j=0;j<aggregate_data[i].length;j++){var eventInfo=CBoardEChartRenderEventInfo(data,i,j),dataItem={eventInfo:eventInfo,name:string_keys[j],value:_.isUndefined(aggregate_data[i][j])?0:aggregate_data[i][j]};chartConfig.config&&chartConfig.config.events.length>0,s.data.push(dataItem)}series.push(s)}var echartOption={tooltip:{trigger:"item",formatter:function formatter(params){var finalResult="",_loop15=function _loop15(_i41){if(tooltip[_i41].isShow!==!1){var index=_.findIndex(data.chartConfig.keys,function(e){return e.col===_i41});if(index<0)return{v:void 0};var _value="";if(tooltip[_i41].formatter&&tooltip[_i41].formatter.indexOf("{v}")!=-1){var _repResult="";"string"==typeof params.data.eventInfo[index].value&&(_repResult=tooltip[_i41].formatter.replace("{v}","'{v}'")),_repResult=_repResult.replace("{v}",params.data.eventInfo[index].value),_value=eval(_repResult)}else _value=params.data.eventInfo[index].value;finalResult=finalResult+tooltip[_i41].col+": "+_value+"<br/>"}};for(var _i41 in tooltip){var _ret15=_loop15(_i41);if("object"===("undefined"==typeof _ret15?"undefined":_typeof(_ret15)))return _ret15.v}for(var _i42 in tooltipGroups)if(void 0===_typeof(tooltipGroups[_i42])||tooltipGroups[_i42].isShow!==!1){var obj=_.where(params.data.eventInfo,{col:_i42});if(0===obj.length)return;var value="";if(tooltipGroups[_i42].formatter&&tooltipGroups[_i42].formatter.indexOf("{v}")!=-1){var repResult="";"string"==typeof obj[0].value&&(repResult=tooltipGroups[_i42].formatter.replace("{v}","'{v}'")),repResult=repResult.replace("{v}",obj[0].value),value=eval(repResult)}else value=obj[0].value;finalResult=finalResult+tooltipGroups[_i42].col+": "+value+"<br/>"}var _loop16=function _loop16(_i43){if(tooltipTarget[_i43].isShow!==!1){var index=_.findIndex(data.chartConfig.values[0].cols,function(e){return e.alias===_i43});if(index<0)return{v:void 0};var dataIndex=_.findIndex(aggregate_data[params.seriesIndex],function(e){return e===params.value});if(dataIndex<0)return{v:void 0};var _value2="";if(tooltipTarget[_i43].formatter&&tooltipTarget[_i43].formatter.indexOf("{v}")!=-1){var _repResult2="";_repResult2="string"==typeof params.value?tooltipTarget[_i43].formatter.replace("{v}","'{v}'"):tooltipTarget[_i43].formatter,_repResult2=_repResult2.replace("{v}",aggregate_data[index][dataIndex]),_value2=eval(_repResult2)}else _value2=aggregate_data[index][dataIndex];finalResult=finalResult+tooltipTarget[_i43].col+": "+_value2+"<br/>"}};for(var _i43 in tooltipTarget){var _ret16=_loop16(_i43);if("object"===("undefined"==typeof _ret16?"undefined":_typeof(_ret16)))return _ret16.v}return finalResult}},angleAxis:{},radiusAxis:{type:"category",data:string_keys,z:10},polar:{},series:series,legend:{show:!0,data:string_value}},tunningOpt=chartConfig.option;return tunningOpt&&0==tunningOpt.legendShow&&(echartOption.grid=echartsBasicOption.grid,echartOption.grid.top="5%",echartOption.legend.show=!1),echartOption}}]),discovery.service("chartPieProportionService",["dataService","EventService",function(e,t){"ngInject";this.instance=null,this.render=function(e,a,i,r,o,n){return this.instance=new CBoardEChartRender(e,a,(void 0),n),this.instance.chart(null,r,t)},this.parseOption=function(e){for(var t=e.chartConfig,a=(t.keys,e.keys),i=e.series,r=e.data,o=(e.seriesConfig,new Array),n=_.map(a,function(e){return e.join("-")}),s=(_.map(i,function(e){return e.join("-")}),100/(9*n.length+1)),l=[],c={normal:{label:{show:!1},labelLine:{show:!1},shadowBlur:40,shadowColor:"rgba(40, 40, 40, 0.5)"}},d={normal:{label:{show:!1},labelLine:{show:!1}},emphasis:{}},u=["#3dd4de","#b697cd","#a6f08f"],f=0;f<n.length;f++){var p={name:n[f],type:"pie",clockWise:!1,radius:[75,85],xRadius:[75,85],itemStyle:c,hoverAnimation:!1,center:[5*s+9*f*s+"%","50%"],data:[]};l.push({textStyle:{fontWeight:"normal",color:"#b697cd",fontSize:15},text:n[f],x:"center",y:"center",left:3*s+9*f*s+"%",top:"90%"});var g={name:n[f],value:_.isUndefined(r[0][f])?0:r[0][f],label:{normal:{formatter:"{d}%",position:"center",show:!0,textStyle:{fontSize:"25",fontWeight:"normal",color:u[f%u.length]}}},itemStyle:{normal:{color:u[f%u.length],shadowColor:u[f%u.length],shadowBlur:10},emphasis:{color:u[f%u.length]}}},h={value:_.isUndefined(r[1][f]-r[0][f])?0:r[1][f]-r[0][f],name:"invisible",itemStyle:d};t.config&&t.config.events.length>0,p.data.push(g),p.data.push(h),o.push(p)}var m={title:l,tooltip:{show:!1},toolbox:{show:!1},series:o};return updateEchartOptions(t.option,m),m}}]),discovery.service("chartRadarService",["EventService",function(e){"ngInject";this.instance=null,this.render=function(t,a,i,r,o,n){return this.instance=new CBoardEChartRender(t,a,(void 0),n),this.instance.chart(null,r,e)},this.parseOption=function(e){for(var t=e.chartConfig,a=e.keys,i=e.series,r=e.data,o=0;o<r.length;o++)for(var n=0;n<r[o].length;n++)_.isUndefined(r[o][n])&&(r[o][n]=0);var s,l=_.map(a,function(e){return e.join("-")}),c=_.map(i,function(e){return e.join("-")}),d=[],u=[];if(t.asRow){for(var o=0;o<l.length;o++){for(var f={value:[],name:l[o]},n=0;n<i.length;n++){f.value[n]=r[n][o];var p=Number(r[n][o]);(_.isUndefined(s)||p>s)&&(s=p)}var g=CBoardEChartRenderEventInfo(d,void 0,o);f.eventInfo=g,d.push(f)}for(var n=0;n<i.length;n++)u.push({name:i[n],max:1.05*s})}else{for(var o=0;o<c.length;o++){for(var f={value:[],name:c[o]},n=0;n<l.length;n++){f.value[n]=r[o][n];var p=Number(r[o][n]);(_.isUndefined(s)||p>s)&&(s=p)}for(var g=[],h=0;h<t.keys.length;h++)a[o]&&g.push({col:t.keys[h].col,alias:t.keys[h].alias,value:a[o][h]});f.eventInfo=g,d.push(f)}for(var n=0;n<l.length;n++)u.push({name:l[n],max:1.05*s})}var m={tooltip:{trigger:"item"},toolbox:!1,legend:{orient:"vertical",left:"left",data:t.asRow?l:c},radar:{name:{textStyle:{fontSize:18}},indicator:u},series:[{name:"radar",type:"radar",itemStyle:{emphasis:{areaStyle:{color:"rgba(0,250,0,0.3)"}}},data:d}]};return updateEchartOptions(t.option,m),m}}]),discovery.service("chartService",["$q","$interpolate","EventService","dataService","chartPieService","chartLineService","chartLine2Service","chartLine3Service","chartFunnelService","chartSankeyService","chartTableService","chartKpiService","chartRadarService","chartMapService","chartScatterService","chartScatter2Service","chartGaugeService","chartWordCloudService","chartEchart3dMapLineService","chartEchartCityMapService","chartEchart3dBarService","chartEchart3dAreaService","chartTreeMapService","chartAreaMapService","chartHeatMapCalendarService","chartHeatMapTableService","chartLiquidFillService","chartMarkLineMapService","chartBarPolarStackService","chartPieProportionService","chartCircularService","chartEchart3dMapService","chartCodeFlowerService","chartD3DemoService","chartFlexService","chartFlex2Service","chartBarLimitsService","chartDataLineTableService","chartGanttService","chartLineMapService","chartPie2Service","chartFlexChartService","chartRoseService","chartFlexD3ChartService","chartD3ChordService","chartCrossTableService","chartCrossTableGreatService","chartSelectorService","chartEchartBmapService","chartEchartZoneMapService","chartTreeGridService",function(e,t,a,i,r,o,n,s,l,c,d,u,f,p,g,h,m,v,y,b,w,C,x,S,k,T,I,N,L,j,A,O,M,R,D,U,F,E,B,P,G,z,V,W,X,q,Y,Z,K,H,J){"ngInject";this.render=function(t,r,o,n,s,l,c,d){var u=e.defer(),f=Q(r.config),p=ee(r.config);return i.getDataSeries(r.datasource,r,r.datasetId,p,function(e){r.noData=!1,0===e.originalData.data.length&&(r.noData=!0);try{var s=f.parseOption(e);o&&o(s),e.drill&&(e.drill.drillDown=function(e,t){i.getDrillPath(r.datasetId,e).then(function(s){var l=_.find(s,function(t){return t.id==e});a.trigger("$drillDown",{widget:n?n.widget:null,param:{data:{eventInfo:[{col:l.col?l.col:l.column}]}},type:"table"});var c=0;_.each(s,function(t,a){t.id==e&&(c=a)});var d=s[++c];_.find(r.config.keys,function(t,a){if(t.id==e)return t.type="=",t.values=[],_.find(r.config.keys,function(e){return e.id==d.id})||r.config.keys.splice(a+1,0,d),!0}),_.find(r.config.groups,function(t,a){if(t.id==e)return t.type="=",t.values=[],_.find(r.config.groups,function(e){return e.id==d.id})||r.config.groups.splice(a+1,0,d),!0}),i.getDataSeries(r.datasource,r,r.datasetId,r.config,function(e){var a=f.parseOption(e);o&&o(a),t(a,e.drill.config,"down")})})},e.drill.drillUp=function(e,t){var s,l,c,d=null,u=i.getDatasetListMap(),p=u[r.datasetId].data.schema.dimension,g=0,h=-1,m=0,v=[];_.find(p,function(t){if(h++,"level"===t.type){var a=_.find(t.columns,function(a,i){if(a.id===e)return c=t.id,v=t.columns,!0});return a}}),r.config.keys.length&&(_.each(r.config.keys,function(t,a){_.find(v,function(e){if(e.id===t.id)return!0})&&g++,t.id==e&&(s=a,d=r.config.keys[a-1].col?r.config.keys[a-1].col:r.config.keys[a-1].column)}),console.log("keyIndex",s),console.log("keySpliceLength",g),console.log("keyOtherLength",h),s&&(r.config.keys[s-1].values=[],r.config.keys.splice(s,g-s+h))),r.config.groups.length&&(_.each(r.config.groups,function(t,a){_.find(v,function(e){if(e.id===t.id)return!0})&&m++,t.id==e&&(l=a,d=r.config.groups[a-1].col?r.config.groups[a-1].col:r.config.groups[a-1].column)}),l&&(r.config.groups[l-1].values=[],r.config.groups.splice(l,m-l+h))),a.trigger("$drillUp",{widget:n?n.widget:null,param:{data:{eventInfo:[{col:d}]}},type:"table"}),i.getDataSeries(r.datasource,r,r.datasetId,r.config,function(e){var a=f.parseOption(e);o&&o(a),t(a,e.drill.config,"up")})})}catch(d){console.log("chartService function-this.render row-27",d)}finally{if(u.resolve(f.render(t,s,n,l,e.drill,c)),_.isUndefined(f.type)||"table"!=f.type||($(document).off("click",".self-table-sort").on("click",".self-table-sort",function(e){function t(e){switch(e){case"fa fa-sort":return"asc";case"fa fa-sort-asc":return"desc";case"fa fa-sort-desc":return null}}$.widgets.sort($(this).parents("table").attr("widget"),$.trim($(this).data("column")),t($(this).children().children().attr("class"))),$.widgets.reload([$(this).parents("table").attr("widget")])}),$(document).off("click",".self-table-tbody").on("click",".self-table-tbody",function(e){var t,i;"DIV"===e.target.tagName||"A"===e.target.tagName||"SPAN"===e.target.tagName?(t=$(e.target).parents("tr"),i=$(e.target).parents("td")):"TD"===e.target.tagName&&(t=$(e.target).parents("tr"),i=$(e.target));var r=$(this).data("eventData"),o=t.data("i"),n=i.data("j");r&&r[o]&&a.trigger("$click",{wName:t.parents("table").attr("widget"),param:{this_tr:t,this_td:i,td_index:n,data:{eventInfo:r[o]}},isActive:t.hasClass("highlight_tr"),type:"table"})})),!f.instance||_.isUndefined(f.instance)||_.isUndefined(f.instance.render)||"crossTable"!=f.instance.render.chartType||(document.oncontextmenu=function(){return!1},$(document).off("click","table th,td").on("click","table th,td",function(e){a.trigger("CE:drillDown",{widget:n?n.widget:null,param:{name:$(this).data("name"),drillType:$(this).data("type")?$(this).data("type"):""}})}),$(document).off("mousedown","table th,td").on("mousedown","table th,td",function(e){3==e.which&&a.trigger("CE:drillUp",{widget:n?n.widget:null,param:{name:$(this).data("name"),drillType:$(this).data("type")?$(this).data("type"):""}})})),!f.instance||_.isUndefined(f.instance)||_.isUndefined(f.instance.render)||"crossGreatTable"!=f.instance.render.chartType||$(document).off("click","table th a").on("click","table th a",function(e){a.trigger("CE:"+$(this).data("type"),{widget:n?n.widget:null,param:{index:$(this).data("index"),name:$(this).data("name"),drillType:"key",key:$(this).data("key")?$(this).data("key"):"",isGreat:!0}})}),f.instance&&f.instance.render&&n&&f.instance.render.setWidget(n.widget),f.instance&&f.instance.ecc){window.$$dlut_echart_timeout=!1,document.oncontextmenu=function(){return!1},f.instance.ecc.getZr().on("click",function(e){window.$$dlut_echart_timeout?window.$$dlut_echart_timeout=!1:(e.trigger="blank",a.trigger("CE:click",{widget:n.widget,param:e,type:"chart"}))});var p;f.instance.ecc.on("click",function(e){p=!0,window.$$dlut_echart_timeout=!0,setTimeout(function(){p&&(window.$$dlut_echart_timeout=!0,n&&a.trigger("CE:click",{widget:n.widget,param:e,type:"chart"}))},250)}),f.instance.ecc.on("dblclick",function(e){p=!1,window.$$dlut_echart_timeout=!0,"undefined"==typeof e.region&&a.trigger("CE:drillDown",{widget:n?n.widget:null,param:e,type:"chart"}),setTimeout(function(){p=!0},300)}),f.instance.ecc.on("mousedown",function(e,t){3==e.event.which&&a.trigger("CE:drillUp",{widget:n?n.widget:null,param:e,type:"chart"})})}!f.instance||_.isUndefined(f.instance)||_.isUndefined(f.instance.render)||"treeGrid"!=f.instance.render.chartType||f.instance.render.treeGrid.on("expand",function(e,t){t.name=t.record[t.option.root],a.trigger("CE:drillDown",{widget:n?n.widget:null,param:t,type:"treeGrid",tier:t.tier,filters:t.filters})})}},s,d),u.promise},this.realTimeRender=function(e,t,a,r,o){if(e){var n=Q(t.config);i.getDataSeries(t.datasource,t,t.datasetId,t.config,function(i){t.noData=!1,0===i.originalData.data.length&&(t.noData=!0);var r=n.parseOption(i);a&&a(r),e(r,i.drill?i.drill.config:null,t),o&&o(r,t,i)})}};var Q=function(e){var t;switch(e.chart_type){case"cityMap":t=K;
break;case"zoneMap":t=H;break;case"line":t=o;break;case"line2":t=n;break;case"line3":t=s;break;case"pie":t=r;break;case"kpi":t=u;break;case"table":t=d;break;case"crossTable":t=q;break;case"treeGrid":t=J;break;case"crossGreatTable":t=Y;break;case"selector":t=Z;break;case"funnel":t=l;break;case"sankey":t=c;break;case"circular":t=A;break;case"echart3dMap":t=O;break;case"echart3dMapLine":t=y;break;case"echart3dBar":t=w;break;case"echart3dArea":t=C;break;case"barPolarStack":t=L;break;case"pieProportion":t=j;break;case"radar":t=f;break;case"map":t=p;break;case"scatter":t=g;break;case"scatter2":t=h;break;case"gauge":t=m;break;case"wordCloud":t=v;break;case"treeMap":t=x;break;case"areaMap":t=S;break;case"heatMapCalendar":t=k;break;case"heatMapTable":t=T;break;case"markLineMap":t=N;break;case"liquidFill":t=I;break;case"d3Demo":t=R;break;case"codeFlower":t=M;break;case"flex":t=D;break;case"flex2":t=U;break;case"barLimits":t=F;break;case"lineMap":t=P;break;case"dataLineTable":t=E;break;case"gantt":t=B;break;case"pie2":t=G;break;case"flexChart":t=z;break;case"rose":t=V;break;case"flexD3Chart":t=W;break;case"chord":t=X}return t},ee=function(e){e=angular.copy(e);var t;switch(e.chart_type){case"xxxxxxx":var a=[e.groups[0]],i=[e.keys[0]];e.groups=a,e.keys=i,t=e;break;default:t=e}return t}}]),discovery.service("chartMapService",function(){"ngInject";this.render=function(e,t,a,i,r){if(null==t)return void e.html('<div class="alert alert-danger" role="alert">No Data!</div>');var o;return a?o=a.myheight:null,new CBoardMapRender(e,t,r)["do"](o,i)},this.parseOption=function(e){var t=chartDataProcess(e.chartConfig,e.keys,e.series,e.data,e.seriesConfig);return t}}),discovery.service("updateService",function(){"ngInject";this.updateConfig=function(e){var t=function(e){return _.isString(e)?{col:e,type:"eq",values:[]}:e};switch(e.keys=_.map(e.keys,t),e.groups=_.map(e.groups,t),e.filters||(e.filters=[]),e.events||(e.events=[]),e.chart_type){case"pie":e.groups||(e.groups=[]);break;case"line":e.valueAxis||(e.valueAxis="vertical")}},this.updateBoard=function(e){void 0!==e.layout&&_.each(e.layout.rows,function(e){e.type||(e.type="widget")})}}),discovery.service("chartRoseService",["EventService",function(e){"ngInject";this.instance=null,this.render=function(t,a,i,r,o,n){return this.instance=new CBoardEChartRender(t,a,(void 0),n),this.instance.chart(null,r,e)},this.parseOption=function(e){var t={},a=e.chartConfig.option.tooltip,i=e.chartConfig.keys;for(var r in i)a[i[r].col]?(t[i[r].col]=a[i[r].col],a[i[r].col].col||(t[i[r].col].col=i[r].col)):t[i[r].col]={col:i[r].col,isShow:!0,formatter:""};for(var o={},n=e.chartConfig.option.tooltipTarget,s={},l=0;l<e.chartConfig.values.length;l++)for(var c=0;c<e.chartConfig.values[l].cols.length;c++)s[e.chartConfig.values[l].cols[c].col]={col:e.chartConfig.values[l].cols[c].col};for(var d in s)o[d]=n[d],n[d]&&n[d].col||(o[d]={col:d,isShow:!n[d]||n[d].isShow,formatter:""});for(var u={},f=e.chartConfig.option.tooltipGroups,p=e.chartConfig.groups,g=0;g<p.length;g++)f[p[g].col]?(u[p[g].col]=f[p[g].col],f[p[g].col].col||(u[p[g].col].col=p[g].col)):u[p[g].col]={col:p[g].col,isShow:!0,formatter:""};for(var h=e.chartConfig,m=e.keys,v=e.series,y=e.data,b=e.seriesConfig,w=new Array,C=_.map(m,function(e){return e.join("-")}),x=h.option,S=[],k=0;y[0]&&k<y[0].length;k++){for(var T=0,I=0;I<y.length;I++)T+=y[I][k]?Number(y[I][k]):0,y[I][k]=y[I][k]?Number(y[I][k]):0;S[k]=T}for(var N=[],I=0;I<h.values.length;I++)for(var L=h.values[I].unit?h.values[I].unit:"",k=0;k<h.values[I].cols.length;k++)N.push(L);for(var j=[],$=e.series.length/N.length,I=0;I<$;I++)j=j.concat(N);for(var I=0;I<y.length;I++){var A=v[I].join("-"),O=angular.copy(b[A]);O.name=A,O.data=y[I],O.barMaxWidth=40,_.isUndefined(h.option.barWidth)||""==h.option.barWidth||(O.barWidth=h.option.barWidth),O.type="bar",O.stack=O.valueAxisIndex.toString(),O.coordinateSystem="polar","horizontal"==h.valueAxis?O.xAxisIndex=O.valueAxisIndex:O.yAxisIndex=O.valueAxisIndex;for(var M=[],L=j[I],R="",D="",k=0;k<O.data.length;k++){"元"==L||"万"==L||"亿"==L?(L=dlut.utils.convertMoney(O.data[k],L),R=L.substr(L.length-1,L.length),D=L.substr(0,L.length-1)):"100%"==L?(D=Math.floor(100*O.data[k]),R="%"):"100.00%"==L?(D=(100*O.data[k]).toFixed(2),R="%"):"100.0%"==L&&(D=(100*O.data[k]).toFixed(1),R="%");var U=CBoardEChartRenderEventInfo(e,I,k),F={eventInfo:U,value:""==D?O.data[k]:D,unit:""==R?L:R};M.push(F)}O.data=M,w.push(O)}var E={};if(!_.isUndefined(h.option.label)){var B={top:"insideTop",bottom:"insideBottom"},P={top:"insideRight",bottom:"insideLeft"};if(_.isUndefined(h.option.label.position)||(E="horizontal"==h.valueAxis?{position:P[h.option.label.position]}:{position:B[h.option.label.position]}),!_.isUndefined(h.option.label.offset)){var G=[0,0];_.isUndefined(h.option.label.offset.top)||(G[1]=-h.option.label.offset.top),_.isUndefined(h.option.label.offset.bottom)||(G[1]=Number(h.option.label.offset.bottom)),_.isUndefined(h.option.label.offset.left)||(G[0]=-h.option.label.offset.left),_.isUndefined(h.option.label.offset.right)||(G[0]=Number(h.option.label.offset.right)),E.offset=G}}var z=angular.copy(h.values);_.each(z,function(e,t){e.axisLabel={formatter:function(e){return numbro(e).format("0a.[0000]")}},e.nameGap=0,"percentbar"==e.series_type?(e.min=0,e.max=100):(e.min=e.min?e.min:null,e.max=e.max?e.max:null),t>0&&(e.splitLine=!1),e.scale=!0});for(var I=0;I<z.length;I++)h.values[I].series_label&&("true"==h.values[I].series_logarithm?z[I]={type:"log"}:"false"==h.values[I].series_logarithm&&(z[I]={type:"value"}));var V=[],W=[],X=[];if(h.option.itemStyle&&h.option.itemStyle.color&&(V=h.option.itemStyle.color.split(",")),h.option.itemStyle&&h.option.itemStyle.dataName&&(W=h.option.itemStyle.dataName.split(",")),h.option.itemStyle&&h.option.itemStyle.seriesName&&(X=h.option.itemStyle.seriesName.split(",")),h.option.itemStyle&&h.option.itemStyle&&h.option.itemStyle.color&&""!=h.option.itemStyle.color)for(var q=0;q<V.length;q++)if(h.option.itemStyle.dataName&&(_.isUndefined(h.option.itemStyle.seriesName)||""==h.option.itemStyle.seriesName)){for(var I=0;I<w.length;I++)if(W[q]==w[I].name)for(var k=0;k<w[I].data.length;k++)w[I].data[k]=_.extend(w[I].data[k],{itemStyle:{normal:{color:V[q]}}})}else if(h.option.itemStyle.dataName&&h.option.itemStyle.seriesName)for(var I=0;I<w.length;I++)if(W[q]==w[I].name)for(var k=0;k<w[I].data.length;k++)for(var Y=0;Y<w[I].data[k].eventInfo.length;Y++)X[q]==w[I].data[k].eventInfo[Y].value&&(w[I].data[k]=_.extend(w[I].data[k],{itemStyle:{normal:{color:V[q]}}}));var Z={angleAxis:{type:"category",data:C,z:10},radiusAxis:{},polar:{},grid:angular.copy(echartsBasicOption.grid),legend:{data:_.map(v,function(e){return e.join("-")})},tooltip:{formatter:function(e){var t=e[0].name,a="";""!=e[0].name&&(a+=t+"</br>");for(var i=0;i<h.values.length;i++){if("percentbar"==h.values[i].series_type)for(var r=0;r<e.length;r++)a+=e[r].seriesName+" : "+e[r].data.value[2]+e[r].data.unit+"("+e[r].data.value[1]+"%)</br>";else for(var i=0;i<e.length;i++)a+='<span style="display:inline-block;margin-right:5px;border-radius:10px;width:9px;height:9px;background-color:'+e[i].color+'"></span>',a+=e[i].seriesName+" : "+e[i].value+(e[i].data.unit?e[i].data.unit:""),a+="<br>";return a}}},series:w};return updateEchartOptions(x,Z),Z}}]),discovery.service("chartD3ChordService",["uuid4",function(e){"ngInject";this.render=function(t,a,i,r,o){if(null==a)return void t.html('<div class="alert alert-danger" role="alert">No Data!</div>');var n;i?n=i.myheight:null;var s=e.generate();return t.addClass("d3_"+s),new CBoardD3Render(t,a,this,s).chart(null,r)},this.parseOption=function(e){var t=e.keys,a=e.series,i=e.data,r=[],o=_.map(t,function(e){var t=e.join("-");return _.find(r,function(e){return e.name==t})||r.push({name:t}),t});_.each(a,function(e){e.length>1&&e.splice(-1,1);var t=e.join("-");_.find(r,function(e){return e.name==t})||r.push({name:t})});for(var n=[],s=0;s<i.length;s++)for(var l=0;l<i[s].length;l++)if(!_.isUndefined(i[s][l])){var c=CBoardEChartRenderEventInfo(e,s,l);n.push({eventInfo:c,source:o[l],target:a[s].join("-"),value:i[s][l]})}var d={};for(var u in r)d[r[u].name]=u;matrix=[];for(var f in r){var p=createArrayWith(r.length,0);for(var g in n)if(r[f].name===n[g].source){var h=d[n[g].target];p[h]=parseInt(n[g].value)}matrix.push(p)}var m={matrix:matrix,node:r};return m},this.initCanvas=function(e,t,a){html="<div>hello world</div>",html='<div id="wrapper">\n\t\t<div id="info" style="opacity: 1;">\n\t\t\t\t<div><span id="name"></span><span id="segment">&nbsp;</span></div>\n\t\t\t\t<div><span id="emissions"></span><span id="percent"></span></div>\n\t\t<div id="tweet-box">\n\t\t\t<i id="close" class="icon-remove"></i>\n\t\t\t<div id="tweet-text"></div>\n\t\t</div>\t\t\n',e.html(html);var i=e.height(),r=e.width(),o=d3.select(".d3_"+a.uuid).append("svg:svg").attr("width",r).attr("height",i);return o},this.draw=function(e,t,a){a.option=t;var i=this.initCanvas(e,t,a),r=t.matrix,o=e.width(),n=e.height(),s=.5*Math.min(o,n)-60;innerRadius=s-10;var l=d3.layout.chord().padding(.05).sortSubgroups(d3.descending).matrix(r),c=d3.scale.ordinal().domain(d3.range(4)).range(["#000000","#FFDD89","#957244","#F26223"]),d=i.append("svg:svg").attr("width",o).attr("height",n).append("svg:g").attr("transform","translate("+o/2+","+n/2+")"),u=d.append("svg:g").selectAll("g").data(l.groups).enter().append("svg:g");u.append("path").data(l.groups).style("fill",function(e){return c(e.index)}).style("stroke",function(e){return c(e.index)}).attr("d",d3.svg.arc().innerRadius(innerRadius).outerRadius(s)).on("mouseover",fade(.1,d)).on("mouseout",fade(1,d)),u.append("text").each(function(e,a){e.angle=(e.startAngle+e.endAngle)/2,e.name=t.node[e.index].name}).attr("dy",".35em").attr("transform",function(e){return"rotate("+180*e.angle/Math.PI+")translate(0,"+-1*(s+50)+")"+(e.angle>3*Math.PI/4&&e.angle<5*Math.PI/4?"rotate(180)":"")}).text(function(e){return e.name});var f=d.append("svg:g").selectAll("g").data(l.groups).enter().append("svg:g").selectAll("g").data(groupTicks).enter().append("svg:g").attr("transform",function(e){return"rotate("+(180*e.angle/Math.PI-90)+")translate("+s+",0)"});f.append("svg:line").attr("x1",1).attr("y1",0).attr("x2",5).attr("y2",0).style("stroke","#000"),f.append("svg:text").attr("x",8).attr("dy",".35em").attr("text-anchor",function(e){return e.angle>Math.PI?"end":null}).attr("transform",function(e){return e.angle>Math.PI?"rotate(180)translate(-16)":null}).text(function(e){return e.label}),d.append("svg:g").attr("class","chord").selectAll("path").data(l.chords).enter().append("svg:path").style("fill",function(e){return c(e.target.index)}).attr("d",d3.svg.chord().radius(innerRadius)).style("opacity",1).on("mouseover",function(e){return tooltip.text(t.node[e.source.index].name+"--"+t.node[e.target.index].name+":"+e.source.value),tooltip.style("visibility","visible")}).on("mousemove",function(e){return tooltip.text(t.node[e.source.index].name+"--"+t.node[e.target.index].name+":"+e.source.value),tooltip.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+10+"px")}).on("mouseout",function(){return tooltip.style("visibility","hidden")})},this.redraw=function(e,t){this.draw(e,t.option,t)}}]);var fade=function(e,t,a){return function(a,i){t.selectAll("g.chord path").filter(function(e){return e.source.index!=i&&e.target.index!=i}).transition().style("opacity",e)}},groupTicks=function(e){var t=(e.endAngle-e.startAngle)/e.value,a=20,i=5;return e.value>500?a=50:e.value>1e3&&(a=100),d3.range(0,e.value,a).map(function(a,r){return{angle:a*t+e.startAngle,label:r%i?null:a}})},createArrayWith=function(e,t){return Array.apply(null,new Array(e)).map(function(){return t})};discovery.service("chartTableService",["EventService",function(e){"ngInject";this.render=function(t,a,i,r,o){if(null==a)return void t.html('<div class="alert alert-danger" role="alert">No Data!</div>');var n;return i?n=i.myheight:null,this.type="table",new CBoardTableRender(t,a,o)["do"](n,r,e)},this.parseOption=function(e){var t=chartDataProcess(e.chartConfig,e.keys,e.series,e.data,e.seriesConfig,e.originalData,e.wName);return t}}]),discovery.service("chartScatterService",["dataService","BoardParamService","EventService",function(dataService,BoardParamService,EventService){"ngInject";this.instance=null,this.render=function(e,t,a,i,r,o){return this.instance=new CBoardEChartRender(e,t,(void 0),o),this.instance.chart(null,i,EventService)},this.parseOption=function(data){var tooltip={},Levi=data.chartConfig.option.tooltip,keys=data.chartConfig.keys;for(var _i49 in keys)Levi[keys[_i49].col]?(tooltip[keys[_i49].col]=Levi[keys[_i49].col],Levi[keys[_i49].col].col||(tooltip[keys[_i49].col].col=keys[_i49].col)):tooltip[keys[_i49].col]={col:keys[_i49].col,isShow:!0,formatter:keys[_i49]&&keys[_i49].formatter?keys[_i49].formatter:""};for(var tooltipTarget={},Target=data.chartConfig.option.tooltipTarget,targetValue={},_j18=0;_j18<data.chartConfig.values.length;_j18++)for(var k=0;k<data.chartConfig.values[_j18].cols.length;k++)targetValue[data.chartConfig.values[_j18].cols[k].alias]={col:data.chartConfig.values[_j18].cols[k].alias};for(var _i50 in targetValue)tooltipTarget[_i50]=Target[_i50],Target[_i50]&&Target[_i50].col||(tooltipTarget[_i50]={col:_i50,isShow:!Target[_i50]||Target[_i50].isShow,formatter:Target[_i50]&&Target[_i50].formatter?Target[_i50].formatter:""});for(var tooltipGroups={},Groups=data.chartConfig.option.tooltipGroups,targetGroups=data.chartConfig.groups,_i51=0;_i51<targetGroups.length;_i51++)Groups[targetGroups[_i51].col]?(tooltipGroups[targetGroups[_i51].col]=Groups[targetGroups[_i51].col],Groups[targetGroups[_i51].col].col||(tooltipGroups[targetGroups[_i51].col].col=targetGroups[_i51].col)):tooltipGroups[targetGroups[_i51].col]={col:targetGroups[_i51].col,isShow:!0,formatter:targetGroups[_i51]&&targetGroups[_i51].formatter?targetGroups[_i51].formatter:""};for(var chartConfig=data.chartConfig,casted_keys=data.keys,casted_values=data.series,aggregate_data=data.data,newValuesConfig=data.seriesConfig,tunningOpt=chartConfig.option,data_copy=data,string_keys=_.map(casted_keys,function(e){return e.join("-")}),series=[],valueName=[],i=0;i<casted_values.length;i++){var joined_values=casted_values[i].join("-"),valueAxisIndex=newValuesConfig[joined_values].valueAxisIndex,name=casted_values[i].slice(0,-1).join("-"),s=_.find(series,function(e){return e.name==name});s||(s={name:name},series.push(s)),0==valueAxisIndex&&(s.yIdx=i),1==valueAxisIndex&&(s.sizeIdx=i),2==valueAxisIndex&&(s.colorIdx=i),valueName[valueAxisIndex]=casted_values[i][casted_values[i].length-1]}var data=_.unzip(aggregate_data);_.each(series,function(e,t){e.data=_.map(data,function(a,i){var r=CBoardEChartRenderEventInfo(data_copy,t,i);return[string_keys[i],a[e.yIdx],a[e.sizeIdx]?a[e.sizeIdx]:1,a[e.colorIdx]?a[e.colorIdx]:1,r]}),e.sizeMax=_.max(e.data,function(e){return Number(e[2])})[2],e.sizeMin=_.min(e.data,function(e){return Number(e[2])})[2],e.colorMax=_.max(e.data,function(e){return Number(e[3])})[3],e.colorMin=_.min(e.data,function(e){return Number(e[3])})[3]});var sizeMax=_.max(series,function(e){return Number(e.sizeMax)}).sizeMax,sizeMin=_.min(series,function(e){return Number(e.sizeMin)}).sizeMin,colorMax=_.max(series,function(e){return Number(e.colorMax)}).colorMax,colorMin=_.max(series,function(e){return Number(e.colorMin)}).colorMin;if(tunningOpt){var labelInterval,labelRotate;tunningOpt.ctgLabelInterval?labelInterval=tunningOpt.ctgLabelInterval:"auto",tunningOpt.ctgLabelRotate?labelRotate=tunningOpt.ctgLabelRotate:0}var echartOption={legend:{data:_.map(series,function(e){return e.name})},tooltip:{trigger:"item",formatter:function formatter(params){var param=BoardParamService.getAll(),value="",finalResult="",_loop17=function _loop17(_i52){if(void 0===_typeof(tooltip[_i52])||tooltip[_i52].isShow!==!1){var index=_.findIndex(params.data[params.data.length-1],function(e){return e.col===_i52});if(index<0)return{v:void 0};value=params.data[params.data.length-1][index].value;var _result3=value;tooltip[_i52].formatter&&(_result3=eval(tooltip[_i52].formatter)),finalResult=finalResult+tooltip[_i52].col+": "+_result3+"<br/>"}};for(var _i52 in tooltip){var _ret17=_loop17(_i52);if("object"===("undefined"==typeof _ret17?"undefined":_typeof(_ret17)))return _ret17.v}for(var _i53 in tooltipGroups)if(void 0===_typeof(tooltipGroups[_i53])||tooltipGroups[_i53].isShow!==!1){var obj=_.where(params.value[params.value.length-1],{col:_i53});if(0===obj.length)return;value=obj[0].value;var result=value;tooltipGroups[_i53].formatter&&(result=eval(tooltipGroups[_i53].formatter)),finalResult=finalResult+tooltipGroups[_i53].col+": "+result+"<br/>"}for(var _i54 in tooltipTarget)if(void 0===_typeof(tooltipTarget[_i54])||tooltipTarget[_i54].isShow!==!1){for(var arr=[],_j19=0;_j19<data.length;_j19++)arr.push(_.difference(data[_j19],[void 0,"undefined"]));var targetArray=_.keys(tooltipTarget);value=arr[params.dataIndex][_.indexOf(targetArray,_i54)];var _result2=value;tooltipTarget[_i54].formatter&&(_result2=eval(tooltipTarget[_i54].formatter)),finalResult=finalResult+tooltipTarget[_i54].col+": "+_result2+"<br/>"}return finalResult}},xAxis:{data:string_keys,splitLine:{lineStyle:{type:"dashed"}},axisLabel:{interval:labelInterval,rotate:labelRotate}},yAxis:{axisLabel:{formatter:function(e){return numbro(e).format("0a.[0000]")}},splitLine:{lineStyle:{type:"dashed"}},scale:!0},visualMap:[{dimension:2,show:!1,min:.8*sizeMin,max:1.5*sizeMax,calculable:!0,precision:.1,textStyle:{color:"white"},inRange:{symbolSize:[5,70]}},{dimension:3,show:!1,min:colorMin,max:colorMax,inRange:{opacity:[.2,1]}}],targetData:chartConfig.values,series:_.map(series,function(e){return{name:e.name,data:e.data,type:"scatter",label:e.label}})};return updateEchartOptions(chartConfig.option,echartOption),echartOption}}]),discovery.service("chartScatter2Service",["dataService","BoardParamService","EventService",function(dataService,BoardParamService,EventService){"ngInject";this.instance=null,this.render=function(e,t,a,i,r,o){return this.instance=new CBoardEChartRender(e,t,(void 0),o),this.instance.chart(null,i,EventService)},this.parseOption=function(data){var scatterData=data,markLineCode=data.chartConfig.markLineCode,tooltip={},Levi=data.chartConfig.option.tooltip,keys=data.chartConfig.keys;for(var _i55 in keys)Levi[keys[_i55].col]?(tooltip[keys[_i55].col]=Levi[keys[_i55].col],Levi[keys[_i55].col].col||(tooltip[keys[_i55].col].col=keys[_i55].col)):tooltip[keys[_i55].col]={col:keys[_i55].col,isShow:!0,formatter:""};for(var tooltipTarget={},Target=data.chartConfig.option.tooltipTarget,targetValue={},_j20=0;_j20<data.chartConfig.values.length;_j20++)for(var k=0;k<data.chartConfig.values[_j20].cols.length;k++)targetValue[data.chartConfig.values[_j20].cols[k].alias]={col:data.chartConfig.values[_j20].cols[k].alias};for(var _i56 in targetValue)tooltipTarget[_i56]=Target[_i56],Target[_i56]&&Target[_i56].col||(tooltipTarget[_i56]={col:_i56,isShow:!Target[_i56]||Target[_i56].isShow,formatter:Target[_i56]&&Target[_i56].formatter?Target[_i56].formatter:""});for(var tooltipGroups={},Groups=data.chartConfig.option.tooltipGroups,targetGroups=data.chartConfig.groups,_i57=0;_i57<targetGroups.length;_i57++)Groups[targetGroups[_i57].col]?(tooltipGroups[targetGroups[_i57].col]=Groups[targetGroups[_i57].col],Groups[targetGroups[_i57].col].col||(tooltipGroups[targetGroups[_i57].col].col=targetGroups[_i57].col)):tooltipGroups[targetGroups[_i57].col]={col:targetGroups[_i57].col,isShow:!0,formatter:targetGroups[_i57]&&targetGroups[_i57].formatter?targetGroups[_i57].formatter:""};var chartConfig=data.chartConfig,casted_keys=data.keys,casted_values=data.series,aggregate_data=data.data,newValuesConfig=data.seriesConfig,tunningOpt=chartConfig.option,data_copy=data,string_keys=_.map(casted_keys,function(e){return e.join("-")}),cityMaxRadius=20;data.chartConfig.option.cityMaxRadius&&(cityMaxRadius=data.chartConfig.option.cityMaxRadius);var cityMinRadus=10;data.chartConfig.option.cityMinRadus&&(cityMinRadus=data.chartConfig.option.cityMinRadus);for(var series=[],valueName=[],i=0;i<casted_values.length;i++){var joined_values=casted_values[i].join("-"),valueAxisIndex=newValuesConfig[joined_values].valueAxisIndex,name=casted_values[i].slice(0,-1).join("-"),s=_.find(series,function(e){return e.name==name});s||(s={name:name},series.push(s)),0==valueAxisIndex&&(s.xIdx=i),1==valueAxisIndex&&(s.yIdx=i),2==valueAxisIndex&&(s.sizeIdx=valueAxisIndex),3==valueAxisIndex&&(s.colorIdx=i),s.type="scatter",valueName[valueAxisIndex]=casted_values[i][casted_values[i].length-1]}var data=_.unzip(aggregate_data);if(_.each(series,function(e,t){if(e.data=_.map(data,function(e,t){var a=CBoardEChartRenderEventInfo(data_copy,r,t),i=[];for(var r in e)i.push(e[r]);return i.push(string_keys),i.push(a),{value:i,eventInfo:a}}),e.data&&e.data.length>0&&e.data[0].value&&!$.isNumeric(e.data[0].value[2]))for(var a=0;a<e.data.length;a++)e.data[a].value.splice(2,0,50);var i=_.max(e.data,function(e){return Number(e.value[2])});i.length<3&&ModalUtils.alert("请拖入大小的指标","modal-warning","sm");var r=_.max(e.data,function(e){return"string"==typeof e.value[2]?parseFloat(e.value[2]):e.value[2]});e.symbolSize=function(e,t){var a=0;return _.isUndefined(r.value)||_.isNaN(r.value[2])||_.isUndefined(r.value[2])||r.value[2]===1/0||(a=parseFloat(e[2])/parseFloat(r.value[2])*cityMaxRadius),a<cityMinRadus||_.isNaN(a)?cityMinRadus:a},e.label={show:!1,color:"black",formatter:function(e){return e.data.eventInfo&&e.data.eventInfo.length>0?e.data.eventInfo[0].value:void 0}}}),tunningOpt){var labelInterval,labelRotate;tunningOpt.ctgLabelInterval?labelInterval=tunningOpt.ctgLabelInterval:"auto",tunningOpt.ctgLabelRotate?labelRotate=tunningOpt.ctgLabelRotate:0}var params=angular.copy(window.$$dlut_param);if(markLineCode)for(var _i58 in series)try{series[_i58]=new Function("serie,params,seriesIndex","return ("+markLineCode+")(serie,params,seriesIndex)")(series[_i58],params,_i58)}catch(e){console.error("series自定义计算错误",markLineCode,series[_i58],params,_i58,e)}var echartOption={legend:{data:_.map(series,function(e){return e.name})},tooltip:{trigger:"item",formatter:function formatter(params){var finalResult="",value="",param=BoardParamService.getAll(),_loop18=function _loop18(_i59){if(void 0===_typeof(tooltip[_i59])||tooltip[_i59].isShow!==!1){var index=_.findIndex(params.data.value[params.data.value.length-1],function(e){return e.col===_i59});if(index<0)return{v:void 0};value=params.data.value[params.data.value.length-1][index].value;var _result5=value;tooltip[_i59].formatter&&(_result5=eval(tooltip[_i59].formatter)),finalResult=finalResult+tooltip[_i59].col+": "+_result5+"<br/>"}};for(var _i59 in tooltip){var _ret18=_loop18(_i59);if("object"===("undefined"==typeof _ret18?"undefined":_typeof(_ret18)))return _ret18.v}for(var _i60 in tooltipGroups)if(void 0===_typeof(tooltipGroups[_i60])||tooltipGroups[_i60].isShow!==!1){var obj=_.where(params.value[params.value.length-1],{col:_i60});if(0===obj.length)return;value=params.seriesName;var result=value;tooltipGroups[_i60].formatter&&(result=eval(tooltipGroups[_i60].formatter)),finalResult=finalResult+tooltipGroups[_i60].col+": "+result+"<br/>"}for(var _i61 in tooltipTarget)if(void 0===_typeof(tooltipTarget[_i61])||tooltipTarget[_i61].isShow!==!1){var targetArray=_.keys(tooltipTarget);value=params.data.value[_.indexOf(targetArray,_i61)];var _result4=value;tooltipTarget[_i61].formatter&&(_result4=eval(tooltipTarget[_i61].formatter)),finalResult=finalResult+tooltipTarget[_i61].col+": "+_result4+"<br/>"}return finalResult}},xAxis:{splitLine:{lineStyle:{type:"dashed"}},axisLabel:{interval:labelInterval,rotate:labelRotate}},yAxis:{axisLabel:{formatter:function(e){return numbro(e).format("0a.[0000]")}},splitLine:{lineStyle:{type:"dashed"}},scale:!0},targetData:chartConfig.values,series:series};if(chartConfig.optionCode){var optionCode=chartConfig.optionCode;try{var param=angular.copy(window.$$dlut_param);echartOption=new Function("option,param,config","return ("+optionCode+")(option,param,config)")(echartOption,param,chartConfig)}catch(e){console.error("option自定义计算错误",echartOption,e)}}return updateEchartOptions(chartConfig.option,echartOption),echartOption.wName=scatterData.wName,echartOption}}]),discovery.service("chartCrossTableService",["$filter","EventService","uuid4",function(e,t,a){"ngInject";e("translate");this.render=function(e,i,r,o){var n=new CBoardDataTableRender(e,i);this.instance={render:n};var s=a.generate(),l="example_"+s,c=n.html(l);return e.html(c),n.initialize(i,r,l,t)},this.parseOption=function(e){function t(e,t){if(_.isUndefined(e[0])||!e.length)return!1;if(_.isUndefined(e[0].drillDown))return _.find(t,function(t){return e[0].col===t.name});for(var a=0;a<e[0].drillDown.length;a++){var i=_.find(t,function(t){return e[0].drillDown[a].col===t.name});if(i)return i}}var a=e.chartConfig.values[0].cols,i=e.chartConfig.keys,r=e.chartConfig.groups,o=e.originalData.columnList,n=e.originalData.data,s=t(i,o),l=t(r,o),c=[],d=[],u=[];_.each(n,function(e){var t={};_.each(o,function(a){t[a.name]=e[a.index]}),u.push(t)});for(var f=[],p=0;p<n.length;p++)f.push(n[p][s.index]);for(var g=_.uniq(f),h=l.name,m=s.name,v=[],p=0;p<n.length;p++){var y={};y[h]=n[p][l.index],y.values=a;var b=_.find(v,function(e){return e[h]==n[p][l.index]});_.isUndefined(b)&&v.push(y)}return _.each(g,function(e){var t=[e];_.each(v,function(a){var i=_.find(u,function(t){return t[h]==a[h]&&e==t[m]});_.each(a.values,function(e){_.isUndefined(i)?t.push("-"):(t.push(i[e.col]),d.push({data:e.col+"-"+i[h]}))})}),c.push(t)}),e.dataList=c,e}}]),discovery.service("chartCrossTableGreatService",["$filter","EventService","uuid4",function(e,t,a){"ngInject";e("translate");this.render=function(e,i,r,o){var n=new CBoardCrossGreatRender(e,i);this.instance={render:n};var s=a.generate(),l="cross_great_"+s,c=n.html(l,i);return e.html(c),n.initialize(i,r,l,t)},this.parseOption=function(e){var t=e.chartConfig.drillTier,a=e.originalData.columnList,i=e.originalData.data,r=[];return t.isGreat=!0,_.each(i,function(e){var t={};_.each(a,function(a){t[a.name]=e[a.index]}),r.push(t)}),e.tableData=r,e}}]),discovery.service("chartSelectorService",["dataService","$compile","$filter","EventService",function(e,t,a,i){"ngInject";a("translate");this.render=function(e,a,r,o){var n=new CBoardSelectorRender(e,a),s=n.html(a);return r?e.append(t(s)(r)):e.html(s),n.initialize(a,r,i)},this.parseOption=function(e){var t=e.chartConfig.customCode,a=e.chartConfig.option.advancedOption,i=e.originalData.columnList,r=e.originalData.data,o={},n=[];if(_.each(r,function(e,t){n.indexOf(e[0])==-1&&n.push(e[0]),_.each(e,function(e,t){!o[e]&&t<=i.length-1&&(o[e]={},o[e].index=t,o[e].key=i[t].name,o[e].children=[],o[e].isMultiple=!1)});for(var a=0;a<e.length;a++)o[e[a]]&&o[e[a]].children.indexOf(e[a+1])==-1&&o[e[a]].children.push(e[a+1])}),!a){n=n.sort();var s=[],l=[];if(_.each(n,function(e,t){(_.isUndefined(e)||_.isNull(e)||"null"===e||""===e||"缺省"===e||"-"===e||"未定义"===e||"Null"===e)&&(l.push(t),s.push(e))}),l.length){var c=0;_.each(l,function(e){n.splice(e-c,1),c++}),n=n.concat(s)}}if(e.groupSelects=o,e.firstSelects=n,t){var d=[];try{d=new Function("firstSelects","return ("+t+")(firstSelects)")(e.firstSelects),e.firstSelects=d}catch(u){d="ERROR",console.error("crossTable自定义计算错误",t,e.firstSelects,u)}finally{e.firstSelects=d}}return e}}]),discovery.service("chartGaugeService",["EventService",function(e){"ngInject";this.instance=null,this.render=function(t,a,i,r,o,n){if(null==a)return void t.html('<div class="alert alert-danger" role="alert">No Data!</div>');var s;return i?s=i.myheight-20:null,this.instance=new CBoardEChartRender(t,a,(void 0),n),this.instance.chart(s,r,e)},this.parseOption=function(e){var t={tooltip:{formatter:"{a} <br/>{b} : {c}"},toolbox:{show:!1,feature:{mark:{show:!1},dataView:{show:!0,readOnly:!0},restore:{show:!1},saveAsImage:{show:!0}}},series:[{type:"gauge",min:0,max:100,splitNumber:10,axisLine:{lineStyle:{color:[[.2,"#228b22"],[.8,"#48b"],[1,"#ff4500"]],width:8}},axisTick:{splitNumber:10,length:12,lineStyle:{color:"auto"}},axisLabel:{textStyle:{color:"auto"}},splitLine:{show:!0,length:20,lineStyle:{color:"auto"}},pointer:{width:5},title:{show:!0,offsetCenter:[0,"-40%"],textStyle:{fontWeight:"bolder"}},detail:{formatter:"{value}",textStyle:{color:"auto",fontWeight:"bolder",fontSize:20}},data:[]}]},a=e.chartConfig,i=e.data,r=a.values[0].name?a.values[0].name:"",o=a.values[0].minValue?a.values[0].minValue:0,n=a.values[0].maxValue?a.values[0].maxValue:100;(isNaN(o)||isNaN(n)||parseFloat(o)>=parseFloat(n))&&(o=0,n=100),t.series[0].min=o,t.series[0].max=n;var s=[];for(var l in a.styles){var c=a.styles[l].proportion,d=a.styles[l].color;void 0!=c&&""!=c&&s.push([c,d])}s.length>0&&(t.series[0].axisLine.lineStyle.color=s);var u=i.length>0?i[0][0]:"N/A";a.values[0].format&&(u=numbro(u).format(a.values[0].format));var f=u.lastIndexOf("%");return f!=-1&&(u=u.substring(0,f),t.tooltip.formatter="{a} <br/>{b} : {c}%",t.series[0].detail.formatter="{value}%"),t.series[0].data=[{name:r,value:u}],t}}]),discovery.service("chartWordCloudService",["EventService",function(e){"ngInject";this.instance=null,this.render=function(t,a,i,r,o,n){if(null==a)return void t.html('<div class="alert alert-danger" role="alert">No Data!</div>');var s;return i?s=i.myheight-20:null,this.instance=new CBoardEChartRender(t,a,(void 0),n),this.instance.chart(s,r,e)},this.parseOption=function(e){var t=e.keys,a=e.data,i=(e.chartConfig,e.keys,[]);for(var r in t){var o=CBoardEChartRenderEventInfo(e,void 0,r);i.push({eventInfo:o,name:t[r].join("-"),value:a[0][r]})}var n={tooltip:{formatter:"{b} : {c}"},toolbox:{show:!0,feature:{mark:{show:!1},dataView:{show:!0,readOnly:!0},restore:{show:!1},saveAsImage:{show:!0}}},series:[{type:"wordCloud",gridSize:5,sizeRange:[12,50],rotationRange:[-90,90],rotationStep:45,shape:"circle",textStyle:{normal:{color:function(){return"rgb("+[Math.round(255*Math.random()),Math.round(255*Math.random()),Math.round(255*Math.random())].join(",")+")"}},emphasis:{shadowBlur:10,shadowColor:"#333"}},data:i}]};return n}}]),discovery.service("chartTreeMapService",["EventService",function(e){"ngInject";function t(e,i,r,o,n,s){var l=a(e,i,r,o,n),c=[];if(e==i)for(var d in l){var u={name:l[d].arr[e-1],value:l[d].val,children:t(e-1,i,l[d].key,o,n)};"random"==s&&(u.itemStyle={normal:{}}),c.push(u)}else if(e>1)for(var d in l)c.push({name:l[d].arr[e-1],value:l[d].val,children:t(e-1,i,l[d].key,o,n)});else if(1==e)for(var d in l)c.push({name:l[d].arr[e-1],value:l[d].val});return c}function a(e,t,a,i,r){var o={};for(var n in i){var s=i[n][e-1];if(t>e){for(var l="",c=t;c>e;c--)l=c==t?i[n][c-1]:l+"-"+i[n][c-1];if(a!=l)continue;s=a+"-"+s}var d=isNaN(r[0][n])?0:parseFloat(r[0][n]);void 0==o[s]?o[s]={key:s,val:d,arr:i[n]}:o[s]={key:s,val:o[s].val+d,arr:i[n]}}return o}this.instance=null,this.render=function(t,a,i,r,o,n){if(null==a)return void t.html('<div class="alert alert-danger" role="alert">No Data!</div>');var s;return i?s=i.myheight-20:null,this.instance=new CBoardEChartRender(t,a,(void 0),n),this.instance.chart(s,r,e)},this.parseOption=function(e){var a={tooltip:{trigger:"item",formatter:function(e){return e.name+(e.value?":"+e.value:"")}},series:[{type:"treemap",visibleMin:1,label:{normal:{show:!0,position:"inside",textStyle:{fontSize:"18",fontWeight:"bold"},formatter:function(e){return e.name}}}}]},i=e.chartConfig,r=i.values[0].name?i.values[0].name:"Main";a.series[0].name=r;var o=i.values[0].leafDepth?i.values[0].leafDepth:1;a.series[0].leafDepth=o;var n=i.values[0].style?i.values[0].style:"random";"random"!=n&&"multi"!=n&&(a.color=[n]);var s=e.chartConfig.keys.length,l=e.keys,c=e.data;for(var d in l)l[d].reverse();var u=t(s,s,"",l,c,n);"random"!=n&&"multi"!=n?a.series[0].data=[{value:1e3,children:u}]:a.series[0].data=u;for(var f=[],d=s;d>0;d--)f.push({colorSaturation:[.2,.6],itemStyle:{normal:{borderColorSaturation:.7,gapWidth:d}}});return a.series[0].levels=f,a}}]),discovery.service("chartAreaMapService",["EventService",function(e){
"ngInject";this.instance=null,this.render=function(t,a,i,r,o,n){return this.instance=new CBoardEChartRender(t,a,(void 0),n),this.instance.chart(null,r,e)},this.parseOption=function(e){var t=e.chartConfig,a=e.keys,i=e.series,r=e.data,o="china";t.city&&t.city.code?o=t.city.code:t.province&&t.province.code&&(o=t.province.code);var n;n="china"==o?"plugins/FineMap/mapdata/china.json":o.length>2?"plugins/FineMap/mapdata/geometryCouties/"+o+".json":"plugins/FineMap/mapdata/geometryProvince/"+o+".json";for(var s=null,l=_.map(i,function(e){return e.join("-")}),c=[],d=0;d<l.length;d++){for(var e=[],u=0;u<r[d].length;u++){for(var f=[],p=0;p<t.keys.length;p++)f.push({col:t.keys[p].col,alias:t.keys[p].alias,value:a[u][p]});var g={eventInfo:f,name:a[u][t.keys.length-1],value:r[d][u]?r[d][u]:0};e.push(g)}var g={name:l[d],type:"map",map:o,roam:!0,tooltip:{trigger:"item"},label:{normal:{show:!1},emphasis:{show:!0}},itemStyle:{normal:{areaColor:"#EFF0F0",borderColor:"#B5B5B5",borderWidth:1}},data:e};c.push(g)}for(var h=[],d=0;d<i.length;d++){for(var m=0,u=0;u<r.length;u++)m+=parseFloat(isNaN(r[u][d])?0:r[u][d]);h.push(m)}h.sort(function(e,t){return e-t});var v=h[h.length-1];return $.ajax({type:"get",url:n,async:!1,success:function(e){echarts.registerMap(o,e),s={legend:{orient:"vertical",left:"left",data:l},visualMap:{min:0,max:v,left:"right",top:"bottom",text:["High","Low"],inRange:{color:["#e0ffff","#006edd"]},calculable:!0},series:c}}}),s}}]),discovery.service("chartHeatMapCalendarService",["EventService",function(e){"ngInject";this.instance=null,this.render=function(t,a,i,r,o,n){if(null==a)return void t.html('<div class="alert alert-danger" role="alert">No Data!</div>');var s;return i?s=i.myheight-20:null,this.instance=new CBoardEChartRender(t,a,(void 0),n),this.instance.chart(s,r,e)},this.parseOption=function(e){var t=settings.preferredLanguage,a=e.chartConfig,i=a.values[0].dateFormat?a.values[0].dateFormat:"yyyy-MM-dd",r=a.values[0].style?a.values[0].style:"blue",o=e.keys.map(function(e){var t=e[0];return"yyyyMMdd"==i?t.substr(0,4)+"-"+t.substr(4,2)+"-"+t.substr(6,2):"yyyy/MM/dd"==i?t.replace(/\//g,"-"):t}),n={};o.map(function(e){var t=+echarts.number.parseDate(e);if(t){var a=echarts.format.formatTime("yyyy",t);n[a]=1}});var s=[];for(var l in n)s.push(l);s.sort(function(e,t){return t-e});var c=0,d=s.map(function(e){return{top:50+140*c++,cellSize:["auto",15],range:e,itemStyle:{normal:{borderWidth:.5}},monthLabel:{nameMap:t},dayLabel:{firstDay:1,nameMap:t},yearLabel:{show:!0}}}),u=0,f=0,p={},g=[];for(var h in e.keys){var m=+echarts.number.parseDate(o[h]);if(m){var l=echarts.format.formatTime("yyyy",m),v=echarts.format.formatTime("yyyy-MM-dd",m);g=p[l]?p[l]:[];var y=e.data[0][h];u=y<u?y:u,f=y>f?y:f,g.push([v,y]),p[l]=g}}c=0;var _=s.map(function(e){return{type:"heatmap",coordinateSystem:"calendar",calendarIndex:c++,data:p[e]}}),b={tooltip:{position:"top",trigger:"item",axisPointer:{show:!1,type:"shadow"},formatter:function(e){return cboardTranslate("COMMON.DATE")+": "+e.value[0]+"<br>"+cboardTranslate("COMMON.VALUE")+": "+e.value[1]}},toolbox:{show:!0,feature:{mark:{show:!1},dataView:{show:!0,readOnly:!0},restore:{show:!1},saveAsImage:{show:!0}}},visualMap:{min:u,max:f,calculable:!0,orient:"horizontal",left:"left",bottom:"90%",inRange:{color:["#eee",r]}},calendar:d,series:_};return b}}]),discovery.service("chartHeatMapTableService",["EventService",function(EventService){"ngInject";this.instance=null,this.render=function(e,t,a,i,r,o){if(null==t)return void e.html('<div class="alert alert-danger" role="alert">No Data!</div>');var n;return a?n=a.myheight-20:null,this.instance=new CBoardEChartRender(e,t,(void 0),o),this.instance.chart(n,i,EventService)},this.parseOption=function(data){var chartConfig=data.chartConfig,aggregate_data=data.data,tooltip={},Levi=data.chartConfig.option.tooltip,keys=data.chartConfig.keys;for(var _i62 in keys)Levi[keys[_i62].col]?(tooltip[keys[_i62].col]=Levi[keys[_i62].col],Levi[keys[_i62].col].col||(tooltip[keys[_i62].col].col=keys[_i62].col)):tooltip[keys[_i62].col]={col:keys[_i62].col,isShow:!0,formatter:""};for(var tooltipTarget={},Target=data.chartConfig.option.tooltipTarget?data.chartConfig.option.tooltipTarget:{},targetValue={},_j21=0;_j21<data.chartConfig.values.length;_j21++)for(var k=0;k<data.chartConfig.values[_j21].cols.length;k++)targetValue[data.chartConfig.values[_j21].cols[k].alias]={col:data.chartConfig.values[_j21].cols[k].alias};if(!_.isUndefined(Target))for(var _i63 in targetValue)tooltipTarget[_i63]=Target[_i63],Target[_i63]?tooltipTarget[_i63]={col:Target[_i63].col?Target[_i63].col:_i63,isShow:!Target[_i63]||Target[_i63].isShow,formatter:Target[_i63].formatter?Target[_i63].formatter:""}:tooltipTarget[_i63]={col:_i63,isShow:!Target[_i63]||Target[_i63].isShow,formatter:""};for(var tooltipGroups={},Groups=data.chartConfig.option.tooltipGroups,targetGroups=data.chartConfig.groups,_i64=0;_i64<targetGroups.length;_i64++)Groups[targetGroups[_i64].col]?(tooltipGroups[targetGroups[_i64].col]=Groups[targetGroups[_i64].col],Groups[targetGroups[_i64].col].col||(tooltipGroups[targetGroups[_i64].col].col=targetGroups[_i64].col)):tooltipGroups[targetGroups[_i64].col]={col:targetGroups[_i64].col,isShow:!0,formatter:""};var grid=data.chartConfig.option,preferredLanguage=settings.preferredLanguage,config=data.chartConfig,xAxisName="";for(var i in config.keys)xAxisName+=0==i?config.keys[i].col:"-"+config.keys[i].col;var yAxisName="";for(var i in config.groups)yAxisName+=0==i?config.groups[i].col:"-"+config.groups[i].col;var xAxisData=data.keys.map(function(e){return e.join("-")}),yAxisData=data.series.map(function(e){var t=[];for(var a in e)a!=e.length-1&&t.push(e[a]);return t.join("-")}),min=0,max=0,datas=[];for(var i in data.data)for(var j in data.data[i]){var value=isNaN(data.data[i][j])?0:parseFloat(data.data[i][j]);min=value<min?value:min,max=value>max?value:max;var eventInfo=CBoardEChartRenderEventInfo(data,i,j);datas.push({eventInfo:eventInfo,value:[parseInt(j),parseInt(i),value]})}var style=config.values[0].styles?config.values[0].styles:["#eee","blue"],option={tooltip:{trigger:"item",axisPointer:{show:!1,type:"shadow"},formatter:function formatter(params){var finalResult="",_loop19=function _loop19(_i65){if(tooltip[_i65].isShow!==!1){var index=_.findIndex(data.chartConfig.keys,function(e){return e.col===_i65});if(index<0)return{v:void 0};var _value3="";if(tooltip[_i65].formatter&&tooltip[_i65].formatter.indexOf("{v}")!=-1){var repResult="";"string"==typeof data.keys[params.value[0]][index]&&(repResult=tooltip[_i65].formatter.replace("{v}","'{v}'")),repResult=repResult.replace("{v}",data.keys[params.value[0]][index]),_value3=eval(repResult)}else _value3=data.keys[params.value[0]][index];finalResult=finalResult+tooltip[_i65].col+": "+_value3+"<br/>"}};for(var _i65 in tooltip){var _ret19=_loop19(_i65);if("object"===("undefined"==typeof _ret19?"undefined":_typeof(_ret19)))return _ret19.v}var _loop20=function _loop20(_i66){if(tooltipGroups[_i66].isShow!==!1){var index=_.findIndex(params.data.eventInfo,function(e){return e.col===_i66});if(index<0)return{v:void 0};var _value4="";if(tooltipGroups[_i66].formatter&&tooltipGroups[_i66].formatter.indexOf("{v}")!=-1){var repResult="";"string"==typeof params.data.eventInfo[index].value&&(repResult=tooltipGroups[_i66].formatter.replace("{v}","'{v}'")),repResult=repResult.replace("{v}",params.data.eventInfo[index].value),_value4=eval(repResult)}else _value4=params.data.eventInfo[index].value;finalResult=finalResult+tooltipGroups[_i66].col+": "+_value4+"<br/>"}};for(var _i66 in tooltipGroups){var _ret20=_loop20(_i66);if("object"===("undefined"==typeof _ret20?"undefined":_typeof(_ret20)))return _ret20.v}var _loop21=function _loop21(_i67){if(tooltipTarget[_i67].isShow!==!1){var index=_.findIndex(data.chartConfig.values[0].cols,function(e){return e.alias===_i67});if(index<0)return{v:void 0};var _value5="";if(tooltipTarget[_i67].formatter&&tooltipTarget[_i67].formatter.indexOf("{v}")!=-1){var repResult="";repResult="string"==typeof data.keys[params.value[0]][index]?tooltipTarget[_i67].formatter.replace("{v}","'{v}'"):tooltipTarget[_i67].formatter,repResult=repResult.replace("{v}",params.value[params.value.length-1]),_value5=eval(repResult)}else _value5=params.value[params.value.length-1];finalResult=finalResult+tooltipTarget[_i67].col+": "+_value5+"<br/>"}};for(var _i67 in tooltipTarget){var _ret21=_loop21(_i67);if("object"===("undefined"==typeof _ret21?"undefined":_typeof(_ret21)))return _ret21.v}return finalResult}},grid:angular.copy(echartsBasicOption.grid),animation:!1,toolbox:{show:!1,feature:{mark:{show:!1},dataView:{show:!0,readOnly:!0},restore:{show:!1},saveAsImage:{show:!0}}},xAxis:{name:xAxisName,type:"category",data:xAxisData,splitArea:{show:!0}},yAxis:{name:yAxisName,type:"category",data:yAxisData,splitArea:{show:!0}},visualMap:{min:min,max:max,calculable:!0,orient:"horizontal",left:"center",bottom:"0%",inRange:{color:style}},targetData:chartConfig.values,series:[{type:"heatmap",data:datas}]};return grid.gridCustom&&(grid.gridBottom&&(option.grid.bottom=grid.gridBottom),grid.gridTop&&(option.grid.top=grid.gridTop),grid.gridLeft&&(option.grid.left=grid.gridLeft),grid.gridRight&&(option.grid.right=grid.gridRight)),option}}]),discovery.service("chartMarkLineMapService",["EventService",function(e){"ngInject";this.instance=null,this.render=function(t,a,i,r,o,n){return this.instance=new CBoardEChartRender(t,a,(void 0),n),this.instance.chart(null,r,e)},this.parseOption=function(e){var t,a=e.keys,i=e.series,r={},o=[],n=[],s=e.chartConfig,l="china";s.city&&s.city.code?l=s.city.code:s.province&&s.province.code&&(l=s.province.code);var c;c="china"==l?"plugins/FineMap/mapdata/china.json":l.length>2?"plugins/FineMap/mapdata/geometryCouties/"+l+".json":"plugins/FineMap/mapdata/geometryProvince/"+l+".json";for(var d=0,u=0;a[0]&&u<a.length;u++)t=a[u][2],r[t]=[a[u][0],a[u][1]];for(var u=0;i[0]&&u<i.length;u++){t=i[u][2],r[t]=[i[u][0],i[u][1]],n[u]=i[u][2];for(var f=[],p=0,g=0;a[0]&&p<a.length;p++)e.data[u][p]&&0!=e.data[u][p]&&(f[g]=[{name:t},{name:a[p][2],value:e.data[u][p]}],g++,d<e.data[u][p]&&(d=e.data[u][p]));o[u]=[t,f]}var h=function(e){for(var t=[],a=0;a<e.length;a++){var i=e[a],o=r[i[0].name],n=r[i[1].name];o&&n&&t.push({fromName:i[0].name,toName:i[1].name,coords:[o,n]})}return t},m=["#a6c84c","#ffa022","#46bee9"],v=[];o.forEach(function(e,t){v.push({name:e[0],type:"lines",zlevel:2,symbol:["none","arrow"],symbolSize:10,effect:{show:!0,constantSpeed:30,period:6,trailLength:.1,symbol:"arrow",symbolSize:4},lineStyle:{normal:{width:1,opacity:.6,curveness:.2}},data:h(e[1])},{name:e[0],type:"effectScatter",coordinateSystem:"geo",zlevel:2,rippleEffect:{brushType:"stroke"},label:{normal:{show:!0,position:"right",formatter:"{b}"}},symbolSize:function(e){return 0==d?0:10*e[2]/d},itemStyle:{normal:{color:m[t]}},data:e[1].map(function(e){return{name:e[1].name,value:r[e[1].name].concat([e[1].value])}})})});var y;return $.ajax({type:"get",url:c,async:!1,success:function(e){echarts.registerMap(l,e),y={legend:{orient:"vertical",top:"top",left:"left",selectedMode:"multiple",data:n},geo:{map:l,roam:!0,itemStyle:{normal:{areaColor:"#EFF0F0",borderColor:"#B5B5B5",borderWidth:1}}},tooltip:{trigger:"item"},series:v}}}),y}}]),discovery.service("chartLiquidFillService",["EventService",function(e){"ngInject";this.instance=null,this.render=function(t,a,i,r,o,n){if(null==a)return void t.html('<div class="alert alert-danger" role="alert">No Data!</div>');var s;return i?s=i.myheight-20:null,this.instance=new CBoardEChartRender(t,a,(void 0),n),this.instance.chart(s,r,e)},this.parseOption=function(e){var t=e.chartConfig,a=!0;"static"==t.animation&&(a=!1);var i=t.values[0].style?t.values[0].style:"circle",r=[],o=e.data.length>0?e.data[0][0]:"N/A";if("N/A"!=o)for(var n=1;n<5;n++){for(var s=1,l=1;l<n;l++)s=.95*s;r.push(o*s)}var c={series:[{type:"liquidFill",shape:i,data:r,waveAnimation:a,radius:"70%",backgroundStyle:{borderWidth:2,borderColor:"#156ACF"},outline:{show:!1}}]};return c}}]),discovery.service("chartD3DemoService",["uuid4",function(e){"ngInject";function t(e,r,o,n,s,l){var c=a(e,r,o,n,s),d=[];if(e==r)for(var u in c){var f={name:c[u].arr[e-1],size:c[u].val,children:t(e-1,r,c[u].key,n,s)};"random"==l&&(f.itemStyle=i()),d.push(f)}else if(e>1)for(var u in c)d.push({name:c[u].arr[e-1],size:c[u].val,children:t(e-1,r,c[u].key,n,s)});else if(1==e)for(var u in c)d.push({name:c[u].arr[e-1],size:c[u].val});return d}function a(e,t,a,i,r){var o={};for(var n in i){var s=i[n][e-1];if(t>e){for(var l="",c=t;c>e;c--)l=c==t?i[n][c-1]:l+"-"+i[n][c-1];if(a!=l)continue;s=a+"-"+s}var d=isNaN(r[0][n])?0:parseFloat(r[0][n]);void 0==o[s]?o[s]={key:s,val:d,arr:i[n]}:o[s]={key:s,val:o[s].val+d,arr:i[n]}}return o}function i(){return{normal:{color:"rgb("+[Math.round(160*Math.random()),Math.round(160*Math.random()),Math.round(160*Math.random())].join(",")+")"}}}this.render=function(t,a,i,r,o){if(null==a)return void t.html('<div class="alert alert-danger" role="alert">No Data!</div>');var n;i?n=i.myheight:null;var s=e.generate();return t.addClass("d3_"+s),new CBoardD3Render(t,a,this,s).chart(null,r)},this.parseOption=function(e){return e},this.initCanvas=function(e,t,a){html="<div>hello world</div>",html='<div id="wrapper">\n\t\t<div id="info" style="opacity: 1;">\n\t\t\t\t<div><span id="name"></span><span id="segment">&nbsp;</span></div>\n\t\t\t\t<div><span id="emissions"></span><span id="percent"></span></div>\n\t\t<div id="tweet-box">\n\t\t\t<i id="close" class="icon-remove"></i>\n\t\t\t<div id="tweet-text"></div>\n\t\t</div>\t\t\n',e.html(html);var i=e.height(),r=e.width(),o=d3.select(".d3_"+a.uuid).append("svg").attr("width",r).attr("height",i).attr("left",200);return o},this.draw=function(e,a,i){function r(e){if(R.transition().duration(L).attrTween("d",f(e)).each("end",function(e,t){d3.select(D[0][t]).style("fill",function(e){return O(e)?"white":"none"})}),D.style("visibility",function(t){return u(e,t)?null:d3.select(this).style("visibility")}).transition().duration(L).attrTween("text-anchor",function(e){return function(){return T(e.x+e.dx/2)>Math.PI?"end":"start"}}).attrTween("transform",function(e){var t=(e.name||"").split(" ").length>1;return function(){var a=180*T(e.x+e.dx/2)/Math.PI-90,i=a+(t?-.5:0);return"rotate("+i+")translate("+(I(e.y)+N)+")rotate("+(a>90?-180:0)+")"}}).style("fill-opacity",function(t){return u(e,t)?1:1e-6}).each("end",function(t){d3.select(this).style("visibility",u(e,t)?null:"hidden")}),0==e.depth)d3.select("#splash").style("display","block").transition().duration(750).delay(500).style("opacity",1),d3.select("#centre-label").text("All emissions").style("font-family","Guardian-Text-Egyp-Web-Reg-Latin").style("font-size","12px");else if(d3.select("#splash").transition().duration(750).style("opacity",0).each("end",function(){d3.select(this).style("display","none")}),d3.select("#centre-label").text("").style("font-family","FontAwesome").style("font-size","18px"),d3.select("#centre-label-background").transition().delay(750).style("fill",g(e.parent)),3==e.depth){var t=Math.round(100*e.value)/100,a=e.parent?Math.round(1e4*t/e.parent.value)/100:"";tweetText=e.name+" has caused "+a+"% of manmade carbon emissions",d3.select("#tweet-text").transition().delay(750).text("‘"+tweetText+"’"),n()}}function o(){d3.select("#tweet-box").transition().duration(500).style("opacity",0).each("end",function(){d3.select(this).style("display","none")}),tweetBoxShowing=!1}function n(){d3.select("#tweet-box").style("display","block").transition().duration(500).style("opacity",1),tweetBoxShowing=!0}function s(e){l(e),e.depth<4&&d3.select(this).style("cursor","pointer");var t=d(e);d3.selectAll("path").classed("highlighted-path",!1),d3.selectAll("path").filter(function(e){return t.indexOf(e)>=0}).classed("highlighted-path",!0),d3.select("#centre-label-background").classed("highlighted-path",!0)}function l(e){d3.select("#info").transition().duration(750).style("opacity",1),d3.select("#name").text(0==e.depth?"总计":e.name);var t=Math.round(100*e.value)/100,a=e.parent?Math.round(1e4*t/e.parent.value)/100:"";d3.select("#emissions").text(0!=e.value?"数值："+t+"  ":" "),d3.select("#percent").text(0!=e.value?"对"+e.parent.name+"占比："+a+"%":"")}function c(e){d3.selectAll(".highlighted-path").classed("highlighted-path",!1)}function d(e){for(var t=[],a=e;a.parent;)t.unshift(a),a=a.parent;return t.unshift(a),t}function u(e,t){return e===t||!!e.children&&e.children.some(function(e){return u(e,t)})}function f(e){var t=p(e),a=d3.interpolate(T.domain(),[e.x,e.x+e.dx]),i=d3.interpolate(I.domain(),[e.y,t]),r=d3.interpolate(I.range(),[e.y?20:0,k]);return function(e){return function(t){return T.domain(a(t)),I.domain(i(t)).range(r(t)),A(e)}}}function p(e){return e.children?Math.max.apply(Math,e.children.map(p)):e.y+e.dy}function g(e){return colorList=[{depth:0,color:["#aaa"]},{depth:1,color:["#D81B1F","#0064A2","#49AB57"]},{depth:2,color:["#E95B2E","#488FC2","#76B847"]},{depth:3,color:["#FFCC4B","#69C3EA","#ADC946"]}],0==e.depth?"#aaa":1==e.depth?"#ADC946":2==e.depth?"#49AB57":3==e.depth?"#E95B2E":"Investor owned"==e.name?"#D81B1F":"Nation states"==e.name?"#0064A2":"State owned"==e.name?"#49AB57":e.parent&&"Investor owned"==e.parent.name?"#E95B2E":e.parent&&"Nation states"==e.parent.name?"#488FC2":e.parent&&"State owned"==e.parent.name?"#76B847":"Fuel & cement"==e.name?{"Investor owned":"#FFCC4B","Nation states":"#69C3EA","State owned":"#ADC946"}[e.parent.parent.name]:"Methane leaks"==e.name?{"Investor owned":"#FBBC73","Nation states":"#88B6D7","State owned":"#CBEC8E"}[e.parent.parent.name]:"Own footprint"==e.name?{"Investor owned":"#E9B251","Nation states":"#88B6D7","State owned":"#87DC8C"}[e.parent.parent.name]:"#333"}i.option=a;var h=this.initCanvas(e,a,i),m=(a.data[1],a.chartConfig),v=m.values[0].style?m.values[0].style:"random";"random"!=v&&"multi"!=v&&(a.color=[v]);var y=a.chartConfig.keys.length,_=a.keys,b=a.data;for(var w in _)_[w].reverse();var C=t(y,y,"",_,b,v),x=e.height(),S=e.width(),k=.85*x/2,T=d3.scale.linear().range([0,2*Math.PI]),I=d3.scale.pow().exponent(1.3).domain([0,1]).range([0,k]),N=5,L=1e3,j=h.attr("width",S+2*N).attr("height",x+2*N).append("g").attr("transform","translate("+[k+N,k+N]+")"),$=d3.layout.partition().value(function(e){return e.size}),A=d3.svg.arc().startAngle(function(e){return Math.max(0,Math.min(2*Math.PI,T(e.x)))}).endAngle(function(e){return Math.max(0,Math.min(2*Math.PI,T(e.x+e.dx)))}).innerRadius(function(e){return Math.max(0,e.y?I(e.y):e.y)}).outerRadius(function(e){return Math.max(0,I(e.y+e.dy))}),O=function(e){return T(e.x+e.dx)-T(e.x)>.05},M=$.nodes({name:"",children:C}),R=j.selectAll("path").data(M);R.enter().append("path").attr("id",function(e,t){return"path-"+t}).attr("d",A).attr("fill-rule","evenodd").style("fill",function(e){return g(e)}).on("click",function(e){return r(e.depth<4?e:e.parent)}).on("mouseover",s).on("mouseout",c);var D=j.selectAll("text").data(M),U=D.enter().append("text").style("fill-opacity",.1).style("stroke",function(e){return O(e)?"white":"none"}).attr("text-anchor",function(e){return T(e.x+e.dx/2)>Math.PI?"end":"start"}).attr("dy",".35em").attr("transform",function(e){var t=(e.name||"").split(" ").length>1,a=180*T(e.x+e.dx/2)/Math.PI-90,i=a+(t?-.5:0);return"rotate("+i+")translate("+(I(e.y)+N)+")rotate("+(a>90?-180:0)+")"});U.append("tspan").attr("x",0).text(function(e){return e.name}),U.append("tspan").attr("x",0).attr("dy","1.1em").text(function(e){return e.depth?e.name.split(" ")[1]||"":""}),d3.select("#close").on("click",function(){o()})},this.redraw=function(e,t){this.draw(e,t.option,t)}}]),discovery.service("chartCodeFlowerService",["uuid4",function(e){"ngInject";function t(e,r,o,n,s,l){var c=a(e,r,o,n,s),d=[];if(e==r)for(var u in c){var f={name:c[u].arr[e-1],size:c[u].val,children:t(e-1,r,c[u].key,n,s)};"random"==l&&(f.itemStyle=i()),d.push(f)}else if(e>1)for(var u in c)d.push({name:c[u].arr[e-1],size:c[u].val,children:t(e-1,r,c[u].key,n,s)});else if(1==e)for(var u in c)d.push({name:c[u].arr[e-1],size:c[u].val});return d}function a(e,t,a,i,r){var o={};for(var n in i){var s=i[n][e-1];if(t>e){for(var l="",c=t;c>e;c--)l=c==t?i[n][c-1]:l+"-"+i[n][c-1];if(a!=l)continue;s=a+"-"+s}var d=isNaN(r[0][n])?0:parseFloat(r[0][n]);void 0==o[s]?o[s]={key:s,val:d,arr:i[n]}:o[s]={key:s,val:o[s].val+d,arr:i[n]}}return o}function i(){return{normal:{color:"rgb("+[Math.round(160*Math.random()),Math.round(160*Math.random()),Math.round(160*Math.random())].join(",")+")"}}}this.render=function(t,a,i,r,o){if(t.empty(),null==a)return void t.html('<div class="alert alert-danger" role="alert">No Data!</div>');var n;i?n=i.myheight:null;var s=e.generate();return t.addClass("d3_"+s),new CBoardD3Render(t,a,this,s).chart(null,r)},this.parseOption=function(e){return e},this.initCanvas=function(e,t,a){html='<div id="wrapper" style="position:relative"><div id="info" style="opacity: 1;position:absolute;top:0;left:0;right:0"><div><span id="name"></span><span id="segment">&nbsp;</span></div><div><span id="emissions"></span><span id="percent"></span></div><div id="tweet-box"><i id="close" class="icon-remove"></i><div id="tweet-text"></div></div>',e.html(html);var i=e.height(),r=e.width(),o=d3.select(".d3_"+a.uuid).append("svg").attr("width",r).attr("height",i);return o},this.draw=function(e,a,i){function r(e){return k[e%k.length]}function o(e){if(F.transition().duration(A).attrTween("d",p(e)).each("end",function(e,t){d3.select(E[0][t]).style("fill",function(e){return D(e)?"white":"none"})}),E.style("visibility",function(t){return f(e,t)?null:d3.select(this).style("visibility")}).transition().duration(A).attrTween("text-anchor",function(e){return function(){return L(e.x+e.dx/2)>Math.PI?"end":"start"}}).attrTween("transform",function(e){var t=(e.name||"").split(" ").length>1;return function(){var a=180*L(e.x+e.dx/2)/Math.PI-90,i=a+(t?-.5:0);return"rotate("+i+")translate("+(j(e.y)+$)+")rotate("+(a>90?-180:0)+")"}}).style("fill-opacity",function(t){return f(e,t)?1:1e-6}).each("end",function(t){d3.select(this).style("visibility",f(e,t)?null:"hidden")}),0==e.depth)d3.select("#splash").style("display","block").transition().duration(750).delay(500).style("opacity",1),d3.select("#centre-label").text("All emissions").style("font-family","Guardian-Text-Egyp-Web-Reg-Latin").style("font-size","12px");else if(d3.select("#splash").transition().duration(750).style("opacity",0).each("end",function(){d3.select(this).style("display","none")}),d3.select("#centre-label").text("").style("font-family","FontAwesome").style("font-size","18px"),d3.select("#centre-label-background").transition().delay(750).style("fill",h(e.parent)),3==e.depth){var t=Math.round(100*e.value)/100,a=e.parent?Math.round(1e4*t/e.parent.value)/100:"";tweetText=e.name+" has caused "+a+"% of manmade carbon emissions",d3.select("#tweet-text").transition().delay(750).text("‘"+tweetText+"’"),s()}}function n(){d3.select("#tweet-box").transition().duration(500).style("opacity",0).each("end",function(){d3.select(this).style("display","none")}),tweetBoxShowing=!1}function s(){d3.select("#tweet-box").style("display","block").transition().duration(500).style("opacity",1),tweetBoxShowing=!0}function l(e){c(e),e.depth<4&&d3.select(this).style("cursor","pointer");var t=u(e);d3.selectAll("path").classed("highlighted-path",!1),d3.selectAll("path").filter(function(e){return t.indexOf(e)>=0}).classed("highlighted-path",!0),d3.select("#centre-label-background").classed("highlighted-path",!0)}function c(t){e.find("#info").show(),e.find("#name").text(0==t.depth?"总计":t.name);var a=Math.round(100*t.value)/100,i=t.parent?Math.round(1e4*a/t.parent.value)/100:"";e.find("#emissions").text(0!=t.value?"数值："+a+"  ":" "),e.find("#percent").text(0!=t.value?"对"+t.parent.name+"占比："+i+"%":"")}function d(t){e.find("#info").hide(),d3.selectAll(".highlighted-path").classed("highlighted-path",!1)}function u(e){for(var t=[],a=e;a.parent;)t.unshift(a),a=a.parent;return t.unshift(a),t}function f(e,t){return e===t||!!e.children&&e.children.some(function(e){return f(e,t)})}function p(e){var t=g(e),a=d3.interpolate(L.domain(),[e.x,e.x+e.dx]),i=d3.interpolate(j.domain(),[e.y,t]),r=d3.interpolate(j.range(),[e.y?20:0,N]);return function(e){return function(t){return L.domain(a(t)),j.domain(i(t)).range(r(t)),R(e)}}}function g(e){return e.children?Math.max.apply(Math,e.children.map(g)):e.y+e.dy}function h(e){for(var t=e,a=0;t;){if(t.color)return"hsl("+t.color+","+(30+10*a)+"%,"+(20+10*a)+"%)";a++,t=t.parent}return e.colors}i.option=a;var m=this.initCanvas(e,a,i),v=(a.data[1],a.chartConfig),y=v.values[0].style?v.values[0].style:"random";"random"!=y&&"multi"!=y&&(a.color=[y]);var b=a.chartConfig.keys.length,w=a.keys,C=a.data;for(var x in w)w[x].reverse();for(var S=t(b,b,"",w,C,y),k=[],x=10;x<20;x++)k.push(19*x);var T=e.height(),I=e.width(),N=.85*T/2,L=d3.scale.linear().range([0,2*Math.PI]),j=d3.scale.pow().exponent(1.3).domain([0,1]).range([0,N]),$=5,A=1e3,O=m.attr("width",I+2*$).attr("height",T+2*$).append("g").attr("transform","translate("+[I/2,T/2]+")"),M=d3.layout.partition().value(function(e){return e.size}),R=d3.svg.arc().startAngle(function(e){return Math.max(0,Math.min(2*Math.PI,L(e.x)))}).endAngle(function(e){return Math.max(0,Math.min(2*Math.PI,L(e.x+e.dx)))}).innerRadius(function(e){return Math.max(0,e.y?j(e.y):e.y)}).outerRadius(function(e){return Math.max(0,j(e.y+e.dy))}),D=function(e){return L(e.x+e.dx)-L(e.x)>.05};if(_.isArray(S))for(var x=0;x<S.length;x++)S[x].color=r(x);var U=M.nodes({name:"",children:S}),F=O.selectAll("path").data(U);F.enter().append("path").attr("id",function(e,t){return"path-"+t}).attr("d",R).attr("fill-rule","evenodd").style("fill",function(e){return h(e)}).on("click",function(e){return o(e.depth<4?e:e.parent)}).on("mouseover",l).on("mouseout",d);var E=O.selectAll("text").data(U),B=E.enter().append("text").style("fill-opacity",.1).style("stroke",function(e){return D(e)?"white":"none"}).attr("text-anchor",function(e){return L(e.x+e.dx/2)>Math.PI?"end":"start"}).attr("dy",".35em").attr("transform",function(e){var t=(e.name||"").split(" ").length>1,a=180*L(e.x+e.dx/2)/Math.PI-90,i=a+(t?-.5:0);return"rotate("+i+")translate("+(j(e.y)+$)+")rotate("+(a>90?-180:0)+")"});B.append("tspan").attr("x",0).text(function(e){return e.name}),B.append("tspan").attr("x",0).attr("dy","1.1em").text(function(e){return e.depth?e.name.split(" ")[1]||"":""}),d3.select("#close").on("click",function(){n()})},this.redraw=function(e,t){this.draw(e,t.option,t)}}]),discovery.service("chartFlexService",["$interpolate","$compile","$sce","uuid4","EventService",function(e,t,a,i,r){"ngInject";this.render=function(e,t,a,o,n){if(t){var s=i.generate(),l=new CBoardFlexRender(e,t);return l.initialize(t,r,a,s)}},this.parseOption=function(e){if(!_.isUndefined(e.chartConfig.option.flex)){for(var t=[],a=[],i=0;i<e.chartConfig.keys.length;i++)a.push(e.chartConfig.keys[i].col);for(var i=0;i<e.keys.length;i++){for(var r={},o=0;o<a.length;o++)r[a[o]]=e.keys[i][o];t.push(r)}for(var i=0;i<e.series.length;i++)for(var o=0;o<e.keys.length;o++){var n=e.series[i][0],s=e.data[i];t[o][n]=s[o]}return{data:t,template:e.chartConfig.option.flex}}return!1}}]),discovery.service("chartFlex2Service",["$interpolate","$rootScope","$compile","$sce","uuid4","EventService","BoardParamService",function(e,t,a,i,r,o,n){"ngInject";function s(){return n}this.render=function(e,i,n,l,c){if(i){var d=n;void 0==d&&(d=t);var u=r.generate(),f=new CBoardFlex2Render(e,i);return f.initialize(i,o,d,u,a,s())}},this.parseOption=function(e){if(!_.isUndefined(e.chartConfig.option.flex)){for(var t=[],a=[],i=0;i<e.chartConfig.keys.length;i++)a.push(e.chartConfig.keys[i].col);for(var i=0;i<e.keys.length;i++){for(var r={},o=0;o<a.length;o++)r[a[o]]=e.keys[i][o];t.push(r)}for(var i=0;i<e.series.length;i++)for(var o=0;o<e.keys.length;o++){var n=e.series[i][0],s=e.data[i];t[o][n]=s[o]}return{data:t,template:e.chartConfig.option.flex,code:e.chartConfig.option.code}}return!1}}]),discovery.service("chartGanttService",["$filter","EventService","uuid4","$rootScope",function(e,t,a,i){"ngInject";this.render=function(e,i,r,o){var r=e.data("$scope");if(r){var n=new CBoardGanttRender(e,i);this.instance={render:n};var s=a.generate(),l="example_"+s+"_gantt",c=n.html(o,s,l);return e.html(c),n.initialize(i,t,r,s,l)}},this.parseOption=function(e){for(var t=e.chartConfig,a=["id","parent","start_date","duration","text"],i=["state","progress"],r=t.keys,o=t.groups,n=t.values[0].cols,s=e.originalData.data,l=[],c=0;c<s.length;c++){for(var d={},u=s[c],f=0,p=0;p<o.length;p++)d[i[p]]=u[f],f++;for(var g=0;g<r.length;g++)d[a[g]]=u[f],f++;for(var h=0;h<n.length;h++)d[valueNameList[h]]=u[f],f++;l.push(d)}return e.newList=l,e}}]),discovery.service("chartBarLimitsService",["dataService","EventService",function(e,t){"ngInject";this.instance=null,this.render=function(e,a,i,r,o,n){return this.instance=new CBoardEChartRender(e,a,(void 0),n),this.instance.chart(null,r,t)},this.parseOption=function(e){for(var t=e.chartConfig,a=e.keys,i=e.series,r=e.data,o=e.seriesConfig,n=new Array,s=_.map(a,function(e){return e.join("-")}),l=t.option,c=[],d=0;r[0]&&d<r[0].length;d++){for(var u=0,f=0;f<r.length;f++)u+=r[f][d]?Number(r[f][d]):0,r[f][d]=r[f][d]?Number(r[f][d]):0;c[d]=u}for(var f=0;f<r.length;f++){var p=i[f].join("-"),g=angular.copy(o[p]);g.name=p,g.data=r[f],g.barMaxWidth=40,g.type="bar",g.stack="stack"+f%(r.length/2);for(var h=[],d=0;d<g.data.length;d++){var m=CBoardEChartRenderEventInfo(e,f,d);h.push({eventInfo:m,value:g.data[d]})}g.data=h,f<r.length/2&&(g.itemStyle={normal:{barBorderColor:"rgba(0,0,0,0)",color:"rgba(0,0,0,0)"},emphasis:{barBorderColor:"rgba(0,0,0,0)",color:"rgba(0,0,0,0)"}}),n.push(g)}for(var f=0;f<t.values.length;f++)_.isUndefined(t.values[f].series_label)||("true"==t.values[f].series_label?n[f].label={normal:{show:!0}}:"false"==t.values[f].series_label&&(n[f].label={normal:{show:!1}}));var v=angular.copy(t.values);_.each(v,function(e,t){e.axisLabel={formatter:function(e){return numbro(e).format("0a.[0000]")}},e.min=0,t>0&&(e.splitLine=!1),e.scale=!0});for(var f=0;f<v.length;f++)t.values[f].series_label&&("true"==t.values[f].series_logarithm?v[f]={type:"log"}:"false"==t.values[f].series_logarithm&&(v[f]={type:"value"}));var y=[],b=[],w=[];if(t.option.itemStyle&&t.option.itemStyle.color&&(y=t.option.itemStyle.color.split(",")),t.option.itemStyle&&t.option.itemStyle.dataName&&(b=t.option.itemStyle.dataName.split(",")),t.option.itemStyle&&t.option.itemStyle.seriesName&&(w=t.option.itemStyle.seriesName.split(",")),t.option.itemStyle&&t.option.itemStyle&&t.option.itemStyle.color&&""!=t.option.itemStyle.color)for(var C=0;C<y.length;C++)if(t.option.itemStyle.dataName&&(_.isUndefined(t.option.itemStyle.seriesName)||""==t.option.itemStyle.seriesName)){for(var f=0;f<n.length;f++)if(b[C]==n[f].name)for(var d=0;d<n[f].data.length;d++)n[f].data[d]=_.extend(n[f].data[d],{itemStyle:{normal:{color:y[C]}}})}else if(t.option.itemStyle.dataName&&t.option.itemStyle.seriesName)for(var f=0;f<n.length;f++)if(b[C]==n[f].name)for(var d=0;d<n[f].data.length;d++)for(var x=0;x<n[f].data[d].eventInfo.length;x++)w[C]==n[f].data[d].eventInfo[x].value&&(n[f].data[d]=_.extend(n[f].data[d],{itemStyle:{normal:{color:y[C]}}}));if(l){var S,k;l.ctgLabelInterval?S=l.ctgLabelInterval:"auto",l.ctgLabelRotate?k=l.ctgLabelRotate:0}var T={type:"category",data:s,axisLabel:{interval:S,rotate:k}},I={type:"bar",grid:angular.copy(echartsBasicOption.grid),legend:{data:_.map(i,function(e){return e.join("-")})},tooltip:{formatter:function(e){e[0].name;return"最小值:"+e[0].value+"<br>最大值:"+e[1].value}},xAxis:"horizontal"==t.valueAxis?v:T,yAxis:"horizontal"==t.valueAxis?T:v,series:n};return"horizontal"===t.valueAxis&&(I.grid.left="left",I.grid.containLabel=!0,I.grid.bottom="5%"),"vertical"===t.valueAxis&&t.values.length>1&&(I.grid.right=40),updateEchartOptions(l,I),I}}]),discovery.service("chartDataLineTableService",["$filter","EventService","uuid4",function(e,t,a){"ngInject";e("translate");this.render=function(e,i,r,o){
var n=new CBoardDataLineTableRender(e,i);this.instance={render:n};var s=a.generate(),l="example_"+s,c=n.html(o,s,l);return e.html(c),n.initialize(i,t,r,s,l)},this.parseOption=function(e){var t=[];t=e.keys;for(var a=0;a<e.data.length;a++)for(var i=e.data[a],r=0;r<t.length;r++)t[r]=t[r].concat(i[r]);return e.dataList=t,e}}]),discovery.service("chartEchartBmapService",["BoardParamService","EventService",function(BoardParamService,EventService){"ngInject";this.instance=null,this.render=function(e,t,a,i,r,o){return this.instance=new CBoardEChartRender(e,t,(void 0),o),this.instance.type="bMap",this.instance.chart(null,i,EventService)},this.parseOption=function(data){var tooltip={},Levi=data.chartConfig.option.tooltip,keys=data.chartConfig.keys,drill=data.chartConfig.drillTier,ops=data.chartConfig.option;for(var i in keys)Levi[keys[i].col]?(tooltip[keys[i].col]=Levi[keys[i].col],Levi[keys[i].col].col||(tooltip[keys[i].col].col=keys[i].col)):tooltip[keys[i].col]={col:keys[i].col,isShow:!0,formatter:""};for(var tooltipTarget={},Target=data.chartConfig.option.tooltipTarget,targetValue={},_j22=0;_j22<data.chartConfig.values.length;_j22++)for(var k=0;k<data.chartConfig.values[_j22].cols.length;k++)targetValue[data.chartConfig.values[_j22].cols[k].alias]={col:data.chartConfig.values[_j22].cols[k].alias};for(var _i68 in targetValue)tooltipTarget[_i68]=Target[_i68],Target[_i68]&&Target[_i68].col||(tooltipTarget[_i68]={col:_i68,isShow:!Target[_i68]||Target[_i68].isShow,formatter:Target[_i68]&&Target[_i68].formatter?Target[_i68].formatter:""});for(var tooltipGroups={},Groups=data.chartConfig.option.tooltipGroups,targetGroups=data.chartConfig.groups,_i69=0;_i69<targetGroups.length;_i69++)Groups[targetGroups[_i69].col]?(tooltipGroups[targetGroups[_i69].col]=Groups[targetGroups[_i69].col],Groups[targetGroups[_i69].col].col||(tooltipGroups[targetGroups[_i69].col].col=targetGroups[_i69].col)):tooltipGroups[targetGroups[_i69].col]={col:targetGroups[_i69].col,isShow:!0,formatter:""};var originalData=data.originalData.data,minColor="#006edd";data.chartConfig.option.maxColor&&(minColor=data.chartConfig.option.maxColor);var maxColor="#e0ffff";data.chartConfig.option.minColor&&(maxColor=data.chartConfig.option.minColor);var cityMaxRadius=20;data.chartConfig.option.cityMaxRadius&&(cityMaxRadius=data.chartConfig.option.cityMaxRadius);var cityMinRadus=10;data.chartConfig.option.cityMinRadus&&(cityMinRadus=data.chartConfig.option.cityMinRadus);var series_data=convertCityData(data),maxCity=_.max(series_data,function(e){return"string"==typeof e.value[2]?parseInt(e.value[2]):parseInt(e.value[2])}),thresholdCode=data.chartConfig.thresholdCode;if(thresholdCode){var params=angular.copy(window.$$dlut_param),seriesIndexObj={},dataIndexObj={};for(var _j23 in data.seriesConfig)seriesIndexObj[_j23]=data.seriesConfig[_j23].valueAxisIndex,dataIndexObj[_j23]=2;var evalColor=function(e){for(var t in e){e[t];try{e[t]=new Function("data,params,seriesIndex,dataIndex","return ("+thresholdCode+")(data,params,seriesIndex,dataIndex)")(e[t],params,t,0)}catch(a){console.error("data自定义计算公式错误",thresholdCode,params,e[t],t,0,a)}}};evalColor(series_data)}var seriesArr=[{type:"scatter",coordinateSystem:"geo",data:series_data,label:{show:!0,color:"auto",position:"top",formatter:function(e){return e.name}},symbolSize:function(e,t){var a=0;if(_.isUndefined(maxCity.value)||_.isNaN(maxCity.value[2])||_.isUndefined(maxCity.value[2])||maxCity.value[2]===1/0);else{var i=parseFloat(e[2]),r=parseFloat(maxCity.value[2]);a=_.isNaN(i)?cityMinRadus:_.isNaN(r)?cityMaxRadius:i/r*cityMaxRadius}return a<cityMinRadus||_.isNaN(a)?cityMinRadus:a>cityMaxRadius?cityMaxRadius:a}}];if(data.chartConfig.markLineCode){var markLineCode=data.chartConfig.markLineCode;for(var _i71 in seriesArr)try{seriesArr[_i71]=new Function("serie,params,seriesIndex","return ("+markLineCode+")(serie,params,seriesIndex)")(seriesArr[_i71],params,_i71)}catch(e){console.error("series自定义计算错误",markLineCode,seriesArr[_i71],params,_i71,e)}}var echartOption={};if(echartOption={backgroundColor:"#D1D1D1",tooltip:{trigger:"item",formatter:function formatter(params){var finalResult="",value="",param=BoardParamService.getAll(),_loop22=function _loop22(_i72){if(void 0===_typeof(tooltip[_i72])||tooltip[_i72].isShow!==!1)if(index=_.findIndex(params.data.eventInfo,function(e){return e.col===_i72}),index>-1){if(params.data.eventInfo[index].value){value=params.data.eventInfo[index].value;var _result6=params.data.eventInfo[index].value;tooltip[_i72].formatter&&(_result6=eval(tooltip[_i72].formatter)),finalResult=finalResult+tooltip[_i72].col+": "+_result6+"<br/>"}}else if(params.name){value=params.name;var _result7=params.name;tooltip[_i72].formatter&&(_result7=eval(tooltip[_i72].formatter)),finalResult=finalResult+tooltip[_i72].col+": "+_result7+"<br/>"}};for(var _i72 in tooltip){var index;_loop22(_i72)}for(var _i73 in tooltipTarget)if(void 0===_typeof(tooltipTarget[_i73])||tooltipTarget[_i73].isShow!==!1){var targetArray=_.keys(tooltipTarget);if(params.data&&params.data.value){value=params.data.value[_.indexOf(targetArray,_i73)+2];var result=params.data.value[_.indexOf(targetArray,_i73)+2];tooltipTarget[_i73].formatter&&(result=eval(tooltipTarget[_i73].formatter)),finalResult=finalResult+tooltipTarget[_i73].col+": "+result+"<br/>"}}return finalResult}},geo:{map:"china",label:{emphasis:{show:!1}},itemStyle:{normal:{areaColor:"#F4F4F4",borderColor:"white",borderWidth:1},emphasis:{areaColor:"#F4F4F4"}},zoom:(ops.isEnLarge&&1==drill.keyTier||2==drill.keyTier)&&ops.zoom?ops.zoom:1,center:ops.isEnLarge&&1==drill.keyTier||2==drill.keyTier?[city[drill.filters.key[0]][0],city[drill.filters.key[0]][1]]:[]},series:seriesArr},data.chartConfig.optionCode){var optionCode=data.chartConfig.optionCode;try{var param=angular.copy(window.$$dlut_param);echartOption=new Function("option,param,config","return ("+optionCode+")(option,param,config)")(echartOption,param,data.chartConfig)}catch(e){console.error("option自定义计算错误",echartOption,e)}}return echartOption}}]),discovery.service("chartEchartZoneMapService",["BoardParamService","EventService",function(BoardParamService,EventService){"ngInject";this.instance=null,this.render=function(e,t,a,i,r,o){return this.instance=new CBoardEChartRender(e,t,(void 0),o),this.instance.chart(null,i,EventService)},this.parseOption=function(data){var tooltip={},Levi=data.chartConfig.option.tooltip,keys=data.chartConfig.keys;for(var i in keys)Levi[keys[i].col]?(tooltip[keys[i].col]=Levi[keys[i].col],Levi[keys[i].col].col||(tooltip[keys[i].col].col=keys[i].col)):tooltip[keys[i].col]={col:keys[i].col,isShow:!0,formatter:""};for(var tooltipTarget={},Target=data.chartConfig.option.tooltipTarget,targetValue={},_j24=0;_j24<data.chartConfig.values.length;_j24++)for(var k=0;k<data.chartConfig.values[_j24].cols.length;k++)targetValue[data.chartConfig.values[_j24].cols[k].alias]={col:data.chartConfig.values[_j24].cols[k].alias};for(var _i74 in targetValue)tooltipTarget[_i74]=Target[_i74],Target[_i74]&&Target[_i74].col||(tooltipTarget[_i74]={col:_i74,isShow:!Target[_i74]||Target[_i74].isShow,formatter:Target[_i74]&&Target[_i74].formatter?Target[_i74].formatter:""});for(var tooltipGroups={},Groups=data.chartConfig.option.tooltipGroups,targetGroups=data.chartConfig.groups,_i75=0;_i75<targetGroups.length;_i75++)Groups[targetGroups[_i75].col]?(tooltipGroups[targetGroups[_i75].col]=Groups[targetGroups[_i75].col],Groups[targetGroups[_i75].col].col||(tooltipGroups[targetGroups[_i75].col].col=targetGroups[_i75].col)):tooltipGroups[targetGroups[_i75].col]={col:targetGroups[_i75].col,isShow:!0,formatter:""};var minColor="#e0ffff";data.chartConfig.option.maxColor&&(minColor=data.chartConfig.option.maxColor);var maxColor="#006edd";data.chartConfig.option.minColor&&(maxColor=data.chartConfig.option.minColor);var series_data=convertZoneData(data),maxCity=_.max(series_data,function(e){return e.value[2]}),thresholdCode=data.chartConfig.thresholdCode;if(thresholdCode){var params=angular.copy(window.$$dlut_param),seriesIndexObj={},dataIndexObj={};for(var _j25 in data.seriesConfig)seriesIndexObj[_j25]=data.seriesConfig[_j25].valueAxisIndex,dataIndexObj[_j25]=2;var evalColor=function(e){for(var t in e){e[t];try{e[t]=new Function("data,params,seriesIndex,dataIndex","return ("+thresholdCode+")(data,params,seriesIndex,dataIndex)")(e[t],params,t,0)}catch(a){console.error("data自定义计算公式错误",thresholdCode,params,e[t],t,0,a)}}};evalColor(series_data)}var maxValue=_.max(series_data,function(e){return Number(e.value[0])});Math.abs(maxValue)!=1/0&&(maxValue=maxValue.value[0]);var minValue=_.min(series_data,function(e){return Number(e.value[0])});minValue&&(minValue=minValue.value[0]);var absoluteMaxValue=Math.abs(maxValue);Math.abs(minValue)>absoluteMaxValue&&(absoluteMaxValue=Math.abs(minValue));var chartOption=null;if(chartOption={backgroundColor:"#D1D1D1",tooltip:{trigger:"item",formatter:function formatter(params){var finalResult="",value="",param=BoardParamService.getAll();for(var _i77 in tooltip)if((void 0===_typeof(tooltip[_i77])||tooltip[_i77].isShow!==!1)&&params.name){value=params.name;var result=params.name;tooltip[_i77].formatter&&(result=eval(tooltip[_i77].formatter)),finalResult=finalResult+tooltip[_i77].col+": "+result+"<br/>"}for(var _i78 in tooltipTarget)if(void 0===_typeof(tooltipTarget[_i78])||tooltipTarget[_i78].isShow!==!1){var targetArray=_.keys(tooltipTarget);if(params.data&&params.data.value){value=params.data.value[_.indexOf(targetArray,_i78)];var _result8=params.data.value[_.indexOf(targetArray,_i78)];tooltipTarget[_i78].formatter&&(_result8=eval(tooltipTarget[_i78].formatter)),finalResult=finalResult+tooltipTarget[_i78].col+": "+_result8+"<br/>"}}return finalResult}},geo:{show:!0,label:{normal:{show:!1},emphasis:{show:!1}},roam:!0,itemStyle:{normal:{areaColor:"#031525",borderColor:"#3B5077"},emphasis:{areaColor:"#2B91B7"}}},visualMap:{type:"continuous",min:minValue,max:maxValue,text:["Low","High"],realtime:!1,calculable:!0,precision:3,dimension:0,range:[minValue,maxValue],inRange:{color:["green","red"]}},series:[{type:"map",mapType:data.chartConfig.option.provinceMap?"china":"chinaZone",coordinateSystem:"geo",itemStyle:{normal:{areaColor:"#F4F4F4",borderColor:"white",borderWidth:1,label:{show:!1}},emphasis:{label:{show:!0}}},data:series_data}]},data.chartConfig.optionCode){var optionCode=data.chartConfig.optionCode;try{chartOption=new Function("option, absoluteMaxValue","return ("+optionCode+")(option, absoluteMaxValue)")(chartOption,absoluteMaxValue)}catch(e){console.error("option自定义计算错误",chartOption,e)}}return chartOption}}]),discovery.service("ModalUtils",["$uibModal","$filter",function(e,t){"ngInject";var a=t("translate");this.alert=function(t,i,r,o){e.open({templateUrl:"src/view/util/modal/alert.html",windowTemplateUrl:"src/view/util/modal/window.html",backdrop:!1,windowClass:i,size:r,controller:["$scope","$uibModalInstance",function(e,i){t?e.content=t:e.content=a("CONFIG.DASHBOARD.DASHBOARD_SOMETHING_WRONG"),e.ok=function(){i.close(),o&&o()}}]})},this.confirm=function(t,i,r,o,n){e.open({templateUrl:"src/view/util/modal/confirm.html",windowTemplateUrl:"src/view/util/modal/window.html",backdrop:!1,windowClass:i,size:r,controller:["$scope","$uibModalInstance",function(e,i){t?e.content=t:e.content=a("CONFIG.DASHBOARD.DASHBOARD_SOMETHING_WRONG"),e.ok=function(){i.close(),o&&o()},e.close=function(){i.close(),n&&n()}}]})}}]),discovery.directive("nvDashboardWidget",["$compile","$templateCache","dataService","chartService",function(e,t,a,i){"ngInject";var r=function(a,i,r){var o=t.get("nvEchartContent");a.myheight=a.height;var n=e(o);i.append(n(a));var s=$(i).find(".box-body");a.widget.render&&a.widget.render(s,null,a)},o=function(a,i,r){var o=t.get("nvD3Content");a.myheight=a.height;var n=e(o);i.append(n(a));var s=$(i).find(".box-body");a.widget.render&&a.widget.render(s,null,a)},n=function(a,i,r){var o=t.get("nvChartContent");a.myheight=a.height;var n=e(o);i.append(n(a));var s=$(i).find(".box-body");a.widget.render(s,null,a)},s=function(a,i,r){var o=t.get("nvKpiContent"),n=e(o)(a);i.append(n);var s=$(i).find(".kpi-body");a.widget.render(s,null,a)},l=function(a,i,r){var o=t.get("nvChartContent");a.myheight=a.height;var n=e(o)(a);i.append(n);var s=$(i).parents(".box");a.myheight=s.height()-s.children(".box-header").height();var l=$(i).find(".box-body");a.widget.render&&a.widget.render(l,null,a)};return{restrict:"EA",scope:!0,compile:function(e,t){return{pre:function(e,t,a){},post:function(e,t,a){switch(e.widget.widget.data.config.chart_type){case"cityMap":r(e,t,a);break;case"zoneMap":r(e,t,a);break;case"line":r(e,t,a);break;case"line2":r(e,t,a);break;case"line3":r(e,t,a);break;case"pie":r(e,t,a);break;case"flexChart":r(e,t,a);break;case"kpi":s(e,t,a);break;case"table":l(e,t,a);break;case"dataLineTable":l(e,t,a);break;case"funnel":r(e,t,a);break;case"sankey":r(e,t,a);break;case"chord":r(e,t,a);break;case"barPolarStack":r(e,t,a);break;case"pieProportion":r(e,t,a);break;case"radar":r(e,t,a);break;case"map":n(e,t,a);break;case"scatter":r(e,t,a);break;case"gauge":r(e,t,a);break;case"wordCloud":r(e,t,a);break;case"treeMap":r(e,t,a);break;case"areaMap":r(e,t,a);break;case"heatMapCalendar":r(e,t,a);break;case"heatMapTable":r(e,t,a);break;case"markLineMap":r(e,t,a);break;case"liquidFill":r(e,t,a);break;case"rose":r(e,t,a);break;case"flexD3Chart":o(e,t,a);break;default:o(e,t,a)}}}}}}]),discovery.controller("nvDashboardPanelCtrl",["$scope","$state","$http","$stateParams","dataService","ModalUtils","$filter","chartService","$timeout","$uibModal","$location",function(e,t,a,i,r,o,n,s,l,c,d){"ngInject";var u=n("translate");e.optFlag="none",e.curDataset={data:{expressions:[],filters:[],schema:{dimension:[],measure:[]}}},e.curWidget={},e.alerts=[],e.verify={dsName:!0},e.queryAceOpt=cbAcebaseOption,e.params=[],e.treePath="";var f="dataSetTreeID";window.originalData=[];var p="dashboard/updateBoard.do";e.$watch("curDataset.data",function(t){var a={};a=e.curDataset.data.schema},!0);var g=function(){a.get("admin/getBoardListUser.do").success(function(t){e.boardList=t,e.searchNode()})};g(),e.onlyView=function(){return!_.isUndefined(i.onlyView)&&i.onlyView},e.goToCreateChart=function(){e.curDataset&&e.curDataset.id&&t.go("nv.explore_create_by",{cube_id:e.curDataset.id})},e.goToUploadExcel=function(){t.go("nv.excel.upload")},e.dndTransfer={dimension:function(e,t,a,i){"column"==i&&(e[t]={type:"column",column:a})},measure:function(e,t,a,i){"column"==i&&(e[t]={type:"column",column:a})}},e.openWidget=function(e){window.open("#/nv/explore/"+e,"widget")};var h=function(){if(e.alerts=[],!e.curDataset.name)return e.alerts=[{msg:u("CONFIG.DATASET.NAME")+u("COMMON.NOT_EMPTY"),type:"danger"}],e.verify={dsName:!1},$("#DatasetName").focus(),!1;for(var t in e.params){var a=e.params[t].name,i=e.params[t].label,r=e.params[t].required,o=e.curWidget.query[a];if(1==r&&0!=o&&(void 0==o||""==o)){var n=/([\w_\s\.]+)/,s=n.exec(i);return s=s&&s.length>0?u(s[0]):i,e.alerts=[{msg:"["+s+"]"+u("COMMON.NOT_EMPTY"),type:"danger"}],e.verify[a]=!1,!1}}return!0};e.save=function(){if(e.datasource?e.curDataset.data.datasource=e.datasource.id:null,e.curDataset.data.query=e.curWidget.query,h()){var t=angular.copy(e.curDataset),i=t.name.lastIndexOf("/");t.categoryName=e.curDataset.name.substring(0,i).trim(),t.name=e.curDataset.name.slice(i+1).trim(),""==t.categoryName&&(t.categoryName=u("COMMON.DEFAULT_CATEGORY")),"new"==e.optFlag?a.post("dashboard/saveNewBoard.do",{json:angular.toJson(t)}).success(function(t){"1"==t.status?(t.id&&(e.insertId=t.id),g(),e.verify={dsName:!0},o.alert(u("COMMON.SUCCESS"),"modal-success","sm")):e.alerts=[{msg:t.msg,type:"danger"}]}):a.post(p,{json:angular.toJson(t)}).success(function(t){"1"==t.status?(e.optFlag="edit",g(),e.verify={dsName:!0},o.alert(u("COMMON.SUCCESS"),"modal-success","sm")):e.alerts=[{msg:t.msg,type:"danger"}]})}},e.treeConfig=jsTreeConfig1,$("#"+f).keyup(function(t){46==t.keyCode&&e.deleteNode()});var m=function(){var t=jstree_GetSelectedNodes(f)[0];return _.find(e.boardList,function(e){return e.id==t.id})},v=function(e){return jstree_CheckTreeNode(e,f,o.alert)};e.applyModelChanges=function(){return!e.ignoreChanges},e.copyDs=function(t){var i=angular.copy(t);i.name=i.name+"_copy",a.post("dashboard/saveNewBoard.do",{json:angular.toJson(i)}).success(function(t){"1"==t.status?(g(),e.optFlag="none",o.alert(u("COMMON.SUCCESS"),"modal-success","sm")):o.alert(t.msg,"modal-warning","lg")})},e.createNode=function(){var t=e.treePath;c.open({templateUrl:"src/view/nv/dashboard/modal/createTreeNode.html",windowTemplateUrl:"src/view/util/modal/window.html",backdrop:!1,size:"lg",resolve:{nodeName:function(){return e.treePath}},controller:["$scope","$uibModalInstance",function(e,i){e.nodeName=t,e.close=function(){i.close()},e.ok=function(){if(e.nodeName.length){var t={name:e.nodeName};a.post("dashboard/saveNewCategory.do",{json:angular.toJson(t)}).success(function(e){"1"==e.status?(o.alert(u("COMMON.SUCCESS"),"modal-success","sm"),i.close()):o.alert(e.msg,"modal-warning","lg")})}}}]})},$("#"+f).on("select_node.jstree",function(t,a){if(e.treePath="",a.node.id.indexOf("parent")>=0){for(var i=1;i<a.node.parents.length;i++)e.treePath+=a.node.parents.reverse()[i]+"/";e.treePath+=a.node.text+"/"}}),e.copyNode=function(){v("copy")&&e.copyDs(m())},e.editNode=function(){var e=m();d.url("/nv/dashboard/Demo/"+e.id)},e.deleteNode=function(){v("delete")&&e.deleteDs(m())},e.searchNode=function(){var t={dsName:"",dsrName:""},a=e.boardList.map(function(t){var a=_.find(e.datasourceList,function(e){return e.id==t.data.datasource});return{id:t.id,name:t.name,categoryName:t.categoryName,datasourceName:a?a.name:""}});if(e.keywords)if(e.keywords.indexOf(" ")==-1&&e.keywords.indexOf(":")==-1)t.dsName=e.keywords;else for(var i=e.keywords.split(" "),r=0;r<i.length;r++){var o=i[r].trim();"ds"==o.split(":")[0]&&(t.dsName=o.split(":")[1]),"dsr"==o.split(":")[0]&&(t.dsrName=o.split(":")[1])}originalData=jstree_CvtVPath2TreeData(n("filter")(a,{name:t.dsName,datasourceName:t.dsrName})),jstree_ReloadTree(f,originalData),e.keywords&&_.delay(function(){e.treeInstance.jstree(!0).open_all()},100)},e.treeEventsObj=function(){var t=jstree_baseTreeEventsObj({ngScope:e,ngHttp:a,ngTimeout:l,treeID:f,listName:"boardList",updateUrl:p,ModalUtils:o,categoryList:"categoryList"});return t}(),e.doConfigParams=function(){a.get("dashboard/getConfigParams.do?type="+e.datasource.type+"&page=dataset.html").then(function(t){e.params=t.data})},e.queryAceOpt=datasetEditorOptions()}]),discovery.controller("CustomWidgetCtrl",["$scope",function(e,t,a){"ngInject";e.remove=function(e,t){e.widgets&&e.widgets.splice(t,1)},e.config=function(e){$state.go("config.widget",{id:e.widget.id})},e.widgetBoxStyleByType=function(e){switch(e.widget.data.config.chart_type){case"table":case"crossTable":case"crossGreatTable":case"dataLineTable":case"treeGrid":return!0;default:return!1}},e.selectorState=1,e.selectParam=function(t){e.selectorState=t},e.enterParam=function(t){e.selectorState=t}}]).controller("NvDashboardViewCtrl",["$timeout","$interpolate","$rootScope","$scope","EventService","$state","$stateParams","$http","ModalUtils","chartService","$interval","$uibModal","dataService","$filter","$q","BoardParamService","$sce",function($timeout,$interpolate,$rootScope,$scope,EventService,$state,$stateParams,$http,ModalUtils,chartService,$interval,$uibModal,dataService,$filter,$q,BoardParamService,$sce){"ngInject";function getOrangleParam(){var e=BoardParamService.getAll(),t=new Object;t=Object.freeze(angular.copy(e)),window.$$orangle_param=angular.copy(t)}function getParamByOrangle(){var e=$("select.selector_multiple_simple"),t=$(".moment-picker-sty"),a=$(".selector-input"),i=$(".capsule_btn"),r=angular.copy(window.$$orangle_param);e.length>0&&_.each(e,function(e,t){var a=$(e),i=(a.attr("id"),a.attr("data-eventname")),o=a.hasClass("isSingle"),n=a.multipleSelect("getSelects"),s=a.find("option").length,l=null;l=o?n[0]:n.length===s?"all":0===n.length?-1:n,l&&(r[i]=l)}),t.length>0&&_.each(t,function(e,t){var a=$(e),i=a.attr("data-eventname"),o=a.attr("data-selected");"undefined"!=typeof o&&(_typeof("string"===r[i])?r[i]=o.toString():r[i]=o)}),a.length>0&&_.each(a,function(e,t){var a=$(e),i=a.attr("data-eventName"),o=a.attr("data-value");"undefined"!=typeof o&&(_typeof("string"===r[i])?r[i]=o.toString():r[i]=o)}),i.length>0&&_.each(i,function(e,t){var a=$(e),i=a.attr("data-eventName"),o=(a.attr("data-value"),a.attr("data-active"));"undefined"!=typeof o&&(_typeof("string"===r[i])?r[i]=o.toString():r[i]=o)}),window.$$dlut_param=angular.copy(r)}function eventData(e){var t,a={},i=[],r={};return e.param.data&&(i=e.param.data.eventInfo),e.param.this_tr&&(t=e.param.this_tr),e.param.this_td&&(r[$.trim(e.param.this_td.data("column"))]=$.trim(e.param.this_td.data("value"))),_.each(i,function(e){a[e.col]=e.value}),{seriesName:e.param.seriesName,obj:a,_this:t,this_td:r}}function runEvent(e,t,a){!_.isUndefined(drillCallbackMap[a])&&_.isArray(drillCallbackMap[a][t])&&drillCallbackMap[a][t].length>0&&_.each(drillCallbackMap[a][t],function(t){t(e)})}BoardParamService.clear();var drillCallbackMap={},updateUrl="dashboard/updateBoard.do",translate=$filter("translate"),paramInitListener;$scope.started=!1,$scope.isPreview=isPreview,$scope.selectColumnHTML="",$scope.tabs=[],$scope.curTab=null,$stateParams.history?$scope.history=$stateParams.history:$scope.history=[],$stateParams.screenHistory?$scope.screenHistory=$stateParams.screenHistory:$scope.screenHistory=[],$stateParams.role&&($rootScope.role=$stateParams.role),$scope.stateParams=$stateParams,$scope.gridsterOptions={margins:[5,5],columns:36,draggable:{handle:".drag-handler"},rowHeight:35},isPreview?$scope.isAdmin=!0:($http.get("admin/isAdmin.do").success(function(e){$scope.isAdmin=e,$http.get("screens/getScreenIdTitleList.do").success(function(e){$scope.screenList=e})}),$http.get("dashboard/getBoardParam.do?boardId="+$stateParams.id).success(function(e){e?$scope.boardParams=JSON.parse(e.config):$scope.boardParams=[]}));var utils={filter:{injectFilter:function(e){return e.widget&&(e=e.widget),e.data.config.boardFiltersByInit?delete e.data.config.boardFiltersByInit:(e.data.config.boardFilters=[],_.isUndefined(e.data.datasetId)?e.data.config.boardFilters=$scope.widgetFilters[e.id]:e.data.config.boardFilters=$scope.datasetFilters[e.data.datasetId]),e}},widget:{addButton:function(e){var t={name:e.name,widgetId:e.id,sizeX:5,sizeY:5,widget:e,tab:$scope.curTab};utils.widget.rendWidget(t,!1),$scope.board.layout.rows.push({type:"widget",widgets:[t]})},addWidget:function(e){var t={name:e.name,widgetId:e.id,sizeX:5,sizeY:5,widget:e,tab:$scope.curTab};utils.widget.rendWidget(t,!1),$scope.board.layout.rows.push({type:"widget",widgets:[t]})},rendWidget:function(e,t){var a={},i=e.widget.data.config,r=decodeURI(window.location.search);if(r.indexOf("?")!==-1)for(var o=r.substring(r.indexOf("?")+1),n=o.split("&"),s=0;s<n.length;s++)a[n[s].split("=")[0]]=unescape(n[s].split("=")[1]);for(var l in a){var c,d=a[l];d.length>0&&(c=d.split(",")),"object"===("undefined"==typeof c?"undefined":_typeof(c))&&!_.isUndefined(c.length)&&c.length>1&&(a[l]=c)}"selector"===i.chart_type&&(i.temporaryParam=a[i.keys[0].eventName]),utils.widget.temporaryParam=a,utils.widget.buildRender(e,t),e.loading=!0,"timeline"==$scope.board.layout.type?row.show&&(e.show=!0):e.show=!0;var u=e.widget.data,f=_.find($scope.datasetList,function(e){return e.id==u.datasetId});f&&f.data.interval&&f.data.interval>0&&($scope.intervalGroup[u.datasetId]||($scope.intervalGroup[u.datasetId]=[],$scope.intervals.push($interval(function(){_.each($scope.intervalGroup[u.datasetId],function(e){e()})},1e3*f.data.interval))),$scope.intervalGroup[u.datasetId].push(function(){try{e.show&&(chartService.realTimeRender(e.realTimeTicket,utils.filter.injectFilter(e.widget).data),e.modalRealTimeTicket&&chartService.realTimeRender(e.modalRealTimeTicket,utils.filter.injectFilter(e.widget).data,e.modalRealTimeOption.optionFilter,null))}catch(t){console.error(t)}}))},clearRotateFilter:function(e){e.interval&&$interval.cancel(e.interval)},clearAllRouteFilter:function(){_.each($scope.board.layout.rows,function(e){_.each(e.widgets,function(e){try{utils.widget.clearRotateFilter(e)}catch(t){console.error(t)}})})},setBoardFilter:function(e){if(e.config){e.config;e.config.filters&&(_.isUndefined(e.filters_copy)&&(e.filters_copy=angular.copy(e.widget.data.config.filters)),e.widget.data.config.filters=angular.copy(e.filters_copy),e.config.rotateFilters&&e.config.rotateFilters.enable&&e.config.rotateFilters.interval>0?(utils.widget.clearRotateFilter(e),e.widget.data.config.filters=angular.copy(e.filters_copy),e.widget.data.config.filters.push(e.config.filters[0]),e.filterName=e.config.filters[0].group,e.config.rotateFilters.index=1,e.interval=$interval(function(){e.realTimeTicket&&(e.config.rotateFilters.index==e.config.filters.length&&(e.config.rotateFilters.index=0),e.widget.data.config.filters=angular.copy(e.filters_copy),e.widget.data.config.filters.push(e.config.filters[e.config.rotateFilters.index]),e.filterName=e.config.filters[e.config.rotateFilters.index].group,chartService.realTimeRender(e.realTimeTicket,utils.filter.injectFilter(e.widget).data),e.config.rotateFilters.index++)},e.config.rotateFilters.interval)):e.widget.data.config.filters=e.widget.data.config.filters.concat(e.config.filters))}},loadDelayWidget:function(e){_.isUndefined(e)&&(e=!1),_.each($scope.board.layout.rows,function(e){_.each(e.widgets,function(t){$('div[widget="'+t.name+"_"+t.widget.data.config.chart_type+'"]');(_.isUndefined(t.hasRole)||t.hasRole)&&"widget"===e.type&&t.config&&!t.realTimeTicket&&$scope.reloadWidget(t,!1,!0)})})},loadWidgetNum:0,widgetNum:0,widgetInitNum:0,boardParamKeyArr:[],temporaryParam:null,loadWidget:function loadWidget(reload){if($scope.board.config&&$scope.board.config.customStartCode)try{eval($scope.board.config.customStartCode)}catch(e){console.error("board eval页面最初始调用的代码出错",$scope.board.config.customStartCode,e)}if(_.isUndefined(reload)&&(reload=!1),_.each($scope.board.layout.rows,function(e){"widget"===e.type?_.each(e.widgets,function(e){e.widget.data.wName=e.name,e.config||(e.config={}),e.config.isInit===!0&&utils.widget.widgetInitNum++,utils.widget.widgetNum++}):"timePicker"===e.sign?utils.widget.boardParamKeyArr.push(e.config.eventName):"columns"===e.sign&&e.config.columns&&e.config.columns.length>0?(1==parseInt(e.config.chooseType)?BoardParamService.set(e.config.eventName,e.config.columns[0]):BoardParamService.set(e.config.eventName,[]),utils.widget.boardParamKeyArr.push(e.config.eventName)):"condition"===e.sign?e.params.forEach(function(e){utils.widget.boardParamKeyArr.push(e.name)}):"customTrigger"===e.sign||"input"===e.sign&&(BoardParamService.set(e.config.eventName,e.config.showValue),utils.widget.boardParamKeyArr.push(e.config.eventName))}),utils.widget.boardParamKeyArr=_.uniq(utils.widget.boardParamKeyArr),_.each($scope.board.layout.rows,function(e){_.each(e.widgets,function(t){(_.isUndefined(t.hasRole)||t.hasRole)&&("widget"===e.type&&t.config?(void 0===t.config.isInit&&(t.config.isInit=!0),t.config.isInit&&!t.hide&&(utils.widget.setBoardFilter(t),utils.widget.rendWidget(t,reload))):(utils.widget.setBoardFilter(t),utils.widget.rendWidget(t,reload)))})}),0===utils.widget.widgetInitNum&&$scope.board&&$scope.board.config&&$scope.board.config.customCode)try{eval($scope.board.config.customCode)}catch(e){console.error("board eval初始化出错",$scope.board.config.customCode,e)}},buildRender:function buildRender(w,reload){w.render=function(content,optionFilter,scope){chartService.render(content,utils.filter.injectFilter(w).data,optionFilter,scope,reload,void 0,w.theme).then(function(d){var $dom=$('div[widget="'+w.name+"_"+w.widget.data.config.chart_type+'"]');if(w.realTimeTicket=d,w.loading=!1,utils.widget.loadWidgetNum++,$dom.hasClass("rendered")||$dom.addClass("rendered"),utils.widget.loadWidgetNum===utils.widget.widgetInitNum){if($scope.board&&$scope.board.config&&$scope.board.config.customCode)try{eval($scope.board.config.customCode);var temporaryParam=utils.widget.temporaryParam;for(var tr in temporaryParam){var value=temporaryParam[tr],$target=$('[data-eventName="'+tr+'"]');$target.hasClass("selector_multiple_simple")||(isNaN(value)||isNaN(Date.parse(value)))&&$.params.set(tr,value)}}catch(e){console.error("board eval初始化出错",$scope.board.config.customCode,e)}$("body").removeClass(),$("#globalLoading").hide()}}),w.realTimeOption={optionFilter:optionFilter,scope:scope}},w.modalRender=function(e,t,a){w.modalRealTimeTicket=chartService.render(e,utils.filter.injectFilter(w.widget).data,t,a,reload,void 0,w.theme),w.modalRealTimeOption={optionFilter:t,scope:a}}}},params:{addFlex:function(){$scope.board.layout.rows.push({name:"FLEX",type:"board",sizeX:5,sizeY:5,params:[],tab:$scope.curTab,sign:"flex"})},addCustomButton:function(){$scope.board.layout.rows.push({name:"自定义按钮",type:"board",sizeX:5,sizeY:5,params:[],tab:$scope.curTab,sign:"customTrigger",customName:"自定义",customIcon:"fa fa-search"})},addButton:function(){$scope.board.layout.rows.push({name:"搜索",type:"board",sizeX:5,sizeY:5,params:[],tab:$scope.curTab,sign:"trigger"})},addWidget:function(){$scope.board.layout.rows.push({name:"条件组",type:"param",sizeX:5,sizeY:5,params:[],sign:"condition",tab:$scope.curTab})},clearAllSelectParams:function(){_.each($scope.board.layout.rows,function(e){_.each(e.params,function(e){e.title="",e.values=[]})}),$scope.applyParamFilter()},paramToFilter:function(){$scope.widgetFilters=[],$scope.datasetFilters=[],_.each($scope.board.layout.rows,function(e){_.each(e.params,function(e){e.values.length<=0?_.each(e.col,function(e){$scope.globalParamTitleMap[e.column]&&delete $scope.globalParamTitleMap[e.column]}):_.each(e.col,function(t){var a={col:t.column,type:e.type,values:e.values};_.isUndefined(t.datasetId)?($scope.widgetFilters[t.widgetId]||($scope.widgetFilters[t.widgetId]=[]),$scope.widgetFilters[t.widgetId].push(a)):($scope.datasetFilters[t.datasetId]||($scope.datasetFilters[t.datasetId]=[]),$scope.datasetFilters[t.datasetId].push(a)),$scope.globalParamTitleMap[t.column]={col:t.column,type:e.type,values:e.values}})})}),utils.params.updateGlobalParamTitle()},updateGlobalParamTitle:function(){var e=[];for(var t in $scope.globalParamTitleMap){var a=$scope.globalParamTitleMap[t],i=a.type,r=a.values;"like"==i?(i="",r=a.values[0].slice(1,a.values[0].length-1)):r=a.values.join(",");var o=a.col+i+"("+r+")";e.push(o)}return void($scope.globalParamTitle=e.join(","));var e,t,a},updateParamTitle:function(){_.each($scope.board.layout.rows,function(e){_.each(e.params,function(e){if("slider"!=e.paramType){var t;switch(e.type){case"=":case"≠":t=e.name+" "+e.type+" ("+e.values+")";break;case">":case"<":case"≥":case"≤":t=e.name+" "+e.type+" "+e.values;break;case"(a,b]":case"[a,b)":case"(a,b)":case"[a,b]":var a=e.type.split("a")[0],i=e.type.split("b")[1];t=e.name+" between "+a+e.values[0]+","+e.values[1]+i}e.title=e.values.length>0?t:void 0}})}),utils.params.updateGlobalParamTitle()},loadBoardDataset:function(e){var t=[],a=[];_.each($scope.board.layout.rows,function(e){_.each(e.widgets,function(e){var a=null;e.widget&&e.widget.data&&(a=e.widget.data.datasetId);var i=_.find($scope.widgetList,function(e){return e.id==a});i?i.data.datasetId?t.push(i.data.datasetId):i.id&&t.push(i.id):t.push(a)})}),t=_.union(t),$scope.boardDataset=[],_.each(t,function(t){e.i++,dataService.getColumnsByDatasetConfig({datasource:null,query:null,datasetId:t,callback:function(t){$scope.alerts=[],$scope.boardDataset.push({name:t.name,columns:t.data.schema.dimension,datasetId:t.id}),e.i--}})}),_.each(a,function(t){e.i++,dataService.getColumnsByDatasetConfig({datasource:t.data.datasource,query:t.data.query,datasetId:null,callback:function(a){"1"==a.msg?($scope.boardDataset.push({name:t.name,columns:a.columns,widgetId:t.id}),e.i--):$scope.alerts=[{msg:a.msg,type:"danger"}]}})})},editParamRow:function(e,t){var a={i:0};utils.params.loadBoardDataset(a);
var i,r,o=$scope;_.isUndefined(e)&&(e={type:"param",params:[]}),_.isUndefined(t)?(r={col:[]},i=function(t){e.params||(e.params=[]),e.params.push(t)}):(r=angular.copy(e.params[t]),i=function(a){e.params[t]=a}),$uibModal.open({templateUrl:"src/view/nv/dashboard/modal/cubeParam.html",windowTemplateUrl:"src/view/util/modal/window.html",backdrop:!1,size:"lg",controller:["$scope","$uibModalInstance",function(e,t){e.param_types=[{name:translate("CONFIG.DASHBOARD.PARAM_TYPE_SELECTOR"),value:"selector"},{name:translate("CONFIG.DASHBOARD.PARAM_TYPE_SLIDER"),value:"slider"}],e.status=a,e.param=r,e.param.paramType||(e.param.paramType="default"),e.boardDataset=o.boardDataset,e.add=function(t,a,i,r){if("level"===a.type)return!1;var o=angular.copy(t);_.isUndefined(o.datasetId)&&!_.isUndefined(o.widgetId)&&(o.datasetId=o.widgetId,delete o.widgetId),delete o.columns,"level"===r&&(o.alias=i+"-",o.type="level"),o.column=a.column;for(var n=e.param.col,s=null,l=0;l<n.length;l++)n[l].column===o.column&&n[l].name===o.name?s=!0:null;s&&e.param.col!=[]?null:e.param.col.push(o)},e.close=function(){t.close()},e.deleteSelected=function(t,a){for(var i=e.param.col[t].column,r=$(".cube>span"),o=0;o<r.length;o++)$(r[o])[0].innerText!=i&&$(r[o]).data("column")!=i||$(r[o]).removeClass("itemSelected");if("level"===a)for(var n=$(".cube span.alias"),o=0;o<n.length;o++)$(n[o]).data("dh")==i&&$(n[o]).removeClass("itemSelected");e.param.col.splice(t,1)},e.ok=function(){e.param.name?(i(e.param),t.close()):ModalUtils.alert(translate("CONFIG.DASHBOARD.ENTER_PARAMETER_NAME"),"modal-warning","lg")},e.foldCube=function(t,a){var i="img"==a.target.localName?a.target.parentNode.parentNode:a.target.parentNode,r=i.getElementsByTagName("img");if("cubeName ng-binding"==a.target.className||"img"==a.target.localName)"25px"==i.style.height||""==i.style.height?(i.style.height="unset",r[0].style.webkitTransform="rotate(90deg)"):(i.style.height="25px",r[0].style.webkitTransform="rotate(0deg)");else if("span"==$(a.target)[0].localName){if(""===$($(a.target)[0]).data("column"))return!1;$(a.target).addClass("itemSelected")}e.param.col.map(function(e){for(var t=e.column,a=e.name,i=$(".cube>span"),r=0;r<i.length;r++){var o=i[r].parentNode.firstElementChild.innerText;($(i[r])[0].innerText==t&&a==o||$(i[r]).data("column")==t)&&$(i[r]).addClass("itemSelected")}})}}]})}},getBoardRows:function(e){var t=(e.board.layout.rows,["widgetId","name","col","row","sizeX","sizeY","action","screenAction","tab","theme","config","maximizeOption"]),a=[];return _.each(e.board.layout.rows,function(e){if("widget"==e.type){var i=!1,r=[];_.each(e.widgets,function(a){if(_.isUndefined(a.hasRole)||a.hasRole){for(var o=0;o<e.widgets.length;o++){for(var a=e.widgets[o],n={},s=0;s<t.length;s++)void 0!=a[t[s]]&&(n[t[s]]=a[t[s]]);r.push(n)}tabAlive(a.tab.id)&&(i=!0)}}),r.length>0&&i&&a.push({type:"widget",widgets:r})}else"param"==e.type?tabAlive(e.tab.id)&&a.push(e):"board"==e.type?(tabAlive(e.tab.id)&&e.timePicker&&(e.timePicker=""),e.config&&e.config.selectColumn&&(e.config.selectColumn=""),a.push(e)):"tabs"==e.type&&tabAlive(e.tab.id)&&a.push(e)}),a}};$scope.clearAllSelectParams=utils.params.clearAllSelectParams,$scope.openConfigModel=utils.params.openConfigModel,$scope.editParamRow=utils.params.editParamRow,$scope.addParamWidget=utils.params.addWidget,$scope.addFlex=utils.params.addFlex,$scope.addButton=utils.params.addButton,$scope.addCustomButton=utils.params.addCustomButton,$scope.addSignLine=function(){$(".addSignLine").prepend("<div class='signLine'></div>");var e=$(".addSignLine").width()/2;$(".signLine").attr("style","top:"+e+"px")},$scope.loading=!0,$http.get("dashboard/getBoardData.do?id="+$stateParams.id+"&token="+getQueryString("yili-token")).success(function(response){var datasetList=[];_.each(response.layout.rows,function(e){"widget"==e.type&&datasetList.push(e.widgets[0].widget.data.datasetId)});var readyCallback=function readyCallback(){$scope.loading=!1,$scope.board=response,$scope.deadline=null,$scope.board.config&&$scope.board.config.type&&("day"===$scope.board.config.type?$scope.deadline=moment().subtract(1,"days").format("YYYY年MM月DD日"):"month"===$scope.board.config.type&&($scope.deadline=moment().subtract(1,"month").format("YYYY年MM月"))),_.each($scope.board.layout.rows,function(row){if("param"==row.type||"widget"!=row.type)initTabList(row);else if("widget"===row.type&&utils.widget.loadWidgetNum===utils.widget.widgetInitNum&&0!==utils.widget.widgetInitNum){if($scope.board&&$scope.board.config&&$scope.board.config.customCode)try{eval($scope.board.config.customCode)}catch(e){console.error("board eval初始化出错",config.customCode,e)}$("body").removeClass(),$("#globalLoading").hide()}"flex"===row.sign&&row.config&&(row.config.showHTML=""),_.each(row.widgets,function(e){(_.isUndefined(e.hasRole)||e.hasRole)&&(e.loading=!0,e.widget&&e.widget.data&&(e.widget.data.loadingCircle=!0),e.show=!0,initTabList(e))}),"columns"===row.sign&&(1===row.config.chooseType?BoardParamService.set(row.config.eventName,row.config.columns[0]):BoardParamService.set(row.config.eventName,[]))}),_.each($scope.board.layout.rows,function(e){"param"==e.type&&initTabList(e),_.each(e.widgets,function(e){(_.isUndefined(e.hasRole)||e.hasRole)&&(e.loading=!0,e.show=!0,initTabList(e))})}),0==$scope.tabs.length&&($scope.tabs[0]={id:0,name:"默认"}),$scope.tabs=_.sortBy($scope.tabs,"id"),null==$stateParams.tab?$scope.curTab=$scope.tabs[0]:void 0!=$scope.tabs[$stateParams.tab]?$scope.curTab=$scope.tabs[$stateParams.tab]:$scope.curTab={id:null,name:null};var hasInitParam=!1;utils.params.clearAllSelectParams(),utils.widget.loadWidget(!1),$stateParams.param.length>0&&(directApplyParamFilter2($stateParams.param,!0),hasInitParam=!0),hasInitParam&&($scope.applyParamFilter(),$stateParams.param=[])};datasetList.length?dataService.getDatasetList(datasetList).then(readyCallback):readyCallback()}),$scope.addTimePicker=function(){var e=$uibModal.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"src/view/nv/dashboard/layout/modals/addTimePickerWidget.html",size:"sm",controller:"AddTimePickerWidgetCtrl",resolve:{tab:function(){return angular.copy($scope.curTab)}}});e.result.then(function(e){$scope.board.layout.rows.push(e)})},$scope.initTime=function(row){BoardParamService.get(row.config.eventName)||(row.config.showValue="");var configArr=[];if(row.config.initConfig&&(configArr=row.config.initConfig.split(";")),configArr.forEach(function(e){var t=e.split(",");3===t.length&&"now"===t[0]?(t[2]=parseInt(t[2]),"DD"===t[1]?row.showValue=moment().add(t[2],"days").format("YYYY年MM月DD日"):"YYYY"===t[1]?row.showValue=moment().add(t[2],"years").format("YYYY年"):"MM"===t[1]?row.showValue=moment().add(t[2],"months").format("YYYY年MM月"):alert("初始化公式拼写错误！")):alert("初始化公式拼写错误！"),row.defaultValue=row.showValue,row.defaultValue=findNum(row.config.defaultValue).join(""),BoardParamService.set(row.config.eventName,[row.defaultValue])}),row.config.initTime){var initValue,temporaryParam=utils.widget.temporaryParam;try{initValue=eval(row.config.initTime)}catch(e){console.log("初始化日期赋值出错！")}_.isUndefined(temporaryParam[row.config.eventName])||initValue===temporaryParam[row.config.eventName]||(initValue=temporaryParam[row.config.eventName]),row.defaultValue=initValue,BoardParamService.set(row.config.eventName,initValue),row.config.initValue=dlut.math.toDate(initValue)}},$scope.stepTime=function(e,t){if(e.config.showValue){var a=findNum(e.config.showValue);switch(a[0]=parseInt(a[0]),a[1]=parseInt(a[1])-1,a[2]=parseInt(a[2]),t){case"forWard":"year"==e.config.timeType?e.config.showValue=moment(a).add(1,"years").format("YYYY年"):"month"==e.config.timeType?e.config.showValue=moment(a).add(1,"months").format("YYYY年MM月"):e.config.showValue=moment(a).add(1,"days").format("YYYY年MM月DD日");break;case"back":"year"==e.config.timeType?e.config.showValue=moment(a).add(-1,"years").format("YYYY年"):"month"==e.config.timeType?e.config.showValue=moment(a).add(-1,"months").format("YYYY年MM月"):e.config.showValue=moment(a).add(-1,"days").format("YYYY年MM月DD日")}e.config.defaultValue=a.join(""),BoardParamService.set(e.config.eventName,[e.config.defaultValue])}},$scope.changeTime=function(e,t,a){t.config.defaultValue=findNum(t.config.showValue).join(""),BoardParamService.set(t.config.eventName,t.config.defaultValue),$timeout(function(){$scope.boardFunBtnClick(t.config)},300)},$scope.initCapsule=function(e){e.activeName?e.activeName:e.activeName=e.columns[0],BoardParamService.set(e.eventName,e.activeName)},$scope.addCapsule=function(){var e=$uibModal.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"src/view/nv/dashboard/layout/modals/addCapsuleModal.html",size:"sm",controller:"addCapsuleCtrl",resolve:{tab:function(){return angular.copy($scope.curTab)}}});e.result.then(function(e){$scope.board.layout.rows.push(e)})},$scope.switchCapsule=function(config,item){if(config.activeName=item,BoardParamService.set(config.eventName,item),config.functions.length)try{eval(config.functions)}catch(e){console.log("胶囊执行方法出错",e)}},$scope.boardFunBtnClick=function(config){if(_.isUndefined(window.$$orangle_param)&&getOrangleParam(),getParamByOrangle(),config.customCode)try{eval(config.customCode)}catch(e){console.error("board eval语句出错",config.customCode,e)}},$scope.triggerTime=function(e){return $.filters.autoCalc(),$.iframes.calcUrl(),$.widgets.initAll(),void $.widgets.reloadAll();var t,a,i,r,o,n},$scope.addInput=function(){var e=$uibModal.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"src/view/nv/dashboard/layout/modals/addInputWidget.html",size:"sm",controller:"AddInputWidgetCtrl",resolve:{tab:function(){return angular.copy($scope.curTab)}}});e.result.then(function(e){$scope.board.layout.rows.push(e)},function(){})},$scope.changeColsDefault=function(e){if(e&&e.config){var t=angular.copy(e.config.showValue).toString();t.indexOf("%")>-1&&(t=t.replace("%","")),$("#"+e.name+"_input").attr("data-value",t),BoardParamService.set(e.config.eventName,t),$timeout(function(){$scope.boardFunBtnClick(e.config)},300)}},$scope.focusChangeColsDefault=function(row){if(row&&row.config&&(BoardParamService.set(row.config.eventName,row.config.showValue),$scope.boardFocusFunBtnClick(row.config),row.config.customFocusCode))try{eval(row.config.customFocusCode)}catch(e){console.error("board eval语句出错",config.customFocusCode,e)}},$scope.addIframeWidget=function(){var e=$uibModal.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"src/view/nv/dashboard/layout/modals/addIframeWidget.html",size:"sm",controller:"AddIframeWidgetCtrl",resolve:{tab:function(){return angular.copy($scope.curTab)}}});e.result.then(function(e){$scope.board.layout.rows.push(e)},function(){})},$scope.initMultipleSelect=function(e,t){$scope.$applyAsync(function(){var t="select_"+(e.config.eventName?e.config.eventName:e.name),a=$("#"+t),i=1==parseInt(e.config.chooseType);a.multipleSelect({single:i,onClick:function(t){if(i)BoardParamService.set(e.config.eventName,t.value),a.attr("data-selected",t.value);else{var r=t.instance.getSelects();0===r.length&&(r="-1"),BoardParamService.set(e.config.eventName,r),a.attr("data-selected",r)}},onCheckAll:function(){BoardParamService.set(e.config.eventName,[]),a.attr("data-selected","all")},onUncheckAll:function(){BoardParamService.set(e.config.eventName,"-1"),a.attr("data-selected",-1)},onClose:function(){$timeout(function(){$scope.boardFunBtnClick(e.config)},300)}}),i?(a.multipleSelect("setSelects",[e.config.columns[0]]),BoardParamService.set(e.config.eventName,e.config.columns[0]),a.attr("data-selected",e.config.columns[0])):(a.multipleSelect("checkAll"),BoardParamService.set(e.config.eventName,[]),a.attr("data-selected","all"))})},$scope.addCols=function(){var e=$uibModal.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"src/view/nv/dashboard/layout/modals/addColsWidget.html",size:"sm",controller:"AddColsWidgetCtrl",resolve:{tab:function(){return angular.copy($scope.curTab)}}});e.result.then(function(e){$scope.board.layout.rows.push(e)},function(){})},$scope.addStaticText=function(e){var t=$uibModal.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"src/view/nv/dashboard/layout/modals/addStaticText.html",size:"lg",controller:"addStaticTextCtrl",resolve:{row:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){return e?angular.copy(e):""}),tab:function(){return angular.copy($scope.curTab)}}});t.result.then(function(e){$scope.board.layout.rows.push(e)})},$scope.getAlertInfo=function(){var e=$uibModal.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"src/view/nv/dashboard/layout/modals/alertInfo.html",size:"lg",controller:"alertInfoCtrl",resolve:{config:function(){return angular.copy($scope.board.config)}}});e.result.then(function(e){$scope.board.config.alertInfo=e.alertInfo})},$scope.addDynamicTitle=function(e){var t=$uibModal.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"src/view/nv/dashboard/layout/modals/addDynamicTitleModel.html",size:"sm",controller:"addDynamicTitleCtrl",resolve:{tab:function(){return angular.copy($scope.curTab)},globalParamTitleMap:function(){return angular.copy($scope.globalParamTitleMap)},row:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){return e?angular.copy(e):""})}});t.result.then(function(t){if(e){var a=t.config.dynamicTitle;for(var i in $scope.globalParamTitleMap){var r=$scope.globalParamTitleMap[i];a=a.replace("{{"+i+"}}",r.values[0])}a.indexOf("{{")>-1?(e.showTitle=t.config.dynamicDefault,e.config.dynamicDefault=t.config.dynamicDefault,e.config.dynamicTitle=t.config.dynamicTitle):e.showTitle=a}else $scope.board.layout.rows.push(t)})},$scope.$watch("globalParamTitleMap",function(){$scope.dynamicTitleFun()},!0),$scope.dynamicTitleFun=function(){$scope.board&&_.each($scope.board.layout.rows,function(e){if("title"==e.sign){var t=e.config.dynamicTitle;for(var a in $scope.globalParamTitleMap){var i=$scope.globalParamTitleMap[a];t=t.replace("{{"+a+"}}",i.values[0])}t.indexOf("{{")>-1?e.showTitle=e.config.dynamicDefault:e.showTitle=t}})},$scope.addImgWidget=function(){var e=$uibModal.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"src/view/nv/dashboard/layout/modals/addImgWidget.html",size:"sm",controller:"AddImgWidgetCtrl",resolve:{tab:function(){return angular.copy($scope.curTab)}}});e.result.then(function(e){$scope.board.layout.rows.push(e)})},$scope.addTabGroupWidget=function(){$scope.board.layout.rows.push({name:"Tab group",type:"board",sign:"tabs",sizeX:5,sizeY:5,tab:$scope.curTab})},$scope.addTab=function(){$uibModal.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"src/view/nv/dashboard/layout/modals/tabModel.html",size:"sm",controller:"tabCtrl",resolve:{tab:function(){},tabs:function(){return $scope.tabs}}})},$scope.changeTabName=function(e){$uibModal.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"src/view/nv/dashboard/layout/modals/tabModel.html",size:"sm",controller:"tabCtrl",resolve:{tab:function(){return e},tabs:function(){return $scope.tabs}}})},$scope.deleteTab=function(e){e==$scope.curTab.id&&(e>0?$scope.curTab=$scope.tabs[e-1]:$scope.curTab=$scope.tabs[e+1]),$scope.tabs.splice(e,1)},$scope.goToTab=function(e){$scope.curTab=e};var initTabList=function(e){if(void 0==e.tab)e.tab={id:0,name:"默认"};else if(e.tab.id===!0)return;for(var t=!0,a=0;a<$scope.tabs.length;a++)$scope.tabs[a].id==e.tab.id&&(t=!1);t&&$scope.tabs.push(e.tab)},tabAlive=function(e){if(1==e)return!0;0==$scope.tabs.length&&($scope.tabs=[{id:0,name:"默认"}]);for(var t=!1,a=0;a<$scope.tabs.length;a++)$scope.tabs[a].id==e&&(t=!0);return t};$scope.paramToString=function(e){return _.filter(_.map(e.params,function(e){return e.title}),function(e){return e&&e.length>0}).join("; ")},$scope.paramsFun=function(){return $$dlut_param},$scope.goToEditPage=function(e){window.open("#/nv/explore/"+e)},$scope.openCopyWidgetModal=function(e,t){$uibModal.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"src/view/nv/dashboard/layout/modals/copyWidgetModal.html",size:"lg",controller:["$scope","$uibModalInstance",function(a,i){"widget"===t?a.widget=JSON.stringify(e.widget):a.row=JSON.stringify(e),a.ok=function(){i.close()},a.cancel=function(){i.close()}}]})},$scope.pasteWidgetModelOpen=function(){var e=$uibModal.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"src/view/nv/dashboard/layout/modals/copyWidgetModal.html",size:"lg",controller:["$scope","$uibModalInstance",function(e,t){e.widget="",e.row="",e.cancel=function(){t.dismiss("cancel")},e.ok=function(){var a={type:"",data:null};e.widget?(a.type="widget",a.data=JSON.parse(e.widget)):e.row&&(a.type="row",a.data=JSON.parse(e.row)),t.close(a)}}]});e.result.then(function(e){"row"===e.type?(delete e.data.$$hashKey,$scope.board.layout.rows.push(e.data)):utils.widget.addWidget(e.data)},function(){})},$scope.goToDescribe=function(e){$scope.alert(e)},$scope.addWidgetModelOpen=function(){var e=$uibModal.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"src/view/nv/dashboard/layout/modals/addWidgetModel.html",size:"sm",controller:"AddWidgetModelCtrl"});e.result.then(function(e){utils.widget.addWidget(e)},function(){console.info("Modal dismissed at: "+new Date)})},$scope.save=function(){if($scope.board.name&&$scope.board.id){var e=utils.getBoardRows($scope),t={json:angular.toJson({layout:{rows:e},categoryId:$scope.board.categoryId,name:$scope.board.name,id:$scope.board.id,config:$scope.board.config})};$http.post(updateUrl,t).success(function(e){"1"==e.status?($scope.optFlag="edit",ModalUtils.alert(e.msg,"modal-success","sm")):ModalUtils.alert(e.msg,"modal-warning","sm")})}},$scope.clear=function(){$scope.board.layout.rows=[]},$scope.removeParam=function(e){$scope.board.layout.rows.splice(e,1)},$scope.clearParams=function(){$scope.applyParamFilter(!0)},$scope.newBoardParam=function(e){if(""!=e){$scope.newBoardParamName="";var t={};_.each($scope.board.layout.rows,function(e){_.each(e.params,function(e){"slider"!=e.paramType&&(t[e.name]={type:e.type,values:e.values})})}),$scope.boardParams.unshift({name:e,params:t}),$http.post("dashboard/saveBoardParam.do",{boardId:$stateParams.id,config:angular.toJson($scope.boardParams)})}},$scope.deleteBoardParam=function(e){$scope.boardParams.splice(e,1),$http.post("dashboard/saveBoardParam.do",{boardId:$stateParams.id,config:angular.toJson($scope.boardParams)})},$scope.applyBoardParam=function(e){for(var t in e)_.each($scope.board.layout.rows,function(a){_.each(a.params,function(a){a.name==t&&(a.type=e[t].type,a.values=e[t].values)})});$scope.applyParamFilter()},$scope.goBack=function(){if($scope.history.length>0){var e=$scope.history.pop();_.isUndefined(e.id)||$state.go("nv.dashboard.view",{id:e.id,param:e.param,history:$scope.history,screenHistory:$scope.screenHistory,role:$rootScope.role},{reload:!0})}},$scope.goBackAll=function(){EventService.trigger("WS:screenBack",{},"all")},$scope.widgetConfigModelOpen=function(e){var t=$uibModal.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"src/view/nv/dashboard/layout/modals/widgetConfigModal.html",size:"",controller:"widgetConfigModalControl",resolve:{widget:function(){return e},screenList:function(){return $scope.screenList?$scope.screenList:[]},isAdmin:function(){return $scope.isAdmin},widgetThemeConfigGroups:function(){if(!_.isUndefined($scope.themeConfigList)){var t=e.type,a="";return _.isUndefined(t)&&(t="widget"),"param"!=t&&"board"!=t&&(a=e.widget.data.config.chart_type),$scope.themeConfigList[t+":"+a]}},url:function a(){if("board"==e.type){var a="http://";_.isUndefined(e.config)||_.isUndefined(e.config.url)||(a=e.config.url)}return a},tab:function(){return angular.copy($scope.curTab)},tabs:function(){return angular.copy($scope.tabs)}}});t.result.then(function(){e.widget&&$scope.reloadWidget(e)})},$scope.boardConfigModelOption=function(){var e=$uibModal.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"src/view/nv/dashboard/layout/modals/setPanelTheme.html",size:"lg",controller:"SetPanelCtrl",resolve:{config:function(){return void 0==$scope.board.config&&($scope.board.config={}),angular.copy($scope.board.config)},boardName:function(){return $scope.board.name},categoryId:function(){return $scope.board.categoryId}}});e.result.then(function(e){$scope.board.name=e.boardName,$scope.board.config=e.config,$scope.board.categoryId=e.categoryId},function(){})},$scope.minimizeWidget=function(){$scope.curTab=angular.copy($scope.lastTab)},$scope.maximizeWidget=function(e,t){var a=$(t.target).parents(".panelTheme"),i=e.maximizeOption;if(e.maximize)"filter"==i.type?$scope.lastFilter&&(e.widget.data.config.filters=$scope.lastFilter):"default"==i.type,e.maximizeOption2={style:$scope.lastSize};else{if("filter"===i.type){$scope.lastFilter=e.widget.data.config.filters;var r=i.filters;e.filters_copy&&(r=r.concat(e.filters_copy)),e.widget.data.config.filters=r}else"tab"==i.type?($scope.lastTab=angular.copy($scope.curTab),$scope.curTab={id:i.tabSelect}):"default"==i.type;$scope.lastSize={width:a.width(),height:a.height(),left:a.position().left,top:a.position().top},i.custumSize?e.maximizeOption2={style:{width:100/24*parseInt(i.sizeX)+"%",height:100/12*parseInt(i.sizeY)+"%",left:100/24*parseInt(i.col)+"%",top:100/12*parseInt(i.row)+"%",background:'url("theme/theme_Beili01/images/bk.jpg") no-repeat',"z-index":9999}}:e.maximizeOption2={style:{width:"100%",height:"100%",left:0,top:0,background:'url("theme/theme_Beili01/images/bk.jpg") no-repeat',"z-index":9999}}}"tab"!=i.type&&(e.maximize=!e.maximize,$scope.reloadWidget(e,!0))},$scope.applyParamFilter=function(e){e?($scope.widgetFilters=[],$scope.datasetFilters=[],$scope.globalParamTitle="",$scope.globalParamTitleMap={},_.each($scope.board.layout.rows,function(e){_.each(e.params,function(e){e.values=[]})})):utils.params.paramToFilter(),_.each($scope.board.layout.rows,function(e){_.each(e.widgets,function(e){if(!e.config||!e.config.ignoreEvent)try{chartService.realTimeRender(e.realTimeTicket,utils.filter.injectFilter(e.widget).data)}catch(t){console.error(t)}})}),utils.params.updateParamTitle()},$scope.globalParamTitleMap={};var directApplyParamFilter2=function(e,t,a){_.each($scope.board.layout.rows,function(t){_.each(t.params,function(t){for(var a=0;a<e.length;a++)e[a].column==t.name&&(t.type=e[a].type,t.values=e[a].values)})}),utils.params.updateGlobalParamTitle()};$scope.reloadWidget=function(e,t,a){_.isUndefined(e.render)||t?(t||utils.widget.setBoardFilter(e),e.show=!1,e.render=function(t,a,i){chartService.render(t,e.widget.data,a,i,!0,void 0,e.theme).then(function(t){e.realTimeTicket=t,utils.widget.loadWidgetNum++,utils.widget.loadWidgetNum===utils.widget.widgetNum&&(e.loading=!1,$.filters.autoCalc(),$.iframes.calcUrl(),$scope.started||($.widgets.initAll(),$.widgets.reloadAll()))}),e.realTimeOption={optionFilter:a,scope:i}},$timeout(function(){e.loading=!0,e.show=!0})):chartService.realTimeRender(e.realTimeTicket,utils.filter.injectFilter(e.widget).data)},$scope.reloadAllWidget=function(){_.each($scope.board.layout.rows,function(e){"widget"==e.type&&_.each(e.widgets,function(e){$scope.reloadWidget(e)})})};var getThemeConfigInfo=function(e){};$scope.$watch("board.config.theme",getThemeConfigInfo),CBoardEChartRender.prototype.theme="theme-fin1",EventService.on("WS:screenSkip",function(e){$http.get("screen/getScreenMenuItemByIdType.do?id="+e.target+"&type="+$rootScope.role).success(function(t){e.history&&($scope.screenHistory=e.history),""==t?$scope.screenHistory.push({}):(_.isUndefined($stateParams.param)&&($stateParams.param=[]),$scope.screenHistory.push({id:$stateParams.id,param:$stateParams.param}),$state.go("nv.dashboard.view",{id:t.dashboard_id,param:e.param,history:$scope.history,screenHistory:$scope.screenHistory,role:$rootScope.role},{reload:!0}))})}),EventService.on("WS:screenBack",function(e){if($scope.screenHistory.length>0){var t=$scope.screenHistory.pop();_.isUndefined(t.id)?$stateParams.screenHistory=$scope.screenHistory:$state.go("nv.dashboard.view",{id:t.id,param:t.param,history:$scope.history,screenHistory:$scope.screenHistory,role:$rootScope.role},{reload:!0})}}),EventService.on("CE:dblclick",function(e){console.log("CE:dblclick",e)}),EventService.on("CE:click",function(e){console.log("CE:click",e);var t=e.widget,a=(t.widgetId,e.param),i=[];if((a&&a.data&&a.data.eventInfo||"blank"===a.trigger)&&EventService.trigger("$click",e),a.region&&EventService.trigger("$click",e),_.isArray(a.data)){var r=a.data[a.data.length-1];r.length>0&&void 0!=r[0].value&&(i=r)}else{if(_.isUndefined(a.data))return;a.data.eventInfo&&(i=a.data.eventInfo)}var o=!_.isUndefined($rootScope.role)&&!_.isUndefined(t.screenAction)&&!_.isUndefined(t.screenAction.target),n=t.screenAction;if(o&&n){var s=t.widget.data.datasetId,l=angular.copy(n),c=n.param,d=[];for(var u in c)if(c[u].selected)for(var f=0;f<i.length;f++){var p=i[f].value;if(_.isArray(p)||(p=[p]),u==i[f].col){d.push({datasetId:s,column:u,type:"=",values:p});break}}l.param=d,EventService.trigger("WS:screenSkip",l,"all")}if(_.isUndefined(t.action)||_.isUndefined(t.action.type)&&_.isUndefined(t.action.regular));else if(_.isUndefined(t.action.regular))actionSkip(e,t.action,i,o);else if(t.action.regular){if(t.action.regular){var g=!1;_.each(t.action.list,function(t){var a=0;for(var r in t.param)t.param[r].selected&&a++;for(var n=0,s=0;s<i.length;s++)for(var r in t.param)if(i[s].col==r&&t.param[r].selected){var l=new RegExp(t.param[r].regular,"g");l.test(i[s].value)&&n++}a!=n||g||(g=!0,actionSkip(e,t,i,o))})}}else actionSkip(e,t.action.list[0],i,o)});var actionSkip=function(e,t,a,i){var r=e.widget,o=r.widgetId,n={};for(var s in t.param){var l=t.param[s],c=_.find(a,function(e){return e.col==l.col});void 0!=c&&void 0!=c.value&&(n[l.col]=c.value)}if("self"===t.type||"dashboard"===t.type){var d=r.widget.data.datasetId,u=[],f=[];t.ignoreSelf&&f.push(o),_.each(t.param,function(e){if(e.selected&&e.col&&!_.isUndefined(n[e.col])){var t=n[e.col];_.isArray(t)||(t=[t]),u.push({datasetId:d,column:e.col,type:"=",values:t})}}),"dashboard"!=t.type||i?"self"==t.type&&directApplyParamFilter2(u,void 0,f):(_.isUndefined($stateParams.param)&&($stateParams.param=[]),$scope.history.push({id:$stateParams.id,param:$stateParams.param}),$state.go("nv.dashboard.view",{id:t.target,param:u,history:$scope.history,screenHistory:$scope.screenHistory,role:$rootScope.role},{reload:!0}))}else if("url"==t.type){var p=t.target.toString();for(var g in n){var h=n[g];p=p.replace("{{"+g+"}}",h)}window.open(p,"noNewOpen","top=0,left=0,width=1920,height=1080,menubar=no,scrollbars=yes,resizable=yes,status=yes,titlebar=no,toolbar=no,location=no","_blank")}};EventService.on("CE:drillDown",function(e){console.log("CE:drillDown-dashboard",e),EventService.trigger("$drillDown",e);var t=e.widget.widget.data.config.keys,a=e.widget.widget.data.config.groups,i=e.widget.widget.data.config.drillTier,r=e.widget.realTimeTicket,o=!1,n=null;i.isGreat=!!e.param.isGreat&&e.param.isGreat,_.each(t,function(t){_.isUndefined(t.drillDown)||i.keyTier<t.drillDown.length-1&&(_.isUndefined(e.param.drillType)||"key"===e.param.drillType)&&(o=!0,n=t.drillDown[i.keyTier],i.filters.key.push(e.param.name),i.keyTier++)}),_.each(a,function(t){_.isUndefined(t.drillDown)||i.groupTier<t.drillDown.length-1&&(_.isUndefined(e.param.drillType)||"group"===e.param.drillType)&&(o=!0,n=key.drillDown[i.groupTier],i.filters.group.push(e.param.name),i.groupTier++)}),"treeGrid"===e.type&&(o=!0,i.keyTier=e.tier.tier,i.filters.key=e.tier.list,i.treeGridFilters=e.filters),o&&chartService.realTimeRender(r,e.widget.widget.data)}),EventService.on("CE:drillUp",function(e){EventService.trigger("$drillUp",e);var t=e.widget.widget.data.config.keys,a=e.widget.widget.data.config.groups,i=e.widget.widget.data.config.drillTier,r=e.widget.realTimeTicket,o=!1,n=null;i.isGreat=!!e.param.isGreat&&e.param.isGreat,_.each(t,function(t){_.isUndefined(t.drillDown)||i.keyTier>0&&(_.isUndefined(e.param.drillType)||"key"===e.param.drillType)&&(o=!0,n=t.drillDown[i.keyTier],i.filters.key.pop(),i.keyTier--)}),_.each(a,function(t){_.isUndefined(t.drillDown)||i.groupTier>0&&(_.isUndefined(e.param.drillType)||"group"===e.param.drillType)&&(o=!0,n=key.drillDown[i.groupTier],i.filters.group.pop(),i.groupTier--)}),o&&chartService.realTimeRender(r,e.widget.widget.data)}),EventService.on("$click",function(e){var t=eventData(e),a=BoardParamService.getAll();"chart"===e.type?runEvent({data:t.obj,param:a,seriesName:t.seriesName},e.widget.widget.data.wName,"$click"):"table"===e.type&&runEvent({data:t.obj,param:a,_this:t._this,this_td:t.this_td},e.wName,"$click")}),EventService.on("$drillDown",function(e){var t=eventData(e);"chart"===e.type?runEvent({data:t.obj,seriesName:t.seriesName},e.widget.widget.data.wName,"$drillDown"):"table"===e.type}),EventService.on("$drillUp",function(e){var t=eventData(e);"chart"===e.type?runEvent({data:t.obj,seriesName:t.seriesName},e.widget.widget.data.wName,"$drillUp"):"table"===e.type}),EventService.on("$ready",function(e){runEvent("",e.wName,"$ready")}),EventService.on("$blank",function(){try{if($scope.board)for(var e=0;e<$scope.board.layout.rows.length;e++){var t=$scope.board.layout.rows[e];"customTrigger"===t.sign&&t.config.customCode&&$scope.boardFunBtnClick(t.config)}}catch(a){console.error("点击空白错误",a)}}),$("body").off("click").on("click",function(e){var t=$(e.target);(t.hasClass("gridster")||t.hasClass("contentTheme"))&&$timeout(function(){EventService.trigger("$blank")},500)}),$scope.$on("$destroy",function(){if(CBoardEChartRender.prototype.theme="theme-fin1",window.chartOptionList=void 0,window.$$orangle_param=void 0,window.$$EXCEL={},drillCallbackMap={},$scope.board.config&&$scope.board.config.customDesCode)try{eval($scope.board.config.customDesCode)}catch(e){console.error("board eval页面离开时调用的代码出错",$scope.board.config.customCode,e)}utils.widget.clearAllRouteFilter(),$(document).off("click")}),$.widgets={reload:function(e){return isArrayFn(e)?(utils.params.paramToFilter(),_.each($scope.board.layout.rows,function(t){_.each(t.widgets,function(t){if(_.indexOf(e,t.name)>-1)try{"treeGrid"===t.widget.data.config.chart_type&&$.widgets.resetChartDrill([t.name]),delete t.widget.data.config.temporaryParam,chartService.realTimeRender(t.realTimeTicket,utils.filter.injectFilter(t.widget).data,void 0,void 0,function(){})}catch(a){console.error(a)}})}),void utils.params.updateParamTitle()):void alert("reload参数应为数组")},reloadAll:function(){$scope.applyParamFilter()},resetChartDrill:function(e,t){_.isUndefined(t)&&(t=1),_.each(e,function(e){var a=_.find($scope.board.layout.rows,function(t){if("widget"===t.type)return t.widgets[0].name==e}).widgets[0],i=a.widget.data.config.drillTier;i.keyTier=t-1,i.groupTier=0,i.filters.key=[],i.filters.group=[]})},resetDrilldown:function(e,t){_.isUndefined(t)&&(t=1),_.each(e,function(e){var a=_.find($scope.board.layout.rows,function(t){if("widget"===t.type)return t.widgets[0].name==e}).widgets[0],i=a.widget.data.config.keys;i[t-1].values=[],i.splice(t,i.length-1)})},initAll:function(){utils.widget.widgetNum!==utils.widget.loadWidgetNum&&utils.widget.loadDelayWidget(!1)},sort:function(e,t,a){var i=_.find($scope.board.layout.rows,function(t){if("widget"===t.type)return t.widgets[0].name==e}).widgets[0];if(_.isUndefined(i))return void console.log("无对应的widget-",e);var r=i.widget.data.config;_.each(r.keys,function(e){$.trim(e.col)===t||$.trim(e.column)===t||$.trim(e.alias)===t?e.sort=a:e.sort=null}),_.each(r.groups,function(e){$.trim(e.col)===t||$.trim(e.column)===t||$.trim(e.alias)===t?e.sort=a:e.sort=null;
}),_.each(r.values,function(e){_.each(e.cols,function(e){$.trim(e.col)===t||$.trim(e.alias)===t?e.sort=a:e.sort=null})})},on:function(e,t,a){drillCallbackMap[e]||(drillCallbackMap[e]={}),_.each(t,function(t){drillCallbackMap[e][t]?drillCallbackMap[e][t].push(a):drillCallbackMap[e][t]=[a]})},hide:function(e){_.each($scope.board.layout.rows,function(t){_.each(t.widgets,function(t){t.name===e&&(t.hide=!0,t.config.isInit=!1)})})},show:function(e,t){"undefined"==typeof t&&(t={}),_.each($scope.board.layout.rows,function(a){_.each(a.widgets,function(a){if(a.name===e){for(var i in t)a[i]=t[i];a.hide=!1,a.config.isInit=!0,"undefined"==typeof a.realTimeTicket&&$scope.reloadWidget(a,!1,!0)}})})},tableDrilldown:function(e,t,a){var i=$scope.board.layout.rows;_.each(e,function(e){_.find(i,function(t){if("widget"===t.type)return t.widgets[0].name===e}).widgets[0]})},getPosition:function(e){_.each($scope.board.layout.rows,function(t){_.each(t.widgets,function(t){t.name===e&&console.log(e,"position:",{col:t.col,row:t.row,sizeX:t.sizeX,sizeY:t.sizeY})})})},setPagesize:function(e,t){var a=_.find($scope.board.layout.rows,function(t){if("widget"===t.type)return t.widgets[0].name===e}).widgets[0];a.widget.data.config.option.pageDataNum=t}},$.params={get:function(e){for(var t=0;t<$scope.board.layout.rows.length;t++){var a=$scope.board.layout.rows[t];if("widget"!==a.type&&a.config&&a.config.eventName===e){var i=a.config.eventName;return BoardParamService.get(i)}}return[]},set:function(e,t){for(var a=0;a<$scope.board.layout.rows.length;a++){var i=$scope.board.layout.rows[a];if("widget"!==i.type&&i.config&&i.config.eventName===e){var r=i.config.eventName;return BoardParamService.set(r,t),"capsule"===i.sign?(i.config.activeName=t,!1):(i.config.showValue!==t&&$scope.$applyAsync(function(){i.config.showValue=t}),!1)}}BoardParamService.set(e,t)},setSelect:function(e,t,a){var i=$("#select_"+e);if("undefined"==typeof a&&(a=t,t=e,i=$("[data-eventName="+t+"]")),i.size())if(a.length){var r=a;i.hasClass("isSingle")&&(r=a[0]),BoardParamService.set(t,r),i.multipleSelect("setSelects",a)}else BoardParamService.set(t,[]),i.multipleSelect("checkAll");else BoardParamService.set(t,a)}},$.filters={get:function(e){$scope.board.layout.rows.forEach(function(t){"param"===t.type&&t.params.forEach(function(t){if(t.name===e)return BoardParamService.get(e)})})},set:function(e,t){directApplyParamFilter2([{column:e,datasetId:"",type:"=",values:t}])},setSelect:function(e,t,a){$.params.setSelect(e,t,a)},autoCalc:function(){var e=[],t=[""];for(var a in utils.widget.boardParamKeyArr){var i={column:utils.widget.boardParamKeyArr[a],datasetId:"",type:"=",values:[]},r=BoardParamService.get(utils.widget.boardParamKeyArr[a]);i.values=r,"object"===("undefined"==typeof r?"undefined":_typeof(r))&&r.length>=0&&e.push(i)}directApplyParamFilter2(e,void 0,t),utils.widget.widgetNum!==utils.widget.loadWidgetNum&&utils.widget.loadDelayWidget(!1)},remove:function(e){BoardParamService.remove(e)}},$.iframes={calcUrl:function calcUrl(){var argReg=/\[&[^\]]+/g;_.each($scope.board.layout.rows,function(row){if(row.config&&row.config.url&&row.config.isExp&&row.config.exp){argList=row.config.exp.match(argReg);for(var allHave=!0,exp=row.config.exp,i=0;i<argList.length;i++){var argName=argList[i].substr(2),argValue=BoardParamService.get(argName);if("undefined"==typeof argValue){allHave=!1;break}exp=exp.replace("[&"+argName+"]",'"'+argValue+'"')}if(allHave)try{var value=eval(exp);$scope.$applyAsync(function(){row.config.showUrl=value})}catch(e){console.error(e)}}})}},$.events={on:function(e,t){EventService.on(e,t)},trigger:function(e,t){EventService.trigger(e,t)},off:function(e){EventService.off(e)}},$.highlight={setSeries:function(e,t){var a=window.$$dlut_renders[e];if(a){var i=a.ecc,r=a.options;if(i&&r){var o=r.series;if(o){i.showLoading();for(var n=0;n<o.length;n++)if("undefined"==typeof o[n].lineStyle&&(o[n].lineStyle={}),"undefined"==typeof o[n].itemStyle&&(o[n].itemStyle={}),o[n].lineStyle.opacity=.3,o[n].itemStyle.opacity=.3,t){var s=0===t.length||t.indexOf(o[n].name)>-1;s&&(o[n].lineStyle.opacity=1,o[n].itemStyle.opacity=1)}i.setOption(r),i.hideLoading()}}}},cancelSeries:function(e){var t=window.$$dlut_renders[e];if(t){var a=t.ecc,i=t.options;if(a&&i){var r=i.series;if(r)for(var o=0;o<r.length;o++)"undefined"==typeof r[o].lineStyle&&(r[o].lineStyle={}),"undefined"==typeof r[o].itemStyle&&(r[o].itemStyle={}),r[o].lineStyle.opacity=1,r[o].itemStyle.opacity=1;a.setOption(i)}}},set:function(e,t,a){var i=window.$$dlut_renders[e];if(i){var r=i.ecc,o=i.options;if(r&&o){r.showLoading();var n=o.series,s=void 0,l=!1;if(a){var c;o.xAxis&&"category"===o.xAxis.type&&o.xAxis.data?c=o.xAxis.data:o.yAxis&&"category"===o.yAxis.type&&o.yAxis.data&&(c=o.yAxis.data),"string"!=typeof a&&(l=!0),c&&(s=c.indexOf(a))}if(n){for(var d=0;d<n.length;d++)if("undefined"==typeof n[d].lineStyle&&(n[d].lineStyle={}),n[d].lineStyle.opacity=.3,t){var u=0===t.length||t.indexOf(n[d].name)>-1;u&&(n[d].lineStyle.opacity=1);for(var f=0;f<n[d].data.length;f++){var p=n[d].data[f];if("number"==typeof p)break;if(p.itemStyle||(p.itemStyle={}),"pie"===n[d].type?(n[d].labelLine={show:!1},p.itemStyle.opacity=.6):p.itemStyle.opacity=.3,u)if(l&&p.eventInfo){if("undefined"==typeof p.infoMap){p.infoMap={};for(var g in p.eventInfo){var h=p.eventInfo[g];h.col&&(p.infoMap[h.col]=h.value)}}var m=a(p.infoMap);m?(p.itemStyle.opacity=1,n[d].lineStyle.opacity=1):n[d].lineStyle.opacity=.3}else"undefined"!=typeof a&&p.name!==a&&f!==s||(p.itemStyle.opacity=1)}}r.setOption(o),r.hideLoading()}}}},cancel:function(e){var t=window.$$dlut_renders[e];if(t){var a=t.ecc,i=t.options;if(a&&i){for(var r=i.series,o=0;o<r.length;o++){"undefined"==typeof r[o].lineStyle&&(r[o].lineStyle={}),r[o].lineStyle.opacity=1;for(var n=0;n<r[o].data.length;n++)"undefined"==typeof r[o].data[n].itemStyle&&(r[o].data[n].itemStyle={}),r[o].data[n].itemStyle.opacity=1}a.setOption(i)}}},setTable:function(e,t){var a=$("table[widget='"+e+"']").find("tbody tr");_.each(a,function(e){$(e).removeClass()}),_.each(a,function(e){_.each($(e).find("td"),function(e){_.map(t,function(t,a){a===$.trim($(e).data("column"))&&t===$.trim($(e).data("value"))?($(e).parents("tr").removeClass(),$(e).parents("tr").addClass("highlight_tr")):$(e).parents("tr").hasClass("highlight_tr")||$(e).parents("tr").addClass("dim_tr")})})})},cancelTable:function(e){var t=$("table[widget='"+e+"']").find("tbody tr");_.each(t,function(e){$(e).removeClass()})}},$.alert=function(e,t,a){ModalUtils.alert(e,t,a)},$.ibm={colors:{blue:"#11A0F8",green:"#26C8A4",purple:"#BF8FE1",blue2:"#337FFF",orange:"#FF8426",yellow:"#FFBB44",pink:"#FF7872",green2:"#7ACE4C",black:"#354052",gray:"#7F8FA4"}},$.colors={red:"#FF7872",green:"#7ACE4C",yellow:"#FFB85E",gray:"#EEEEEE",blue:"#11A0F8",orange:"#f28e2b"},$.board={onClickBlank:function(e){},flex:{reload:function(e){for(var t=0;t<$scope.board.layout.rows.length;t++){var a=$scope.board.layout.rows[t];if("widget"!==a.type&&"flex"===a.sign&&a.config&&a.config.flexCode&&a.config.eventName===e)try{var i=BoardParamService.getAll(),r=new Function("params","return ("+a.config.flexCode+")(params)")(i);a.config.showHTML=$sce.trustAsHtml(r)}catch(o){console.error("board Flex eval语句出错",a.config.flexCode,o)}}}}},$.start=function(){_.isUndefined(window.$$orangle_param)&&getOrangleParam(),getParamByOrangle(),$("body").removeClass(),$("#globalLoading").hide(),$scope.started=!0,$.widgets.initAll(),$.iframes.calcUrl()},$scope.load=function(e){$scope.paramInit=0,$scope.loading=!0,_.each($scope.intervals,function(e){$interval.cancel(e)}),$scope.intervals=[],$scope.board&&_.each($scope.board.layout.rows,function(e){_.each(e.widgets,function(e){e.show=!1})}),$http.get("dashboard/getBoardData.do?id="+$stateParams.id+"&token="+getQueryString("yili-token")).success(function(t){var a=[];_.each(t.layout.rows,function(e){"widget"==e.type&&a.push(e.widgets[0].widget.data.datasetId)});var i=function(){$scope.intervalGroup={},$scope.loading=!1,$scope.board=t,_.each($scope.board.layout.rows,function(e){_.each(e.params,function(e){$scope.paramInit++,e.paramType||(e.paramType="default")})}),paramInitListener&&paramInitListener(e),"timeline"==$scope.board.layout.type&&groupTimeline(),0==$scope.paramInit&&utils.widget.loadWidget(e),paramInitListener=$scope.$on("paramInitFinish",function(t,a){$scope.paramInit--,0==$scope.paramInit&&utils.widget.loadWidget(e)}),utils.params.clearAllSelectParams()};a.length>0?dataService.getDatasetList(a).then(i):i()})},$scope.widgetTransposition=function(e){var t=angular.copy(e.widget.data.config.keys),a=angular.copy(e.widget.data.config.groups),i=angular.copy(e.widget.data.config.drillTier),r=e.realTimeTicket;e.widget.data.config.keys=a,e.widget.data.config.groups=t,e.widget.data.config.drillTier.keyTier=i.groupTier,e.widget.data.config.drillTier.groupTier=i.keyTier,e.widget.data.config.drillTier.filters.key=i.filters.group,e.widget.data.config.drillTier.filters.group=i.filters.key,chartService.realTimeRender(r,e.widget.data)},$scope.downloadExcel=function(e){function t(e){var t=[],a={};for(var i in e.columnList)a[i]=e.columnList[i].name;for(var i in e.data){var r={};for(var o in e.data[i])r[a[o]]=e.data[i][o];t.push(r)}return t}var a=t(window.$$EXCEL[e.widget.data.wName]),i=XLSX.utils.json_to_sheet(a),r=XLSX.utils.book_new();XLSX.utils.book_append_sheet(r,i,"sheet1"),XLSX.writeFile(r,e.widget.data.wName+".xlsx")}}]);var isArrayFn=function(e){return"[object Array]"===Object.prototype.toString.call(e)},findNum=function(e){return e.match(/\d+/g)};discovery.controller("widgetConfigModalControl",["$scope","isAdmin","screenList","url","tab","tabs","widget","widgetThemeConfigGroups","$http","$timeout","$filter","$uibModalInstance",function(e,t,a,i,r,o,n,s,l,c,d,u){"ngInject";if(n.config&&n.config.columns&&"object"===_typeof(n.config.columns)&&(e.columnsText=n.config.columns.join("\n")),console.log("打开widget设置modal",n),void 0==n.maximizeOption&&(n.maximizeOption={col:n.col,row:n.row,sizeX:n.sizeX,sizeY:n.sizeY}),e.maximizeOption=n.maximizeOption,e.maximizeOption.col=n.maximizeOption.col,e.maximizeOption.row=n.maximizeOption.row,e.maximizeOption.sizeX=n.maximizeOption.sizeX,e.maximizeOption.sizeY=n.maximizeOption.sizeY,e.maximizeSelectFilterList=n.maximizeOption.filterSelected,n.widget)if(_.isUndefined(n.maximizeOption.filters))e.maximizeSelectFilterList=angular.copy(n.widget.data.filterGroups);else{for(var f=angular.copy(n.widget.data.filterGroups),p=0;p<f.length;p++)for(var g=0;g<n.maximizeOption.filters.length;g++)f[p].group==n.maximizeOption.filters[g].group?f[p].selected=!0:f[p].selected=!1;e.maximizeSelectFilterList=f}e.maxFilterInit=function(){return},e.MAXIMIZE_TYPE=[{name:"单纯最大化",value:"default"},{name:"调整过滤器",value:"filter"},{name:"切换到tab",value:"tab"}],e.tabs=o,_.isUndefined(e.maximizeOption)&&(e.maximizeOption={tabSelect:{}}),e.changeTab=function(t){e.maximizeOption.tabSelect==t.id?delete e.maximizeOption.tabSelect:e.maximizeOption.tabSelect=t.id},e.isAdmin=t,e.screenList=a,e.checkScreen=function(t){e.screenAction.target!=t?e.screenAction.target=t:e.screenAction.target=""},e.checkRegular=function(e,t){t.target!=e?t.target=e:t.target=""};e.url=i;var h={chord:!0,line:!0,line2:!0,line3:!0,pie:!0,pie2:!0,kpi:!1,table:!1,dataLineTable:!0,funnel:!0,sankey:!0,echart3dMap:!0,circular:!0,radar:!0,map:!1,scatter:!0,scatter2:!0,gauge:!1,wordCloud:!0,treeMap:!1,areaMap:!1,heatMapCalendar:!1,heatMapTable:!0,markLineMap:!1,liquidFill:!1,flex:!1,echart3dBar:!1,echart3dArea:!1,echart3dMapLine:!1,barPolarStack:!1,pieProportion:!1,codeFlower:!1,barLimits:!1,flex2:!0,lineMap:!0,gantt:!0,rose:!0};if(void 0!=n.widget&&h[n.widget.data.config.chart_type]){if(e.showActionTab=!0,e.boardList=[],l.get("admin/getBoardListUser.do").success(function(t){e.boardList=t}),e.selectDushboard=null,e.TARGET_SELECT=[{name:"影响本页",value:"self"},{name:"跳转到其他面板",value:"dashboard"},{name:"跳转到站外链接",value:"url"}],void 0==n.action||void 0==n.action.type&&void 0==n.action.regular)n.action={regular:!1,list:[{type:"self",target:null,param:{}}]};else if(!_.isUndefined(n.action.type)&&_.isUndefined(n.action.regular)){var m=angular.copy(n.action);n.action={regular:!1,list:[m]}}if(n.actionChange=!0,e.action=n.action,!_.isUndefined(n.widget.data)){var v=n.widget.data.config.keys;n.widget.data.config.events&&(v=v.concat(n.widget.data.config.events)),_.each(v,function(e){_.each(n.action.list,function(t){_.isUndefined(t.param[e.col])&&(t.param[e.col]={name:e.alias?e.alias:e.col,col:e.col,regular:"",selected:!1})})})}if(e.isAdmin)if(void 0!=n.screenAction?e.screenAction=n.screenAction:e.screenAction={},_.isUndefined(e.screenAction.param))e.screenAction.param=angular.copy(e.action.list[0].param),_.each(e.screenAction.param,function(e){e.selected=!1});else for(var p in e.action.list[0].param){var y=angular.copy(e.action.list[0].param[p]),b=!1;for(var g in e.screenAction.param)if(p==g){b=!0;break}b||(y.selected=!1,e.screenAction.param[p]=y)}}if(e.pushActionList=function(){var t=angular.copy(e.action.list[0]);t.type="self",t.target=null;for(var a in t.param)t.param[a].regular="",t.param[a].selected=!1;e.action.list.push(t)},e.deleteActionList=function(t){1!=e.action.list.length&&e.action.list.splice(t,1)},e.widgetThemeConfigGroups=s,_.isUndefined(e.maximizeOption.type)&&(e.maximizeOption.type="default"),e.widget=n,_.isUndefined(n.theme)||(e.selectTheme=n.theme),_.isUndefined(e.selectTheme)&&(e.selectTheme={select:{},classes:[],options:[]}),e.changePzTheme=function(t,a){e.selectTheme.select[t]==a.id?delete e.selectTheme.select[t]:e.selectTheme.select[t]=a.id;var i=[],r=[];for(var t in e.selectTheme.select){var o=e.selectTheme.select[t];_.each(e.widgetThemeConfigGroups[t],function(e){if(e.id==o){e["class"]&&(i=i.concat(e["class"]));var t=e.option;t&&r.push(t)}})}e.selectTheme.options=r,e.selectTheme.classes=i},n.widget&&(e.canSelectFilterList=angular.copy(n.widget.data.filterGroups),n.config&&n.config.rotateFilters&&n.config.rotateFilters.enable?e.rotateFilters=n.config.rotateFilters:e.rotateFilters={},n.config&&n.config.filters))for(var p=0;p<n.config.filters.length;p++)for(var g=0;g<e.canSelectFilterList.length;g++)n.config.filters[p].group==e.canSelectFilterList[g].group&&(e.canSelectFilterList[g].selected=!0);e.ok=function(){if(e.columnsText&&(e.widget.config.columns=e.columnsText.split("\n")),_.isUndefined(n.config)&&(n.config={}),n.widget){var t=[];if(e.canSelectFilterList)for(var a=0;a<e.canSelectFilterList.length;a++){var i=e.canSelectFilterList[a];i.selected&&t.push(i)}if(e.rotateFilters.enable&&(n.config.rotateFilters=e.rotateFilters),n.config.filters=t,t=[],e.maximizeSelectFilterList)for(var a=0;a<e.maximizeSelectFilterList.length;a++)i=e.maximizeSelectFilterList[a],i.selected&&t.push(i);n.maximizeOption.filters=t}n.theme=e.selectTheme,"board"!=n.type||_.isUndefined(n.config.url)||(n.config.url=e.url),n.screenAction=e.screenAction,u.close()},e.cancel=function(){u.dismiss("cancel")}}]).controller("AddImgWidgetCtrl",["$scope","tab","Upload","$sce","$http","$timeout","$filter","$uibModalInstance",function(e,t,a,i,r,o,n,s){"ngInject";e.$watch("files",function(){e.upload(e.files)}),e.$watch("file",function(){null!=e.file&&(e.files=[e.file])}),e.imgUrl="",e.log="",e.upload=function(t){if(t&&t.length)for(var i=0;i<t.length;i++){var r=t[i];r.$error||a.upload({url:"/images/upload.do",data:{file:r}}).then(function(t){e.imgUrl=t.data.imgUrl},null,function(e){})}};var l={name:"图片",type:"board",sizeX:10,sizeY:10,params:[],config:{},tab:t,sign:"img"};e.ok=function(){l.config.imgUrl=e.imgUrl,s.close(l)},e.cancel=function(){s.dismiss("cancel")}}]).controller("AddIframeWidgetCtrl",["$scope","tab","$sce","$http","$timeout","$filter","$uibModalInstance",function(e,t,a,i,r,o,n){"ngInject";var s={name:"iframe",type:"board",sizeX:10,sizeY:10,params:[],config:{},tab:t,sign:"iframe"};e.url="http://",e.ok=function(){s.config.url=e.url,n.close(s)},e.cancel=function(){n.dismiss("cancel")}}]).controller("AddTimePickerWidgetCtrl",["$scope","tab","$sce","$http","$timeout","$filter","$uibModalInstance",function(e,t,a,i,r,o,n){"ngInject";var s={name:"时间选择器",type:"board",sizeX:10,sizeY:10,params:[],config:{},tab:t,sign:"timePicker",timeOptions:{year:"年",month:"月",day:"日"},showValue:""};e.name="时间选择器",e.eventName="",e.timeType="year",e.ok=function(){s.changeTime=e.changeTime,s.name=e.name,s.config.eventName=e.eventName,s.config.timeType=e.timeType,n.close(s)},e.cancel=function(){n.dismiss("cancel")}}]).controller("AddColsWidgetCtrl",["$scope","tab","$sce","$http","$timeout","$filter","$uibModalInstance",function(e,t,a,i,r,o,n){"ngInject";var s={name:"字段",type:"board",sizeX:10,sizeY:10,params:[],config:{},tab:t,sign:"columns"};e.name="字段",e.eventName="",e.columns="",e.chooseType=1,e.ok=function(){s.name=e.name,s.config.eventName=e.eventName,e.columns?s.config.columns=e.columns.split("\n"):s.config.columns=[],s.config.chooseType=e.chooseType,n.close(s)},e.cancel=function(){n.dismiss("cancel")}}]).controller("AddInputWidgetCtrl",["$scope","tab","$sce","$http","$timeout","$filter","$uibModalInstance",function($scope,tab,$sce,$http,$timeout,$filter,$uibModalInstance){"ngInject";var iframeWidget={name:"自定义输入框",type:"board",sizeX:10,sizeY:10,params:[],config:{},tab:tab,sign:"input"};$scope.name="自定义输入框",$scope.defaultValue="",$scope.calcFormula="",$scope.eventName="",$scope.ok=function(){if(iframeWidget.name=$scope.name,iframeWidget.config.calcFormula=$scope.calcFormula,iframeWidget.config.eventName=$scope.eventName,$scope.calcFormula){var formula=$scope.calcFormula.replace("{v}",$scope.defaultValue);try{$scope.defaultValue=eval(formula)}catch(e){alert(e)}}iframeWidget.config.defaultValue=$scope.defaultValue,$uibModalInstance.close(iframeWidget)},$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}}]).controller("addDynamicTitleCtrl",["$scope","row","globalParamTitleMap","tab","$sce","$http","$timeout","$filter","$uibModalInstance",function(e,t,a,i,r,o,n,s,l){"ngInject";t&&(e.dynamicTitle=t.config.dynamicTitle,e.dynamicDefault=t.config.dynamicDefault);var c={name:"动态标题",type:"board",sizeX:10,sizeY:10,tab:i,params:[],config:{},sign:"title"};e.ok=function(){c.config.dynamicTitle=e.dynamicTitle,c.config.dynamicDefault=e.dynamicDefault,l.close(c)},e.cancel=function(){l.dismiss("cancel")}}]).controller("SetPanelCtrl",["$scope","config","boardName","categoryId","$http","$uibModalInstance","$filter","$uibModal","$stateParams","$timeout",function(e,t,a,i,r,o,n,s,l,c){"ngInject";var d=n("translate");e.expAceOptJS=cbAcebaseOption,e.expAceOptJS.mode="javascript",e.categoryList={},e.permissionSetting=function(){var e=s.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"src/view/nv/permission/setting.html",size:"lg",controller:"permissionSettingCtrl",resolve:{config:function(){return{type:"board",id:l.id}}}});e.result.then(function(){})};var u=function(){r.get("dashboard/getCategoryList.do").success(function(t){e.categoryList=[{id:null,name:d("CONFIG.DASHBOARD.MY_DASHBOARD")}],_.each(t,function(t){e.categoryList.push(t)})})};u();var f=function(t){var a=window.wangEditor,i=new a("#alertEditor");i.customConfig.menus=["head","bold","fontSize","fontName","italic","underline","strikeThrough","foreColor","backColor","link","list","justify","quote","emoticon","table","code"],i.create(),i.txt.html(t),e.editor=i};t.hasAlert&&c(function(){f(t.alertInfo?t.alertInfo:"")},300),e.$watch("config.hasAlert",function(){t.hasAlert&&c(function(){f(t.alertInfo?t.alertInfo:"")},300)}),e.boardNname=a,e.config=t,e.dashboardType=i,r({method:"GET",url:"theme/themeList.json"}).then(function(t){e.themeList=t.data.theme},function(e){}),e.changeTheme=function(t){e.config.theme!=t.name?e.config.theme=t.name:e.config.theme=""},e.ok=function(){e.config.alertInfo=t.hasAlert?e.editor.txt.html():null,o.close({config:e.config,boardName:e.boardNname,categoryId:e.dashboardType})},e.cancel=function(){o.dismiss("cancel")}}]).controller("AddWidgetModelCtrl",["$scope","$http","$timeout","$filter","$uibModalInstance",function(e,t,a,i,r){"ngInject";var o="widgetTreeID";e.treeConfig=jsTreeConfig1;var n=function(a){t.get("dashboard/getWidgetList.do").success(function(t){e.widgetList=t,a&&a(),e.searchNode()})},s=function(){var t=jstree_GetSelectedNodes(o)[0];return _.find(e.widgetList,function(e){return e.id==t.id})};e.editNode=e.ok=function(){r.close(s())},e.cancel=function(){r.dismiss("cancel")},e.searchNode=function(){var t={wgtName:"",dsName:"",dsrName:""},a=e.widgetList.map(function(t){var a,i=_.find(e.datasetList,function(e){return e.id==t.data.datasetId}),r="";return i?a=_.find(e.datasourceList,function(e){return e.id==i.data.datasource}):t.data.datasource&&(a=_.find(e.datasourceList,function(e){return e.id==t.data.datasource})),{id:t.id,name:t.name,categoryName:t.categoryName,datasetName:i?i.name:"",datasourceName:a?a.name:r}});if(e.keywords)if(e.keywords.indexOf(" ")==-1&&e.keywords.indexOf(":")==-1)t.wgtName=e.keywords;else for(var r=e.keywords.split(" "),n=0;n<r.length;n++){var s=r[n].trim();"wg"==s.split(":")[0]&&(t.wgtName=s.split(":")[1]),"ds"==s.split(":")[0]&&(t.dsName=s.split(":")[1]),"dsr"==s.split(":")[0]&&(t.dsrName=s.split(":")[1])}originalData=jstree_CvtVPath2TreeData(i("filter")(a,{name:t.wgtName,datasetName:t.dsName,datasourceName:t.dsrName})),jstree_ReloadTree(o,originalData),e.keywords&&_.delay(function(){e.treeInstance.jstree(!0).open_all()},100)},e.treeEventsObj=function(){var i=jstree_baseTreeEventsObj({ngScope:e,ngHttp:t,ngTimeout:a,treeID:o,listName:"widgetList"});return i}(),n()}]).controller("tabCtrl",["$scope","tab","tabs","$uibModalInstance",function(e,t,a,i){"ngInject";e.ok=function(){e.tabName.length>0&&(void 0!=t?t.name=e.tabName:a.push({id:a.length,name:e.tabName}),i.close())},e.cancel=function(){i.dismiss("cancel")}}]).controller("newData",["$scope","$uibModalInstance","$http",function(e,t,a){"ngInject";e.datasourceList=[],e.datasource=null,e.dataTables=[],e.selectTable=null,e.columns=[];var i=e;e.changeTable=function(){var t={sql:"select * from "+i.selectTable};a.post("dashboard/getColumns.do",{datasourceId:i.datasource.id,query:JSON.stringify(t),reload:!1}).success(function(t){e.columns=t.columns})},a.get("dashboard/getDatasourceList.do").success(function(t){i.datasourceList=t,i.datasourceList.length>0&&(i.datasource=i.datasourceList[0],a.get("flow/datasources/"+i.datasource.id+"/tables.do").success(function(t){i.dataTables=t.data,i.dataTables.length>0&&(i.selectTable=i.dataTables[0],e.changeTable())}))}),e.changeSource=function(){a.get("flow/datasources/"+i.datasource.id+"/tables.do").success(function(t){i.dataTables=t.data,i.dataTables.length>0&&(i.selectTable=i.dataTables[0],e.changeTable())})},e.ok=function(){var a={datasource:e.datasource,selectTable:e.selectTable};t.close(a)},e.cancel=function(){t.dismiss("cancel")}}]).controller("addStaticTextCtrl",["$scope","$sce","$http","$timeout","$filter","$uibModalInstance","row","tab",function(e,t,a,i,r,o,n,s){"ngInject";n&&(e.text=n.config.editor),i(function(){var t=window.wangEditor,a=new t("#editor");a.customConfig.menus=["head","bold","fontSize","fontName","italic","underline","strikeThrough","foreColor","backColor","link","list","justify","quote","emoticon","table","code","undo","redo"],a.create(),a.txt.html(e.text),e.editor=a},300);var l={name:"静态文本",type:"board",sizeX:10,sizeY:10,tab:s,params:[],config:{},sign:"static"};e.ok=function(){l.config.editor=e.editor.txt.html(),o.close(l)},e.cancel=function(){o.dismiss("cancel")}}]).controller("addJsMindNodeCtrl",["$scope","$sce","$http","$timeout","$filter","$uibModalInstance",function(e,t,a,i,r,o){"ngInject";e.jsmindNodeText=null,e.ok=function(){o.close(e.jsmindNodeText)},e.cancel=function(){o.dismiss("cancel")}}]).controller("alertInfoCtrl",["$scope","$sce","$http","$timeout","$filter","$uibModalInstance","config",function(e,t,a,i,r,o,n){"ngInject";n&&(e.alertInfo=n.alertInfo),e.cancel=function(){o.dismiss("cancel")}}]).controller("addCapsuleCtrl",["$scope","$sce","$http","$timeout","$filter","$uibModalInstance","tab",function(e,t,a,i,r,o,n){"ngInject";var s={name:"胶囊",type:"board",sizeX:10,sizeY:10,params:[],config:{},tab:n,sign:"capsule"};e.name="按钮组",e.eventName="",e.columns="",e.functions="",e.activeName=null,e.ok=function(){s.name=e.name,s.config.activeName=e.activeName,s.config.eventName=e.eventName,s.config.functions=e.functions,e.columns?s.config.columns=e.columns.split("\n"):s.config.columns=[],o.close(s)},e.cancel=function(){o.dismiss("cancel")}}]),angular.module("discovery").factory("EventService",function(){"ngInject";var e={};return{on:function(t,a){e[t]=a},trigger:function(t,a){for(var i in e)i==t&&e[i](a)},off:function(t){delete e[t]}}});